!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.gciplayer=t():e.gciplayer=t()}(window,(function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=6)}([function(e,t,n){"use strict";var i,r="object"==typeof Reflect?Reflect:null,o=r&&"function"==typeof r.apply?r.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};i=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var u=10;function l(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function h(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function c(e,t,n,i){var r,o,s;if(l(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),s=o[t]),void 0===s)s=o[t]=n,++e._eventsCount;else if("function"==typeof s?s=o[t]=i?[n,s]:[s,n]:i?s.unshift(n):s.push(n),(r=h(e))>0&&s.length>r&&!s.warned){s.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=e,a.type=t,a.count=s.length,console&&console.warn}return e}function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},r=d.bind(i);return r.listener=n,i.wrapFn=r,r}function _(e,t,n){var i=e._events;if(void 0===i)return[];var r=i[t];return void 0===r?[]:"function"==typeof r?n?[r.listener||r]:[r]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(r):m(r,r.length)}function v(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function m(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");u=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return h(this)},a.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,r=this._events;if(void 0!==r)i=i&&void 0===r.error;else if(!i)return!1;if(i){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var u=r[e];if(void 0===u)return!1;if("function"==typeof u)o(u,this,t);else{var l=u.length,h=m(u,l);for(n=0;n<l;++n)o(h[n],this,t)}return!0},a.prototype.addListener=function(e,t){return c(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return c(this,e,t,!0)},a.prototype.once=function(e,t){return l(t),this.on(e,f(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){return l(t),this.prependListener(e,f(this,e,t)),this},a.prototype.removeListener=function(e,t){var n,i,r,o,s;if(l(t),void 0===(i=this._events))return this;if(void 0===(n=i[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(r=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){s=n[o].listener,r=o;break}if(r<0)return this;0===r?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,r),1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,s||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var r,o=Object.keys(n);for(i=0;i<o.length;++i)"removeListener"!==(r=o[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},a.prototype.listeners=function(e){return _(this,e,!0)},a.prototype.rawListeners=function(e){return _(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):v.call(e,t)},a.prototype.listenerCount=v,a.prototype.eventNames=function(){return this._eventsCount>0?i(this._events):[]}},function(e,t,n){e.exports=function(){"use strict";var e=6e4,t=36e5,n="millisecond",i="second",r="minute",o="hour",s="day",a="week",u="month",l="quarter",h="year",c="date",d="Invalid Date",f=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,_=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,v={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},m=function(e,t,n){var i=String(e);return!i||i.length>=t?e:""+Array(t+1-i.length).join(n)+e},p={s:m,z:function(e){var t=-e.utcOffset(),n=Math.abs(t),i=Math.floor(n/60),r=n%60;return(t<=0?"+":"-")+m(i,2,"0")+":"+m(r,2,"0")},m:function e(t,n){if(t.date()<n.date())return-e(n,t);var i=12*(n.year()-t.year())+(n.month()-t.month()),r=t.clone().add(i,u),o=n-r<0,s=t.clone().add(i+(o?-1:1),u);return+(-(i+(n-r)/(o?r-s:s-r))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:u,y:h,w:a,d:s,D:c,h:o,m:r,s:i,ms:n,Q:l}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},y="en",g={};g[y]=v;var b=function(e){return e instanceof D},w=function e(t,n,i){var r;if(!t)return y;if("string"==typeof t){var o=t.toLowerCase();g[o]&&(r=o),n&&(g[o]=n,r=o);var s=t.split("-");if(!r&&s.length>1)return e(s[0])}else{var a=t.name;g[a]=t,r=a}return!i&&r&&(y=r),r||!i&&y},k=function(e,t){if(b(e))return e.clone();var n="object"==typeof t?t:{};return n.date=e,n.args=arguments,new D(n)},E=p;E.l=w,E.i=b,E.w=function(e,t){return k(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var D=function(){function v(e){this.$L=w(e.locale,null,!0),this.parse(e)}var m=v.prototype;return m.parse=function(e){this.$d=function(e){var t=e.date,n=e.utc;if(null===t)return new Date(NaN);if(E.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var i=t.match(f);if(i){var r=i[2]-1||0,o=(i[7]||"0").substring(0,3);return n?new Date(Date.UTC(i[1],r,i[3]||1,i[4]||0,i[5]||0,i[6]||0,o)):new Date(i[1],r,i[3]||1,i[4]||0,i[5]||0,i[6]||0,o)}}return new Date(t)}(e),this.$x=e.x||{},this.init()},m.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},m.$utils=function(){return E},m.isValid=function(){return!(this.$d.toString()===d)},m.isSame=function(e,t){var n=k(e);return this.startOf(t)<=n&&n<=this.endOf(t)},m.isAfter=function(e,t){return k(e)<this.startOf(t)},m.isBefore=function(e,t){return this.endOf(t)<k(e)},m.$g=function(e,t,n){return E.u(e)?this[t]:this.set(n,e)},m.unix=function(){return Math.floor(this.valueOf()/1e3)},m.valueOf=function(){return this.$d.getTime()},m.startOf=function(e,t){var n=this,l=!!E.u(t)||t,d=E.p(e),f=function(e,t){var i=E.w(n.$u?Date.UTC(n.$y,t,e):new Date(n.$y,t,e),n);return l?i:i.endOf(s)},_=function(e,t){return E.w(n.toDate()[e].apply(n.toDate("s"),(l?[0,0,0,0]:[23,59,59,999]).slice(t)),n)},v=this.$W,m=this.$M,p=this.$D,y="set"+(this.$u?"UTC":"");switch(d){case h:return l?f(1,0):f(31,11);case u:return l?f(1,m):f(0,m+1);case a:var g=this.$locale().weekStart||0,b=(v<g?v+7:v)-g;return f(l?p-b:p+(6-b),m);case s:case c:return _(y+"Hours",0);case o:return _(y+"Minutes",1);case r:return _(y+"Seconds",2);case i:return _(y+"Milliseconds",3);default:return this.clone()}},m.endOf=function(e){return this.startOf(e,!1)},m.$set=function(e,t){var a,l=E.p(e),d="set"+(this.$u?"UTC":""),f=(a={},a[s]=d+"Date",a[c]=d+"Date",a[u]=d+"Month",a[h]=d+"FullYear",a[o]=d+"Hours",a[r]=d+"Minutes",a[i]=d+"Seconds",a[n]=d+"Milliseconds",a)[l],_=l===s?this.$D+(t-this.$W):t;if(l===u||l===h){var v=this.clone().set(c,1);v.$d[f](_),v.init(),this.$d=v.set(c,Math.min(this.$D,v.daysInMonth())).$d}else f&&this.$d[f](_);return this.init(),this},m.set=function(e,t){return this.clone().$set(e,t)},m.get=function(e){return this[E.p(e)]()},m.add=function(n,l){var c,d=this;n=Number(n);var f=E.p(l),_=function(e){var t=k(d);return E.w(t.date(t.date()+Math.round(e*n)),d)};if(f===u)return this.set(u,this.$M+n);if(f===h)return this.set(h,this.$y+n);if(f===s)return _(1);if(f===a)return _(7);var v=(c={},c[r]=e,c[o]=t,c[i]=1e3,c)[f]||1,m=this.$d.getTime()+n*v;return E.w(m,this)},m.subtract=function(e,t){return this.add(-1*e,t)},m.format=function(e){var t=this,n=this.$locale();if(!this.isValid())return n.invalidDate||d;var i=e||"YYYY-MM-DDTHH:mm:ssZ",r=E.z(this),o=this.$H,s=this.$m,a=this.$M,u=n.weekdays,l=n.months,h=function(e,n,r,o){return e&&(e[n]||e(t,i))||r[n].slice(0,o)},c=function(e){return E.s(o%12||12,e,"0")},f=n.meridiem||function(e,t,n){var i=e<12?"AM":"PM";return n?i.toLowerCase():i},v={YY:String(this.$y).slice(-2),YYYY:this.$y,M:a+1,MM:E.s(a+1,2,"0"),MMM:h(n.monthsShort,a,l,3),MMMM:h(l,a),D:this.$D,DD:E.s(this.$D,2,"0"),d:String(this.$W),dd:h(n.weekdaysMin,this.$W,u,2),ddd:h(n.weekdaysShort,this.$W,u,3),dddd:u[this.$W],H:String(o),HH:E.s(o,2,"0"),h:c(1),hh:c(2),a:f(o,s,!0),A:f(o,s,!1),m:String(s),mm:E.s(s,2,"0"),s:String(this.$s),ss:E.s(this.$s,2,"0"),SSS:E.s(this.$ms,3,"0"),Z:r};return i.replace(_,(function(e,t){return t||v[e]||r.replace(":","")}))},m.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},m.diff=function(n,c,d){var f,_=E.p(c),v=k(n),m=(v.utcOffset()-this.utcOffset())*e,p=this-v,y=E.m(this,v);return y=(f={},f[h]=y/12,f[u]=y,f[l]=y/3,f[a]=(p-m)/6048e5,f[s]=(p-m)/864e5,f[o]=p/t,f[r]=p/e,f[i]=p/1e3,f)[_]||p,d?y:E.a(y)},m.daysInMonth=function(){return this.endOf(u).$D},m.$locale=function(){return g[this.$L]},m.locale=function(e,t){if(!e)return this.$L;var n=this.clone(),i=w(e,t,!0);return i&&(n.$L=i),n},m.clone=function(){return E.w(this.$d,this)},m.toDate=function(){return new Date(this.valueOf())},m.toJSON=function(){return this.isValid()?this.toISOString():null},m.toISOString=function(){return this.$d.toISOString()},m.toString=function(){return this.$d.toUTCString()},v}(),S=D.prototype;return k.prototype=S,[["$ms",n],["$s",i],["$m",r],["$H",o],["$W",s],["$M",u],["$y",h],["$D",c]].forEach((function(e){S[e[1]]=function(t){return this.$g(t,e[0],e[1])}})),k.extend=function(e,t){return e.$i||(e(t,D,k),e.$i=!0),k},k.locale=w,k.isDayjs=b,k.unix=function(e){return k(1e3*e)},k.en=g[y],k.Ls=g,k.p={},k}()},function(e,t,n){"use strict";var i=window.URL||window.webkitURL;e.exports=function(e,t){try{try{var n;try{(n=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(e),n=n.getBlob()}catch(t){n=new Blob([e])}return new Worker(i.createObjectURL(n))}catch(t){return new Worker("data:application/javascript,"+encodeURIComponent(e))}}catch(e){if(!t)throw Error("Inline worker is not supported");return new Worker(t)}}},function(e,t,n){e.exports=function(){return n(2)('!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){"use strict";var r,i="object"==typeof Reflect?Reflect:null,o=i&&"function"==typeof i.apply?i.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};r=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var u=10;function c(e){if("function"!=typeof e)throw new TypeError(\'The "listener" argument must be of type Function. Received type \'+typeof e)}function f(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function d(e,t,n,r){var i,o,a;if(c(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),a=o[t]),void 0===a)a=o[t]=n,++e._eventsCount;else if("function"==typeof a?a=o[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),(i=f(e))>0&&a.length>i&&!a.warned){a.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");s.name="MaxListenersExceededWarning",s.emitter=e,s.type=t,s.count=a.length,console&&console.warn}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=l.bind(r);return i.listener=n,r.wrapFn=i,i}function v(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):y(i,i.length)}function _(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function y(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError(\'The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received \'+e+".");u=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError(\'The value of "n" is out of range. It must be a non-negative number. Received \'+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return f(this)},s.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var u=i[e];if(void 0===u)return!1;if("function"==typeof u)o(u,this,t);else{var c=u.length,f=y(u,c);for(n=0;n<c;++n)o(f[n],this,t)}return!0},s.prototype.addListener=function(e,t){return d(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return d(this,e,t,!0)},s.prototype.once=function(e,t){return c(t),this.on(e,h(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return c(t),this.prependListener(e,h(this,e,t)),this},s.prototype.removeListener=function(e,t){var n,r,i,o,a;if(c(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,a||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},s.prototype.listeners=function(e){return v(this,e,!0)},s.prototype.rawListeners=function(e){return v(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):_.call(e,t)},s.prototype.listenerCount=_,s.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(e,t,n){"use strict";n.r(t);var r=n(0),i=n.n(r),o=-4;function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._onHeadersDecoded=null,this._onPictureDecoded=null,this._onAudioDecoded=null}var t,n,r;return t=e,(n=[{key:"destroy",value:function(){this._onHeadersDecoded=null,this._onPictureDecoded=null,this._onAudioDecoded=null}},{key:"getModule",value:function(e){return this._getModule(this._onHeadersDecoded,this._onPictureDecoded,this._onAudioDecoded,e)}},{key:"_getModule",value:function(e,t,n,r){var i,o=void 0!==o?o:{},s={};for(i in o)o.hasOwnProperty(i)&&(s[i]=o[i]);var u,c=[],f="./this.program",d="";d=0!==(d=self.location.href).indexOf("blob:")?d.substr(0,d.lastIndexOf("/")+1):"",u=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)};var l,h,v=o.print||function(e){},_=o.printErr||function(e){};for(i in s)s.hasOwnProperty(i)&&(o[i]=s[i]);s=null,o.arguments&&(c=o.arguments),o.thisProgram&&(f=o.thisProgram),o.quit&&o.quit,o.wasmBinary&&(l=o.wasmBinary),o.noExitRuntime,"object"!==("undefined"==typeof WebAssembly?"undefined":a(WebAssembly))&&S("no native wasm support detected");var y,p,m,g=!1,b="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function w(e,t,n){for(var r=t+n,i=t;e[i]&&!(i>=r);)++i;if(i-t>16&&e.subarray&&b)return b.decode(e.subarray(t,i));for(var o="";t<i;){var a=e[t++];if(128&a){var s=63&e[t++];if(192!=(224&a)){var u=63&e[t++];if((a=224==(240&a)?(15&a)<<12|s<<6|u:(7&a)<<18|s<<12|u<<6|63&e[t++])<65536)o+=String.fromCharCode(a);else{var c=a-65536;o+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else o+=String.fromCharCode((31&a)<<6|s)}else o+=String.fromCharCode(a)}return o}o.INITIAL_MEMORY;var A,D=[],E=[],P=[],k=[];E.push({func:function(){G()}});var R=0,I=null,C=null;function S(e){throw o.onAbort&&o.onAbort(e),_(e+=""),g=!0,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.",new WebAssembly.RuntimeError(e)}function O(e){return t=e,n="data:application/octet-stream;base64,",String.prototype.startsWith?t.startsWith(n):0===t.indexOf(n);var t,n}o.preloadedImages={},o.preloadedAudios={};var T,H,L=r||"libvideo.wasm";function M(e){try{if(e==L&&l)return new Uint8Array(l);if(u)return u(e);throw"both async and sync fetching of the wasm failed"}catch(e){S(e)}}function F(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var n=t.func;"number"==typeof n?void 0===t.arg?A.get(n)():A.get(n)(t.arg):n(void 0===t.arg?null:t.arg)}else t(o)}}O(L)||(H=L,String.prototype.startsWith?H.startsWith("http"):0===H.indexOf("http"))||(T=L,L=o.locateFile?o.locateFile(T,d):d+T);var B={mappings:{},buffers:[null,[],[]],printChar:function(e,t){var n=B.buffers[e];0===t||10===t?((1===e?v:_)(w(n,0)),n.length=0):n.push(t)},varargs:void 0,get:function(){return B.varargs+=4,m[B.varargs-4>>2]},getStr:function(e){return function(e,t){return e?w(p,e,t):""}(e)},get64:function(e,t){return e}};function U(){e()}function x(e,n,r,i){t(e,n,r,i)}o._broadwayOnHeadersDecoded=U,o._broadwayOnPictureDecoded=x;var j={};function W(){if(!W.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"===("undefined"==typeof navigator?"undefined":a(navigator))&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:f||"./this.program"};for(var t in j)e[t]=j[t];var n=[];for(var t in e)n.push(t+"="+e[t]);W.strings=n}return W.strings}function N(e,t,r,i,o){n(e,t,r,i,o)}o._onAudioDec=N;var V,z={g:function(e,t,n){return B.varargs=n,0},s:function(e,t,n){B.varargs=n},a:function(){S()},i:U,h:x,l:function e(){return void 0===e.start&&(e.start=Date.now()),1e3*(Date.now()-e.start)|0},m:function(e,t,n){p.copyWithin(e,t,t+n)},n:function(e){S("OOM")},o:function(e,t){var n=0;return W().forEach((function(r,i){var o=t+n;m[e+4*i>>2]=o,function(e,t,n){for(var r=0;r<e.length;++r)y[t++>>0]=e.charCodeAt(r);n||(y[t>>0]=0)}(r,o),n+=r.length+1})),0},p:function(e,t){var n=W();m[e>>2]=n.length;var r=0;return n.forEach((function(e){r+=e.length+1})),m[t>>2]=r,0},f:function(e){return 0},q:function(e,t){var n=1==e||2==e?2:S();return y[t>>0]=n,0},r:function(e,t,n,r){var i=B.getStreamFromFD(e),o=B.doReadv(i,t,n);return m[r>>2]=o,0},k:function(e,t,n,r,i){},e:function(e,t,n,r){for(var i=0,o=0;o<n;o++){for(var a=m[t+8*o>>2],s=m[t+(8*o+4)>>2],u=0;u<s;u++)B.printChar(e,p[a+u]);i+=s}return m[r>>2]=i,0},t:function(e){var t=Date.now();return m[e>>2]=t/1e3|0,m[e+4>>2]=t%1e3*1e3|0,0},b:N,c:function(){return 6},d:function(){return 28},j:function(e){switch(e){case 30:return 16384;case 85:return p.length/16384;case 132:case 133:case 12:case 137:case 138:case 15:case 235:case 16:case 17:case 18:case 19:case 20:case 149:case 13:case 10:case 236:case 153:case 9:case 21:case 22:case 159:case 154:case 14:case 77:case 78:case 139:case 82:case 68:case 67:case 164:case 11:case 29:case 47:case 48:case 95:case 52:case 51:case 46:return 200809;case 27:case 246:case 127:case 128:case 23:case 24:case 160:case 161:case 181:case 182:case 242:case 183:case 184:case 243:case 244:case 245:case 165:case 178:case 179:case 49:case 50:case 168:case 169:case 175:case 170:case 171:case 172:case 97:case 76:case 32:case 173:case 35:case 80:case 81:case 79:return-1;case 176:case 177:case 7:case 155:case 8:case 157:case 125:case 126:case 92:case 93:case 129:case 130:case 131:case 94:case 91:return 1;case 74:case 60:case 69:case 70:case 4:return 1024;case 31:case 42:case 72:return 32;case 87:case 26:case 33:return 2147483647;case 34:case 1:return 47839;case 38:case 36:return 99;case 43:case 37:return 2048;case 0:return 2097152;case 3:return 65536;case 28:return 32768;case 44:return 32767;case 75:return 16384;case 39:return 1e3;case 89:return 700;case 71:return 256;case 40:return 255;case 2:return 100;case 180:return 64;case 25:return 20;case 5:return 16;case 6:return 6;case 73:return 4;case 84:return"object"===("undefined"==typeof navigator?"undefined":a(navigator))&&navigator.hardwareConcurrency||1}var t;return t=28,m[q()>>2]=t,-1}},G=(function(){var e={a:z};function t(e,t){var n,r=e.exports;o.asm=r,h=o.asm.u,n=h.buffer,o.HEAP8=y=new Int8Array(n),o.HEAP16=new Int16Array(n),o.HEAP32=m=new Int32Array(n),o.HEAPU8=p=new Uint8Array(n),o.HEAPU16=new Uint16Array(n),o.HEAPU32=new Uint32Array(n),o.HEAPF32=new Float32Array(n),o.HEAPF64=new Float64Array(n),A=o.asm.w,function(e){if(R--,o.monitorRunDependencies&&o.monitorRunDependencies(R),0==R&&(null!==I&&(clearInterval(I),I=null),C)){var t=C;C=null,t()}}()}function n(e){t(e.instance)}function r(t){return(l||"function"!=typeof fetch?Promise.resolve().then((function(){return M(L)})):fetch(L,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at \'"+L+"\'";return e.arrayBuffer()})).catch((function(){return M(L)}))).then((function(t){return WebAssembly.instantiate(t,e)})).then(t,(function(e){_("failed to asynchronously prepare wasm: "+e),S(e)}))}if(R++,o.monitorRunDependencies&&o.monitorRunDependencies(R),o.instantiateWasm)try{return o.instantiateWasm(e,t)}catch(e){return _("Module.instantiateWasm callback failed with error: "+e),!1}l||"function"!=typeof WebAssembly.instantiateStreaming||O(L)||"function"!=typeof fetch?r(n):fetch(L,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(n,(function(e){return _("wasm streaming compile failed: "+e),_("falling back to ArrayBuffer instantiation"),r(n)}))}))}(),o.___wasm_call_ctors=function(){return(G=o.___wasm_call_ctors=o.asm.v).apply(null,arguments)}),q=o.___errno_location=function(){return(q=o.___errno_location=o.asm.x).apply(null,arguments)};function X(e){function t(){V||(V=!0,o.calledRun=!0,g||(F(E),F(P),o.onRuntimeInitialized&&o.onRuntimeInitialized(),function(){if(o.postRun)for("function"==typeof o.postRun&&(o.postRun=[o.postRun]);o.postRun.length;)e=o.postRun.shift(),k.unshift(e);var e;F(k)}()))}e=e||c,R>0||(function(){if(o.preRun)for("function"==typeof o.preRun&&(o.preRun=[o.preRun]);o.preRun.length;)e=o.preRun.shift(),D.unshift(e);var e;F(D)}(),R>0||(o.setStatus?(o.setStatus("Running..."),setTimeout((function(){setTimeout((function(){o.setStatus("")}),1),t()}),1)):t()))}if(o._broadwayInit=function(){return(o._broadwayInit=o.asm.y).apply(null,arguments)},o._broadwayCreateStream=function(){return(o._broadwayCreateStream=o.asm.z).apply(null,arguments)},o._broadwayPlayStream=function(){return(o._broadwayPlayStream=o.asm.A).apply(null,arguments)},C=function e(){V||X(),V||(C=e)},o.run=X,o.preInit)for("function"==typeof o.preInit&&(o.preInit=[o.preInit]);o.preInit.length>0;)o.preInit.pop()();return X(),o}},{key:"onHeadersDecoded",get:function(){return this._onHeadersDecoded},set:function(e){this._onHeadersDecoded=e}},{key:"onPictureDecoded",get:function(){return this._onPictureDecoded},set:function(e){this._onPictureDecoded=e}},{key:"onAudioDecoded",get:function(){return this._onAudioDecoded},set:function(e){this._onAudioDecoded=e}}])&&s(t.prototype,n),r&&s(t,r),e}();function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var f=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._config=t,this._module=null,this._MAX_VIDEO_BUFFER_LENGTH=3145728,this._videoBuffer=null,this._bufferTotal=0,this._decodeBuffers={},this._vTimestamp=0,this._MAX_AUDIO_BUFFER_LENGTH=51200,this._audioBuffer=null,this._decodeAudioBuffers={},this._aTimestamp=0,this._isInitAudio=!1,this._onError=null,this._onAudioDecoded=null,this._onVideoDecoded=null,this._tempTime=null,this._vCache=[],this._aCache=[],this._initModule()}var t,n,r;return t=e,(n=[{key:"destroy",value:function(){this._module=null,this._videoBuffer=null,this._decodeBuffers=null,this._vTimestamp=0,this._audioBuffer=null,this._decodeAudioBuffers=null,this._aTimestamp=0,this._isInitAudio=!1,this._onError=null,this._onInitCompleted=null,this._onVideoDecoded=null,this._onAudioDecoded=null,this._vCache=[],this._aCache=[]}},{key:"videoDecode",value:function(e){if(this._videoBuffer){if(this._vCache.length>0){for(var t=0;t<this._vCache.length;t++){var n=this._vCache[t];this._videoBuffer.set(n),this._bufferTotal+=n.length,this._module._broadwayPlayStream(n.length,this._bufferTotal)}this._vCache=[]}this._videoBuffer.set(e),this._bufferTotal+=e.length,this._module._broadwayPlayStream(e.length,this._bufferTotal)}else this._vCache.push(e)}},{key:"audioInit",value:function(e,t){this._audioBuffer&&(this._audioBuffer.set(e),this._module._AudioInit(e.length,t))}},{key:"audioDecode",value:function(e){this._audioBuffer.set(e),this._module._aacStream(e.length)}},{key:"unPack",value:function(e){this.videoDecode(e)}},{key:"_initModule",value:function(){if(this._module=this._getModule(this._config.wasmFile),this._module)this._module.onRuntimeInitialized=this._onRuntimeInitialized.bind(this);else{var e={code:o,message:"init module exception"};this._onError&&this._onError(e)}}},{key:"_getModule",value:function(e){var t=new u;return t.onHeadersDecoded=this._onAsmHeadersDecoded.bind(this),t.onPictureDecoded=this._onAsmPictureDecoded.bind(this),t.onAudioDecoded=this._onAsmAudioDecoded.bind(this),t.getModule(e)}},{key:"_onRuntimeInitialized",value:function(){this._initDecoder()}},{key:"_initDecoder",value:function(){this._module._broadwayInit();var e=this._MAX_VIDEO_BUFFER_LENGTH;this._videoBuffer=this._toU8Array(this._module._broadwayCreateStream(e),e)}},{key:"_onAsmHeadersDecoded",value:function(){}},{key:"_onAsmPictureDecoded",value:function(e,t,n,r){var i=this._decodeBuffers[e];i||(i=this._decodeBuffers[e]=this._toU8Array(e,t*n*3/2)),this._onVideoDecoded&&this._onVideoDecoded(r,new Uint8Array(i.slice(0,i.length)),t,n)}},{key:"_onAsmAudioDecoded",value:function(e,t,n,r,i){var o=this._decodeAudioBuffers[e];o||(o=this._decodeAudioBuffers[e]=this._toU8Array(e,t)),this._onAudioDecoded&&this._onAudioDecoded(i,new Uint8Array(o.slice(0,o.length)),t,n,r)}},{key:"_parseAudioData",value:function(e){var t=0;e[t],t+=1;var n=e.slice(t,t+4);t+=4;var r={audioType:n[0],smaprate:n[1],smapwidth:n[2],channel:n[3]},i=e.slice(t,t+4),o=this._uint8Array2Int32(i);this._aTimestamp=o,t+=4;var a=e.slice(t,t+4);this._uint8Array2Int32(a),t+=4;var s=e.slice(t,e.length);10==r.audioType||this._isInitAudio||(this.audioInit(s,r.audioType),this._isInitAudio=!0),this.audioDecode(s)}},{key:"_parseVideoData",value:function(e){var t=0,n=e.slice(t,t+4),r=this._uint8Array2Int32(n);this._vTimestamp=r,t+=4;var i=e.slice(t,t+4);this._uint8Array2Int32(i),t+=4;var o=e.slice(t,e.length);this.videoDecode(o)}},{key:"_toU8Array",value:function(e,t){return this._module.HEAPU8.subarray(e,e+t)}},{key:"_uint8Array2Int32",value:function(e){return 4!=e.length?0:255&e[0]|e[1]<<8&65280|e[2]<<16&16711680|e[3]<<24&4278190080}},{key:"onError",get:function(){return this._onError},set:function(e){this._onError=e}},{key:"onInitCompleted",get:function(){return this._onInitCompleted},set:function(e){this._onInitCompleted=e}},{key:"onVideoDecoded",get:function(){return this._onVideoDecoded},set:function(e){this._onVideoDecoded=e}},{key:"onAudioDecoded",get:function(){return this._onAudioDecoded},set:function(e){this._onAudioDecoded=e}}])&&c(t.prototype,n),r&&c(t,r),e}();function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var h=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._onHeadersDecoded=null,this._onPictureDecoded=null}var t,n,r;return t=e,(n=[{key:"destroy",value:function(){this._onHeadersDecoded=null,this._onPictureDecoded=null}},{key:"initModule",value:function(e){return this._module(this.onHeadersDecoded,this._onPictureDecoded,e)}},{key:"_module",value:function(e,t,n){var r,i=void 0!==i?i:{},o={};for(r in i)i.hasOwnProperty(r)&&(o[r]=i[r]);var a,s=[],u="./this.program",c="";c=0!==(c=self.location.href).indexOf("blob:")?c.substr(0,c.lastIndexOf("/")+1):"",a=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)};var f,l,h=i.print||function(e){},v=i.printErr||function(e){};for(r in o)o.hasOwnProperty(r)&&(i[r]=o[r]);o=null,i.arguments&&(s=i.arguments),i.thisProgram&&(u=i.thisProgram),i.quit&&i.quit,i.wasmBinary&&(f=i.wasmBinary),i.noExitRuntime,"object"!==("undefined"==typeof WebAssembly?"undefined":d(WebAssembly))&&C("no native wasm support detected");var _,y,p,m=!1,g="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function b(e,t,n){for(var r=t+n,i=t;e[i]&&!(i>=r);)++i;if(i-t>16&&e.subarray&&g)return g.decode(e.subarray(t,i));for(var o="";t<i;){var a=e[t++];if(128&a){var s=63&e[t++];if(192!=(224&a)){var u=63&e[t++];if((a=224==(240&a)?(15&a)<<12|s<<6|u:(7&a)<<18|s<<12|u<<6|63&e[t++])<65536)o+=String.fromCharCode(a);else{var c=a-65536;o+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else o+=String.fromCharCode((31&a)<<6|s)}else o+=String.fromCharCode(a)}return o}i.INITIAL_MEMORY;var w,A=[],D=[],E=[],P=[];D.push({func:function(){V()}});var k=0,R=null,I=null;function C(e){throw i.onAbort&&i.onAbort(e),v(e+=""),m=!0,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.",new WebAssembly.RuntimeError(e)}function S(e){return t=e,n="data:application/octet-stream;base64,",String.prototype.startsWith?t.startsWith(n):0===t.indexOf(n);var t,n}i.preloadedImages={},i.preloadedAudios={};var O,T,H=n||"libvideoflv.wasm";function L(e){try{if(e==H&&f)return new Uint8Array(f);if(a)return a(e);throw"both async and sync fetching of the wasm failed"}catch(e){C(e)}}function M(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var n=t.func;"number"==typeof n?void 0===t.arg?w.get(n)():w.get(n)(t.arg):n(void 0===t.arg?null:t.arg)}else t(i)}}S(H)||(T=H,String.prototype.startsWith?T.startsWith("http"):0===T.indexOf("http"))||(O=H,H=i.locateFile?i.locateFile(O,c):c+O);var F={mappings:{},buffers:[null,[],[]],printChar:function(e,t){var n=F.buffers[e];0===t||10===t?((1===e?h:v)(b(n,0)),n.length=0):n.push(t)},varargs:void 0,get:function(){return F.varargs+=4,p[F.varargs-4>>2]},getStr:function(e){return function(e,t){return e?b(y,e,t):""}(e)},get64:function(e,t){return e}};function B(){e()}function U(e,n){t(e,n)}i._broadwayOnHeadersDecoded=B,i._broadwayOnPictureDecoded=U;var x={};function j(){if(!j.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"===("undefined"==typeof navigator?"undefined":d(navigator))&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:u||"./this.program"};for(var t in x)e[t]=x[t];var n=[];for(var t in e)n.push(t+"="+e[t]);j.strings=n}return j.strings}var W,N={g:function(e,t,n){return F.varargs=n,0},f:function(e,t,n){F.varargs=n},a:function(){C()},p:B,h:U,i:function e(){return void 0===e.start&&(e.start=Date.now()),1e3*(Date.now()-e.start)|0},l:function(e,t,n){y.copyWithin(e,t,t+n)},m:function(e){C("OOM")},n:function(e,t){var n=0;return j().forEach((function(r,i){var o=t+n;p[e+4*i>>2]=o,function(e,t,n){for(var r=0;r<e.length;++r)_[t++>>0]=e.charCodeAt(r);n||(_[t>>0]=0)}(r,o),n+=r.length+1})),0},o:function(e,t){var n=j();p[e>>2]=n.length;var r=0;return n.forEach((function(e){r+=e.length+1})),p[t>>2]=r,0},b:function(e){return 0},d:function(e,t){var n=1==e||2==e?2:C();return _[t>>0]=n,0},e:function(e,t,n,r){var i=F.getStreamFromFD(e),o=F.doReadv(i,t,n);return p[r>>2]=o,0},k:function(e,t,n,r,i){},c:function(e,t,n,r){for(var i=0,o=0;o<n;o++){for(var a=p[t+8*o>>2],s=p[t+(8*o+4)>>2],u=0;u<s;u++)F.printChar(e,y[a+u]);i+=s}return p[r>>2]=i,0},j:function(e){var t=Date.now();return p[e>>2]=t/1e3|0,p[e+4>>2]=t%1e3*1e3|0,0}},V=(function(){var e={a:N};function t(e,t){var n,r=e.exports;i.asm=r,l=i.asm.q,n=l.buffer,i.HEAP8=_=new Int8Array(n),i.HEAP16=new Int16Array(n),i.HEAP32=p=new Int32Array(n),i.HEAPU8=y=new Uint8Array(n),i.HEAPU16=new Uint16Array(n),i.HEAPU32=new Uint32Array(n),i.HEAPF32=new Float32Array(n),i.HEAPF64=new Float64Array(n),w=i.asm.s,function(e){if(k--,i.monitorRunDependencies&&i.monitorRunDependencies(k),0==k&&(null!==R&&(clearInterval(R),R=null),I)){var t=I;I=null,t()}}()}function n(e){t(e.instance)}function r(t){return(f||"function"!=typeof fetch?Promise.resolve().then((function(){return L(H)})):fetch(H,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at \'"+H+"\'";return e.arrayBuffer()})).catch((function(){return L(H)}))).then((function(t){return WebAssembly.instantiate(t,e)})).then(t,(function(e){v("failed to asynchronously prepare wasm: "+e),C(e)}))}if(k++,i.monitorRunDependencies&&i.monitorRunDependencies(k),i.instantiateWasm)try{return i.instantiateWasm(e,t)}catch(e){return v("Module.instantiateWasm callback failed with error: "+e),!1}f||"function"!=typeof WebAssembly.instantiateStreaming||S(H)||"function"!=typeof fetch?r(n):fetch(H,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(n,(function(e){return v("wasm streaming compile failed: "+e),v("falling back to ArrayBuffer instantiation"),r(n)}))}))}(),i.___wasm_call_ctors=function(){return(V=i.___wasm_call_ctors=i.asm.r).apply(null,arguments)});function z(e){function t(){W||(W=!0,i.calledRun=!0,m||(M(D),M(E),i.onRuntimeInitialized&&i.onRuntimeInitialized(),function(){if(i.postRun)for("function"==typeof i.postRun&&(i.postRun=[i.postRun]);i.postRun.length;)e=i.postRun.shift(),P.unshift(e);var e;M(P)}()))}e=e||s,k>0||(function(){if(i.preRun)for("function"==typeof i.preRun&&(i.preRun=[i.preRun]);i.preRun.length;)e=i.preRun.shift(),A.unshift(e);var e;M(A)}(),k>0||(i.setStatus?(i.setStatus("Running..."),setTimeout((function(){setTimeout((function(){i.setStatus("")}),1),t()}),1)):t()))}if(i._broadwayInit=function(){return(i._broadwayInit=i.asm.t).apply(null,arguments)},i._broadwayCreateStream=function(){return(i._broadwayCreateStream=i.asm.u).apply(null,arguments)},i._broadwayPlayStream=function(){return(i._broadwayPlayStream=i.asm.v).apply(null,arguments)},I=function e(){W||z(),W||(I=e)},i.run=z,i.preInit)for("function"==typeof i.preInit&&(i.preInit=[i.preInit]);i.preInit.length>0;)i.preInit.pop()();return z(),i}},{key:"onHeadersDecoded",get:function(){return this._onHeadersDecoded},set:function(e){this._onHeadersDecoded=e}},{key:"onPictureDecoded",get:function(){return this._onPictureDecoded},set:function(e){this._onPictureDecoded=e}}])&&l(t.prototype,n),r&&l(t,r),e}();function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var _=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._config=t,this._module=null,this._MAX_VIDEO_BUFFER_LENGTH=2097152,this._videoBuffer=null,this._bufferTotal=0,this._decodeBuffers={},this._onError=null,this._onFlvDecoded=null,this._vCache=[],this._initModule()}var t,n,r;return t=e,(n=[{key:"destroy",value:function(){this._module=null,this._onError=null,this._onFlvDecoded=null}},{key:"videoDecode",value:function(e){if(!(e.length>this._MAX_VIDEO_BUFFER_LENGTH))if(this._videoBuffer){if(this._vCache.length>0){for(var t=0;t<this._vCache.length;t++){var n=this._vCache[t];this._videoBuffer.set(n),this._bufferTotal+=n.length,this._module._broadwayPlayStream(n.length,this._bufferTotal)}this._vCache=[]}this._videoBuffer.set(e),this._bufferTotal+=e.length,this._module._broadwayPlayStream(e.length,this._bufferTotal)}else this._vCache.push(e)}},{key:"unPack",value:function(e){this.videoDecode(e)}},{key:"_initModule",value:function(){if(this._module=this._getModule(this._config.wasmFile),this._module)this._module.onRuntimeInitialized=this._onRuntimeInitialized.bind(this);else{var e={code:o,message:"init module exception"};this._onError&&this._onError(e)}}},{key:"_getModule",value:function(e){var t=new h;return t.onHeadersDecoded=this._onAsmHeadersDecoded.bind(this),t.onPictureDecoded=this._onAsmPictureDecoded.bind(this),t.initModule(e)}},{key:"_onRuntimeInitialized",value:function(){this._initDecoder()}},{key:"_initDecoder",value:function(){this._module._broadwayInit();var e=this._MAX_VIDEO_BUFFER_LENGTH;this._videoBuffer=this._toU8Array(this._module._broadwayCreateStream(e),e)}},{key:"_onAsmHeadersDecoded",value:function(){}},{key:"_onAsmPictureDecoded",value:function(e,t){var n=this._toU8Array(e,t);this._onFlvDecoded&&this._onFlvDecoded(new Uint8Array(n),t)}},{key:"_toU8Array",value:function(e,t){return this._module.HEAPU8.subarray(e,e+t)}},{key:"onError",get:function(){return this._onError},set:function(e){this._onError=e}},{key:"onFlvDecoded",get:function(){return this._onFlvDecoded},set:function(e){this._onFlvDecoded=e}}])&&v(t.prototype,n),r&&v(t,r),e}(),y="decode error",p="video data",m="audio data",g="flv data";function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var w=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._emitter=new i.a,this._config=t,this._ioHandler=null,this._decoder=null}var t,n,r;return t=e,(n=[{key:"destroy",value:function(){this._ioHandler&&(this._ioHandler.destroy(),this._ioHandler=null),this._decoder&&(this._decoder.destroy(),this._decoder=null),this._emitter.removeAllListeners(),this._emitter=null}},{key:"on",value:function(e,t){this._emitter.addListener(e,t)}},{key:"off",value:function(e,t){this._emitter.removeListener(e,t)}},{key:"decoder",value:function(e){this._decoder&&this._decoder.unPack(e)}},{key:"initDecoder",value:function(){this._initDecoder()}},{key:"close",value:function(){this._destroyDecoder()}},{key:"_internalAbort",value:function(){this._ioHandler&&(this._ioHandler.destroy(),this._ioHandler=null)}},{key:"_destroyDecoder",value:function(){this._decoder&&(this._decoder.destroy(),this._decoder=null)}},{key:"_initDecoder",value:function(){this._decoder||(1==this._config.renderType?(this._decoder=new f(this._config),this._decoder.onError=this._onDecodedError.bind(this),this._decoder.onVideoDecoded=this._onVideoDecoded.bind(this),this._decoder.onAudioDecoded=this._onAudioDecoded.bind(this)):2==this._config.renderType&&(this._decoder=new _(this._config),this._decoder.onError=this._onDecodedError.bind(this),this._decoder.onFlvDecoded=this._onFlvDecoded.bind(this)))}},{key:"_onDecodedError",value:function(e){this._emitter.emit(y,e)}},{key:"_onVideoDecoded",value:function(e,t,n,r){this._emitter.emit(p,e,t,n,r)}},{key:"_onAudioDecoded",value:function(e,t,n,r,i){this._emitter.emit(m,e,t,n,r,i)}},{key:"_onFlvDecoded",value:function(e,t){this._emitter.emit(g,e,t)}}])&&b(t.prototype,n),r&&b(t,r),e}();let A=null;function D(e){self.postMessage({msg:y,data:e})}function E(e,t,n,r){let i={msg:p,data:{timestamp:e,buffer:t,width:n,height:r}};t=null,self.postMessage(i)}function P(e,t,n,r,i){let o={msg:m,data:{timestamp:e,buffer:t,size:n,smaprate:r,channel:i}};t=null,self.postMessage(o)}function k(e,t){let n={msg:g,data:{buffer:e,len:t}};e=null,self.postMessage(n)}self.addEventListener("message",(function(e){switch(e.data.cmd){case"init":A=new w(e.data.param),A.on(y,D.bind(this)),A.on(p,E.bind(this)),A.on(m,P.bind(this)),A.on(g,k.bind(this));break;case"destroy":A&&(A.destroy(),A=null),self.postMessage({msg:"destroyed"});break;case"initDecoder":A.initDecoder();break;case"decoder":let t=e.data.param;A.decoder(t);break;case"close":A.close()}}))}]);',null)}},function(e,t,n){e.exports=function(){return n(2)('!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){"use strict";var r,i="object"==typeof Reflect?Reflect:null,o=i&&"function"==typeof i.apply?i.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};r=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var l=10;function u(e){if("function"!=typeof e)throw new TypeError(\'The "listener" argument must be of type Function. Received type \'+typeof e)}function f(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function h(e,t,n,r){var i,o,s;if(u(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),s=o[t]),void 0===s)s=o[t]=n,++e._eventsCount;else if("function"==typeof s?s=o[t]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),(i=f(e))>0&&s.length>i&&!s.warned){s.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=e,a.type=t,a.count=s.length,console&&console.warn}return e}function c(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=c.bind(r);return i.listener=n,r.wrapFn=i,i}function v(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):d(i,i.length)}function p(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function d(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError(\'The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received \'+e+".");l=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError(\'The value of "n" is out of range. It must be a non-negative number. Received \'+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return f(this)},a.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var l=i[e];if(void 0===l)return!1;if("function"==typeof l)o(l,this,t);else{var u=l.length,f=d(l,u);for(n=0;n<u;++n)o(f[n],this,t)}return!0},a.prototype.addListener=function(e,t){return h(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return h(this,e,t,!0)},a.prototype.once=function(e,t){return u(t),this.on(e,_(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){return u(t),this.prependListener(e,_(this,e,t)),this},a.prototype.removeListener=function(e,t){var n,r,i,o,s;if(u(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){s=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,s||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},a.prototype.listeners=function(e){return v(this,e,!0)},a.prototype.rawListeners=function(e){return v(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},a.prototype.listenerCount=p,a.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(e,t,n){"use strict";n.r(t);var r=n(0),i=n.n(r);function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=0,a=1,l=2,u=3,f=4,h=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._type=t||"undefined",this._status=s,this._onInit=null,this._onError=null,this._onFinished=null,this._onDataArrival=null,this._onFlow=null}var t,n,r;return t=e,(n=[{key:"destroy",value:function(){this._status=s,this._onInit=null,this._onError=null,this._onFinished=null,this._onDataArrival=null,this._onFlow=null}},{key:"open",value:function(e){}},{key:"send",value:function(e){}},{key:"abort",value:function(){}},{key:"type",get:function(){return this._type}},{key:"status",get:function(){return this._status}},{key:"onInitComplete",get:function(){return this._onInitComplete},set:function(e){this._onInitComplete=e}},{key:"onError",get:function(){return this._onError},set:function(e){this._onError=e}},{key:"onFinished",get:function(){return this._onFinished},set:function(e){this._onFinished=e}},{key:"onDataArrival",get:function(){return this._onDataArrival},set:function(e){this._onDataArrival=e}},{key:"onFlow",get:function(){return this._onFlow},set:function(e){this._onFlow=e}}])&&o(t.prototype,n),r&&o(t,r),e}();function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var _=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,r=[{key:"isWebsocketURL",value:function(e){return/wss?:\\/\\/(.+?)/.test(e)}}],(n=null)&&c(t.prototype,n),r&&c(t,r),e}(),v=-1,p=-2,d=-3,y=-5,m={"-1":"视频播放网络超时!","-2":"视频播放网络异常!","-3":"接收数据格式错误!","-4":"解码器异常!","-5":"不支持的播放URL!","-6":"MSE异常!"};function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var g=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._message=t}var t,n,r;return t=e,(n=[{key:"toString",value:function(){return this.name+": "+this.message}},{key:"name",get:function(){return"RuntimeException"}},{key:"message",get:function(){return this._message}}])&&b(t.prototype,n),r&&b(t,r),e}();function w(e){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function L(e,t,n){return(L="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=T(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function O(e,t){return(O=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function E(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=T(e);if(t){var i=T(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return F(this,n)}}function F(e,t){return!t||"object"!==w(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");return e}(e):t}function T(e){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var A=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&O(e,t)}(o,e);var t,n,r,i=E(o);function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=i.call(this,"WebSocketLoader"))._ws=null,t._heartTimer=null,t._requestAbort=!1,t._arrivalTime=(new Date).getTime(),t._timeoutTimer=null,t._timeout=e.timeout,t._bufferSize=0,t._flowTimer=null,t._flowInterval=1,t}return t=o,(n=[{key:"destroy",value:function(){this._ws&&this.abort(),this._timeout=null,this._bufferSize=null,this._flowInterval=null,this._ws=null,L(T(o.prototype),"destroy",this).call(this)}},{key:"open",value:function(e){try{var t=this._ws=new self.WebSocket(e);t.binaryType="arraybuffer",t.onopen=this._onWebSocketOpen.bind(this),t.onclose=this._onWebSocketClose.bind(this),t.onerror=this._onWebSocketError.bind(this),t.onmessage=this._onWebSocketMessage.bind(this),this._status=a}catch(e){this._status=u;var n={code:p,message:m[p],exception:e};this._onError&&this._onError(n)}}},{key:"send",value:function(e){this._requestAbort||this._ws.send(e)}},{key:"abort",value:function(){this._ws&&(this._ws.close(),this._requestAbort=!0),this._heartTimer&&(clearInterval(this._heartTimer),this._heartTimer=null),this._timeoutTimer&&(clearInterval(this._timeoutTimer),this._timeoutTimer=null),this._flowTimer&&(clearInterval(this._flowTimer),this._flowTimer=null),this._status=f}},{key:"_onWebSocketOpen",value:function(e){var t=this;this._status=l,this._onInitComplete&&this._onInitComplete(),this._heartTimer||(this._heartTimer=setInterval((function(){t.send("BeatBert")}),1e5)),this._timeoutHandler(),this._flowHandler()}},{key:"_onWebSocketClose",value:function(e){!0!==this._requestAbort?(this._status=f,this._onComplete&&this._onComplete()):this._requestAbort=!1}},{key:"_onWebSocketError",value:function(e){this._status=u;var t={code:p,message:m[p],exception:e};this._onError&&this._onError(t)}},{key:"_onWebSocketMessage",value:function(e){if(this._arrivalTime=(new Date).getTime(),e.data instanceof ArrayBuffer)this._dispatchArrayBuffer(new Uint8Array(e.data));else{this._status=u;var t={code:d,message:m[d]};this._onError&&this._onError(t)}}},{key:"_dispatchArrayBuffer",value:function(e){this._bufferSize+=e.length,this._onDataArrival&&this._onDataArrival(e)}},{key:"_timeoutHandler",value:function(){var e=this;this._timeoutTimer||(this._timeoutTimer=setInterval((function(){if((new Date).getTime()-e._arrivalTime>1e3*e._timeout){var t={code:v,message:m[v]};e._onError&&e._onError(t)}}),1e4))}},{key:"_flowHandler",value:function(){var e=this;this._flowTimer||(this._flowTimer=setInterval((function(){if(e._onFlow){var t=Math.round(e._bufferSize/1024);e._onFlow(t)}}),1e3*this._flowInterval))}}])&&k(t.prototype,n),r&&k(t,r),o}(h);function C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var j=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._config=n,this._playUrl=t,this._param={},this._loader=null,this._loaderClass=null,this._onDataArrival=null,this._onError=null,this._onFinished=null,this._onFlow=null}var t,n,r;return t=e,(n=[{key:"destroy",value:function(){this._playUrl=null,this._param=null,this._loader&&(this._loader.destroy(),this._loader=null),this._onDataArrival=null,this._onError=null,this._onFinished=null,this._onFlow=null}},{key:"_initLoader",value:function(){if(_.isWebsocketURL(this._playUrl))this._loaderClass=A,this._urlParam();else{var e={code:y,message:m[y]};this._onLoaderError(e)}}},{key:"_createLoader",value:function(){this._initLoader(),this._loaderClass&&(this._loader=new this._loaderClass(this._config),this._loader.onInitComplete=this._onInitComplete.bind(this),this._loader.onError=this._onLoaderError.bind(this),this._loader.onFinished=this._onLoaderFinished.bind(this),this._loader.onDataArrival=this._onLoaderDataArrival.bind(this),this._loader.onFlow=this._onLoaderFlow.bind(this))}},{key:"open",value:function(){this._createLoader(),this._loader&&this._loader.open(this._playUrl)}},{key:"abort",value:function(){this._loader.abort()}},{key:"send",value:function(e){e&&this._loader.send(e)}},{key:"_urlParam",value:function(){var e=this._playUrl;if(-1!==e.indexOf("?")){var t=e.split("?"),n=t[0];this._playUrl=n;var r={},i=t[1];if(i&&i.length>0){var o=i.split("&");if(o&&o.length>0)for(var s=0;s<o.length;s++){var a=o[s].split("=");r[a[0].toLowerCase()]=a[1]}}this._param=r}}},{key:"_onInitComplete",value:function(){_.isWebsocketURL(this._playUrl)&&this._loader.send(this._param.sessionid)}},{key:"_onLoaderError",value:function(e){if(!this._onError)throw new g("IOException: "+e);this._onError(e)}},{key:"_onLoaderFinished",value:function(){this._onFinished&&this._onFinished()}},{key:"_onLoaderDataArrival",value:function(e){this._onDataArrival&&this._onDataArrival(e)}},{key:"_onLoaderFlow",value:function(e){this._onFlow&&this._onFlow(e)}},{key:"onDataArrival",get:function(){return this._onDataArrival},set:function(e){this._onDataArrival=e}},{key:"onError",get:function(){return this._onError},set:function(e){this._onError=e}},{key:"onFinished",get:function(){return this._onFinished},set:function(e){this._onFinished=e}},{key:"onFlow",get:function(){return this._onFlow},set:function(e){this._onFlow=e}}])&&C(t.prototype,n),r&&C(t,r),e}(),S="io error",x="loading finished",I="network flow",P="io data arrival";function D(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var R=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._emitter=new i.a,this._ioHandler=null}var t,n,r;return t=e,(n=[{key:"destroy",value:function(){this._ioHandler&&(this._ioHandler.destroy(),this._ioHandler=null),this._emitter.removeAllListeners(),this._emitter=null}},{key:"on",value:function(e,t){this._emitter.addListener(e,t)}},{key:"off",value:function(e,t){this._emitter.removeListener(e,t)}},{key:"open",value:function(e,t){this._createLoader(e,t)}},{key:"close",value:function(){this._internalAbort()}},{key:"_createLoader",value:function(e,t){this._ioHandler=new j(e,t),this._ioHandler.onError=this._onIOException.bind(this),this._ioHandler.onFinished=this._onIOFinished.bind(this),this._ioHandler.onDataArrival=this._onIODataArrival.bind(this),this._ioHandler.onFlow=this._onIOFlow.bind(this),this._ioHandler.open()}},{key:"_internalAbort",value:function(){this._ioHandler&&(this._ioHandler.destroy(),this._ioHandler=null)}},{key:"_onIOException",value:function(e){this._emitter.emit(S,e)}},{key:"_onIOFinished",value:function(){this._emitter.emit(x)}},{key:"_onIODataArrival",value:function(e){this._emitter.emit(P,e)}},{key:"_onIOFlow",value:function(e){this._emitter.emit(I,e)}}])&&D(t.prototype,n),r&&D(t,r),e}();let M=null;function H(e){self.postMessage({msg:S,data:e})}function U(){let e={msg:x,data:{}};self.postMessage(e)}function W(e){self.postMessage({msg:I,data:e})}function N(e){self.postMessage({msg:P,data:e})}self.addEventListener("message",(function(e){switch(e.data.cmd){case"init":M=new R,M.on(S,H.bind(this)),M.on(x,U.bind(this)),M.on(I,W.bind(this)),M.on(P,N.bind(this));break;case"destroy":M&&(M.destroy(),M=null),self.postMessage({msg:"destroyed"});break;case"open":let t=e.data.param;M.open(t.playUrl,t.config);break;case"close":M.close()}}))}]);',null)}},function(e,t,n){e.exports=function(){return n(2)('!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t,r){"use strict";var n,i="object"==typeof Reflect?Reflect:null,o=i&&"function"==typeof i.apply?i.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};n=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!=e};function u(){u.init.call(this)}e.exports=u,u.EventEmitter=u,u.prototype._events=void 0,u.prototype._eventsCount=0,u.prototype._maxListeners=void 0;var s=10;function f(e){if("function"!=typeof e)throw new TypeError(\'The "listener" argument must be of type Function. Received type \'+typeof e)}function l(e){return void 0===e._maxListeners?u.defaultMaxListeners:e._maxListeners}function c(e,t,r,n){var i,o,a;if(f(r),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),o=e._events),a=o[t]),void 0===a)a=o[t]=r,++e._eventsCount;else if("function"==typeof a?a=o[t]=n?[r,a]:[a,r]:n?a.unshift(r):a.push(r),(i=l(e))>0&&a.length>i&&!a.warned){a.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=a.length,console&&console.warn}return e}function v(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=v.bind(n);return i.listener=r,n.wrapFn=i,i}function p(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):y(i,i.length)}function _(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function y(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}Object.defineProperty(u,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError(\'The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received \'+e+".");s=e}}),u.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},u.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError(\'The value of "n" is out of range. It must be a non-negative number. Received \'+e+".");return this._maxListeners=e,this},u.prototype.getMaxListeners=function(){return l(this)},u.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,i=this._events;if(void 0!==i)n=n&&void 0===i.error;else if(!n)return!1;if(n){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var u=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw u.context=a,u}var s=i[e];if(void 0===s)return!1;if("function"==typeof s)o(s,this,t);else{var f=s.length,l=y(s,f);for(r=0;r<f;++r)o(l[r],this,t)}return!0},u.prototype.addListener=function(e,t){return c(this,e,t,!1)},u.prototype.on=u.prototype.addListener,u.prototype.prependListener=function(e,t){return c(this,e,t,!0)},u.prototype.once=function(e,t){return f(t),this.on(e,h(this,e,t)),this},u.prototype.prependOnceListener=function(e,t){return f(t),this.prependListener(e,h(this,e,t)),this},u.prototype.removeListener=function(e,t){var r,n,i,o,a;if(f(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,o=r.length-1;o>=0;o--)if(r[o]===t||r[o].listener===t){a=r[o].listener,i=o;break}if(i<0)return this;0===i?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,a||t)}return this},u.prototype.off=u.prototype.removeListener,u.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var i,o=Object.keys(r);for(n=0;n<o.length;++n)"removeListener"!==(i=o[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},u.prototype.listeners=function(e){return p(this,e,!0)},u.prototype.rawListeners=function(e){return p(this,e,!1)},u.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):_.call(e,t)},u.prototype.listenerCount=_,u.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]}},function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}r.r(t);var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._canvas=t||new OffscreenCanvas(1920,1080)}var t,r,i;return t=e,(r=[{key:"destroy",value:function(){}},{key:"draw",value:function(e,t,r){}},{key:"clearDraw",value:function(){}}])&&n(t.prototype,r),i&&n(t,i),e}();function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._message=t}var t,r,n;return t=e,(r=[{key:"toString",value:function(){return this.name+": "+this.message}},{key:"name",get:function(){return"RuntimeException"}},{key:"message",get:function(){return this._message}}])&&o(t.prototype,r),n&&o(t,n),e}(),u=r(0),s=r.n(u);function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function v(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=p(e);if(t){var i=p(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return h(this,r)}}function h(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");return e}(e):t}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var _=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(o,e);var t,r,n,i=v(o);function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=i.call(this,e))._offscreen=!e,t._emitter=new s.a,t._webGL=null,t._shaderProgram=null,t._texturePosBuffer=null,t._uTexturePosBuffer=null,t._vTexturePosBuffer=null,t._yTextureRef=null,t._uTextureRef=null,t._vTextureRef=null,t._init(),t.clearDraw(),t}return t=o,(r=[{key:"on",value:function(e,t){this._emitter.addListener(e,t)}},{key:"off",value:function(e,t){this._emitter.removeListener(e,t)}},{key:"destroy",value:function(){this._emitter.removeAllListeners(),this._emitter=null,this._webGL&&this.clearDraw(),this._webGL=null,this._shaderProgram=null,this._texturePosBuffer=null,this._uTexturePosBuffer=null,this._vTexturePosBuffer=null,this._yTextureRef=null,this._uTextureRef=null,this._vTextureRef=null,this._canvas=null}},{key:"draw",value:function(e,t,r){this._offscreen&&(this._canvas.width=t,this._canvas.height=r);var n=t*r,i=n/4,o={yData:e.subarray(0,n),uData:e.subarray(n,n+i),vData:e.subarray(n+i,n+i+i)};if(this._drawWebGL(o,t,r),this._offscreen){var a=this._canvas.transferToImageBitmap();this._emitter.emit("image",a)}}},{key:"_drawWebGL",value:function(e,t,r){var n=this._webGL,i=e.yData,o=e.uData,a=e.vData,u=this._texturePosBuffer,s=this._uTexturePosBuffer,f=this._vTexturePosBuffer,l=this._yTextureRef,c=this._uTextureRef,v=this._vTextureRef,h=this._canvas.width,p=this._canvas.height,_=h,y=p,m=h/2,d=p/2,b=m,T=d;n.viewport(0,0,h,p);var g=p/y,x=h/_,R=new Float32Array([x,0,0,0,x,g,0,g]);n.bindBuffer(n.ARRAY_BUFFER,u),n.bufferData(n.ARRAY_BUFFER,R,n.DYNAMIC_DRAW),g=p/2/d,x=h/2/m;var E=new Float32Array([x,0,0,0,x,g,0,g]);n.bindBuffer(n.ARRAY_BUFFER,s),n.bufferData(n.ARRAY_BUFFER,E,n.DYNAMIC_DRAW),x=h/2/b,g=p/2/T;var A=new Float32Array([x,0,0,0,x,g,0,g]);n.bindBuffer(n.ARRAY_BUFFER,f),n.bufferData(n.ARRAY_BUFFER,A,n.DYNAMIC_DRAW),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,l),n.texImage2D(n.TEXTURE_2D,0,n.LUMINANCE,_,y,0,n.LUMINANCE,n.UNSIGNED_BYTE,i),n.activeTexture(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,c),n.texImage2D(n.TEXTURE_2D,0,n.LUMINANCE,m,d,0,n.LUMINANCE,n.UNSIGNED_BYTE,o),n.activeTexture(n.TEXTURE2),n.bindTexture(n.TEXTURE_2D,v),n.texImage2D(n.TEXTURE_2D,0,n.LUMINANCE,b,T,0,n.LUMINANCE,n.UNSIGNED_BYTE,a),n.drawArrays(n.TRIANGLE_STRIP,0,4)}},{key:"clearDraw",value:function(){var e=this._webGL;e.clearColor(0,0,0,1),e.clear(e.COLOR_BUFFER_BIT)}},{key:"_init",value:function(){if(this._initContextGL(),!this._webGL)throw new a("init webgl fail!");this._initProgram(),this._initBuffer(),this._initTextures()}},{key:"_initContextGL",value:function(){var e={antialias:!0,preserveDrawingBuffer:!0};this._webGL=this._canvas.getContext("webgl",e)||this._canvas.getContext("experimental-webgl",e)}},{key:"_initProgram",value:function(){var e=this._webGL,t=["attribute vec4 vertexPos;","attribute vec4 texturePos;","attribute vec4 uTexturePos;","attribute vec4 vTexturePos;","varying vec2 textureCoord;","varying vec2 uTextureCoord;","varying vec2 vTextureCoord;","void main()","{","  gl_Position = vertexPos;","  textureCoord = texturePos.xy;","  uTextureCoord = uTexturePos.xy;","  vTextureCoord = vTexturePos.xy;","}"].join("\\n"),r=["precision highp float;","varying highp vec2 textureCoord;","varying highp vec2 uTextureCoord;","varying highp vec2 vTextureCoord;","uniform sampler2D ySampler;","uniform sampler2D uSampler;","uniform sampler2D vSampler;","uniform mat4 YUV2RGB;","void main(void) {","  highp float y = texture2D(ySampler,  textureCoord).r;","  highp float u = texture2D(uSampler,  uTextureCoord).r;","  highp float v = texture2D(vSampler,  vTextureCoord).r;","  gl_FragColor = vec4(y, u, v, 1) * YUV2RGB;","}"].join("\\n"),n=e.createShader(e.VERTEX_SHADER);if(e.shaderSource(n,t),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw new a("Vertex shader failed to compile: "+e.getShaderInfoLog(n));var i=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(i,r),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS))throw new a("Fragment shader failed to compile: "+e.getShaderInfoLog(i));var o=e.createProgram();if(e.attachShader(o,n),e.attachShader(o,i),e.linkProgram(o),!e.getProgramParameter(o,e.LINK_STATUS))throw new a("Program failed to compile: "+e.getProgramInfoLog(o));e.useProgram(o);var u=e.getUniformLocation(o,"YUV2RGB");e.uniformMatrix4fv(u,!1,[1.16438,0,1.59603,-.87079,1.16438,-.39176,-.81297,.52959,1.16438,2.01723,0,-1.08139,0,0,0,1]),this._shaderProgram=o}},{key:"_initBuffer",value:function(){var e=this._webGL,t=this._shaderProgram,r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,-1,-1]),e.STATIC_DRAW);var n=e.getAttribLocation(t,"vertexPos");e.enableVertexAttribArray(n),e.vertexAttribPointer(n,2,e.FLOAT,!1,0,0);var i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),e.STATIC_DRAW);var o=e.getAttribLocation(t,"texturePos");e.enableVertexAttribArray(o),e.vertexAttribPointer(o,2,e.FLOAT,!1,0,0),this._texturePosBuffer=i;var a=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,a),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),e.STATIC_DRAW);var u=e.getAttribLocation(t,"uTexturePos");e.enableVertexAttribArray(u),e.vertexAttribPointer(u,2,e.FLOAT,!1,0,0),this._uTexturePosBuffer=a;var s=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,s),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),e.STATIC_DRAW);var f=e.getAttribLocation(t,"vTexturePos");e.enableVertexAttribArray(f),e.vertexAttribPointer(f,2,e.FLOAT,!1,0,0),this._vTexturePosBuffer=s}},{key:"_initTextures",value:function(){var e=this._webGL,t=this._shaderProgram,r=this._createTexture(),n=e.getUniformLocation(t,"ySampler");e.uniform1i(n,0),this._yTextureRef=r;var i=this._createTexture(),o=e.getUniformLocation(t,"uSampler");e.uniform1i(o,1),this._uTextureRef=i;var a=this._createTexture(),u=e.getUniformLocation(t,"vSampler");e.uniform1i(u,2),this._vTextureRef=a}},{key:"_createTexture",value:function(){var e=this._webGL,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),t}}])&&l(t.prototype,r),n&&l(t,n),o}(i);let y=null;function m(e){self.postMessage({msg:"image",data:e})}self.addEventListener("message",(function(e){switch(e.data.cmd){case"init":y=new _,y.on("image",m.bind(this));break;case"destroy":y.destroy();break;case"draw":y.draw(e.data.params.buffer,e.data.params.width,e.data.params.height);break;case"clearDraw":y.clearDraw()}}))}]);',null)}},function(e,t,n){e.exports=n(9).default},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var i=n(0),r=n.n(i),o=-1,s=-2,a=-3,u=-4,l=-5,h={"-1":"视频播放网络超时!","-2":"视频播放网络异常!","-3":"接收数据格式错误!","-4":"解码器异常!","-5":"不支持的播放URL!","-6":"MSE异常!"};function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var f=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._onHeadersDecoded=null,this._onPictureDecoded=null,this._onAudioDecoded=null}var t,n,i;return t=e,(n=[{key:"destroy",value:function(){this._onHeadersDecoded=null,this._onPictureDecoded=null,this._onAudioDecoded=null}},{key:"getModule",value:function(e){return this._getModule(this._onHeadersDecoded,this._onPictureDecoded,this._onAudioDecoded,e)}},{key:"_getModule",value:function(e,t,n,i){var r,o=void 0!==o?o:{},s={};for(r in o)o.hasOwnProperty(r)&&(s[r]=o[r]);var a,u=[],l="./this.program",h="";h=0!==(h=self.location.href).indexOf("blob:")?h.substr(0,h.lastIndexOf("/")+1):"",a=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)};var d,f,_=o.print||function(e){},v=o.printErr||function(e){};for(r in s)s.hasOwnProperty(r)&&(o[r]=s[r]);s=null,o.arguments&&(u=o.arguments),o.thisProgram&&(l=o.thisProgram),o.quit&&o.quit,o.wasmBinary&&(d=o.wasmBinary),o.noExitRuntime,"object"!==("undefined"==typeof WebAssembly?"undefined":c(WebAssembly))&&C("no native wasm support detected");var m,p,y,g=!1,b="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function w(e,t,n){for(var i=t+n,r=t;e[r]&&!(r>=i);)++r;if(r-t>16&&e.subarray&&b)return b.decode(e.subarray(t,r));for(var o="";t<r;){var s=e[t++];if(128&s){var a=63&e[t++];if(192!=(224&s)){var u=63&e[t++];if((s=224==(240&s)?(15&s)<<12|a<<6|u:(7&s)<<18|a<<12|u<<6|63&e[t++])<65536)o+=String.fromCharCode(s);else{var l=s-65536;o+=String.fromCharCode(55296|l>>10,56320|1023&l)}}else o+=String.fromCharCode((31&s)<<6|a)}else o+=String.fromCharCode(s)}return o}o.INITIAL_MEMORY;var k,E=[],D=[],S=[],A=[];D.push({func:function(){z()}});var T=0,x=null,R=null;function C(e){throw o.onAbort&&o.onAbort(e),v(e+=""),g=!0,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.",new WebAssembly.RuntimeError(e)}function L(e){return t=e,n="data:application/octet-stream;base64,",String.prototype.startsWith?t.startsWith(n):0===t.indexOf(n);var t,n}o.preloadedImages={},o.preloadedAudios={};var I,U,B=i||"libvideo.wasm";function P(e){try{if(e==B&&d)return new Uint8Array(d);if(a)return a(e);throw"both async and sync fetching of the wasm failed"}catch(e){C(e)}}function O(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var n=t.func;"number"==typeof n?void 0===t.arg?k.get(n)():k.get(n)(t.arg):n(void 0===t.arg?null:t.arg)}else t(o)}}L(B)||(U=B,String.prototype.startsWith?U.startsWith("http"):0===U.indexOf("http"))||(I=B,B=o.locateFile?o.locateFile(I,h):h+I);var F={mappings:{},buffers:[null,[],[]],printChar:function(e,t){var n=F.buffers[e];0===t||10===t?((1===e?_:v)(w(n,0)),n.length=0):n.push(t)},varargs:void 0,get:function(){return F.varargs+=4,y[F.varargs-4>>2]},getStr:function(e){return function(e,t){return e?w(p,e,t):""}(e)},get64:function(e,t){return e}};function M(){e()}function H(e,n,i,r){t(e,n,i,r)}o._broadwayOnHeadersDecoded=M,o._broadwayOnPictureDecoded=H;var j={};function W(){if(!W.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"===("undefined"==typeof navigator?"undefined":c(navigator))&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:l||"./this.program"};for(var t in j)e[t]=j[t];var n=[];for(var t in e)n.push(t+"="+e[t]);W.strings=n}return W.strings}function N(e,t,i,r,o){n(e,t,i,r,o)}o._onAudioDec=N;var V,G={g:function(e,t,n){return F.varargs=n,0},s:function(e,t,n){F.varargs=n},a:function(){C()},i:M,h:H,l:function e(){return void 0===e.start&&(e.start=Date.now()),1e3*(Date.now()-e.start)|0},m:function(e,t,n){p.copyWithin(e,t,t+n)},n:function(e){C("OOM")},o:function(e,t){var n=0;return W().forEach((function(i,r){var o=t+n;y[e+4*r>>2]=o,function(e,t,n){for(var i=0;i<e.length;++i)m[t++>>0]=e.charCodeAt(i);n||(m[t>>0]=0)}(i,o),n+=i.length+1})),0},p:function(e,t){var n=W();y[e>>2]=n.length;var i=0;return n.forEach((function(e){i+=e.length+1})),y[t>>2]=i,0},f:function(e){return 0},q:function(e,t){var n=1==e||2==e?2:C();return m[t>>0]=n,0},r:function(e,t,n,i){var r=F.getStreamFromFD(e),o=F.doReadv(r,t,n);return y[i>>2]=o,0},k:function(e,t,n,i,r){},e:function(e,t,n,i){for(var r=0,o=0;o<n;o++){for(var s=y[t+8*o>>2],a=y[t+(8*o+4)>>2],u=0;u<a;u++)F.printChar(e,p[s+u]);r+=a}return y[i>>2]=r,0},t:function(e){var t=Date.now();return y[e>>2]=t/1e3|0,y[e+4>>2]=t%1e3*1e3|0,0},b:N,c:function(){return 6},d:function(){return 28},j:function(e){switch(e){case 30:return 16384;case 85:return p.length/16384;case 132:case 133:case 12:case 137:case 138:case 15:case 235:case 16:case 17:case 18:case 19:case 20:case 149:case 13:case 10:case 236:case 153:case 9:case 21:case 22:case 159:case 154:case 14:case 77:case 78:case 139:case 82:case 68:case 67:case 164:case 11:case 29:case 47:case 48:case 95:case 52:case 51:case 46:return 200809;case 27:case 246:case 127:case 128:case 23:case 24:case 160:case 161:case 181:case 182:case 242:case 183:case 184:case 243:case 244:case 245:case 165:case 178:case 179:case 49:case 50:case 168:case 169:case 175:case 170:case 171:case 172:case 97:case 76:case 32:case 173:case 35:case 80:case 81:case 79:return-1;case 176:case 177:case 7:case 155:case 8:case 157:case 125:case 126:case 92:case 93:case 129:case 130:case 131:case 94:case 91:return 1;case 74:case 60:case 69:case 70:case 4:return 1024;case 31:case 42:case 72:return 32;case 87:case 26:case 33:return 2147483647;case 34:case 1:return 47839;case 38:case 36:return 99;case 43:case 37:return 2048;case 0:return 2097152;case 3:return 65536;case 28:return 32768;case 44:return 32767;case 75:return 16384;case 39:return 1e3;case 89:return 700;case 71:return 256;case 40:return 255;case 2:return 100;case 180:return 64;case 25:return 20;case 5:return 16;case 6:return 6;case 73:return 4;case 84:return"object"===("undefined"==typeof navigator?"undefined":c(navigator))&&navigator.hardwareConcurrency||1}var t;return t=28,y[$()>>2]=t,-1}},z=(function(){var e={a:G};function t(e,t){var n,i=e.exports;o.asm=i,f=o.asm.u,n=f.buffer,o.HEAP8=m=new Int8Array(n),o.HEAP16=new Int16Array(n),o.HEAP32=y=new Int32Array(n),o.HEAPU8=p=new Uint8Array(n),o.HEAPU16=new Uint16Array(n),o.HEAPU32=new Uint32Array(n),o.HEAPF32=new Float32Array(n),o.HEAPF64=new Float64Array(n),k=o.asm.w,function(e){if(T--,o.monitorRunDependencies&&o.monitorRunDependencies(T),0==T&&(null!==x&&(clearInterval(x),x=null),R)){var t=R;R=null,t()}}()}function n(e){t(e.instance)}function i(t){return(d||"function"!=typeof fetch?Promise.resolve().then((function(){return P(B)})):fetch(B,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+B+"'";return e.arrayBuffer()})).catch((function(){return P(B)}))).then((function(t){return WebAssembly.instantiate(t,e)})).then(t,(function(e){v("failed to asynchronously prepare wasm: "+e),C(e)}))}if(T++,o.monitorRunDependencies&&o.monitorRunDependencies(T),o.instantiateWasm)try{return o.instantiateWasm(e,t)}catch(e){return v("Module.instantiateWasm callback failed with error: "+e),!1}d||"function"!=typeof WebAssembly.instantiateStreaming||L(B)||"function"!=typeof fetch?i(n):fetch(B,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(n,(function(e){return v("wasm streaming compile failed: "+e),v("falling back to ArrayBuffer instantiation"),i(n)}))}))}(),o.___wasm_call_ctors=function(){return(z=o.___wasm_call_ctors=o.asm.v).apply(null,arguments)}),$=o.___errno_location=function(){return($=o.___errno_location=o.asm.x).apply(null,arguments)};function q(e){function t(){V||(V=!0,o.calledRun=!0,g||(O(D),O(S),o.onRuntimeInitialized&&o.onRuntimeInitialized(),function(){if(o.postRun)for("function"==typeof o.postRun&&(o.postRun=[o.postRun]);o.postRun.length;)e=o.postRun.shift(),A.unshift(e);var e;O(A)}()))}e=e||u,T>0||(function(){if(o.preRun)for("function"==typeof o.preRun&&(o.preRun=[o.preRun]);o.preRun.length;)e=o.preRun.shift(),E.unshift(e);var e;O(E)}(),T>0||(o.setStatus?(o.setStatus("Running..."),setTimeout((function(){setTimeout((function(){o.setStatus("")}),1),t()}),1)):t()))}if(o._broadwayInit=function(){return(o._broadwayInit=o.asm.y).apply(null,arguments)},o._broadwayCreateStream=function(){return(o._broadwayCreateStream=o.asm.z).apply(null,arguments)},o._broadwayPlayStream=function(){return(o._broadwayPlayStream=o.asm.A).apply(null,arguments)},R=function e(){V||q(),V||(R=e)},o.run=q,o.preInit)for("function"==typeof o.preInit&&(o.preInit=[o.preInit]);o.preInit.length>0;)o.preInit.pop()();return q(),o}},{key:"onHeadersDecoded",get:function(){return this._onHeadersDecoded},set:function(e){this._onHeadersDecoded=e}},{key:"onPictureDecoded",get:function(){return this._onPictureDecoded},set:function(e){this._onPictureDecoded=e}},{key:"onAudioDecoded",get:function(){return this._onAudioDecoded},set:function(e){this._onAudioDecoded=e}}])&&d(t.prototype,n),i&&d(t,i),e}();function _(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var v=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._config=t,this._module=null,this._MAX_VIDEO_BUFFER_LENGTH=3145728,this._videoBuffer=null,this._bufferTotal=0,this._decodeBuffers={},this._vTimestamp=0,this._MAX_AUDIO_BUFFER_LENGTH=51200,this._audioBuffer=null,this._decodeAudioBuffers={},this._aTimestamp=0,this._isInitAudio=!1,this._onError=null,this._onAudioDecoded=null,this._onVideoDecoded=null,this._tempTime=null,this._vCache=[],this._aCache=[],this._initModule()}var t,n,i;return t=e,(n=[{key:"destroy",value:function(){this._module=null,this._videoBuffer=null,this._decodeBuffers=null,this._vTimestamp=0,this._audioBuffer=null,this._decodeAudioBuffers=null,this._aTimestamp=0,this._isInitAudio=!1,this._onError=null,this._onInitCompleted=null,this._onVideoDecoded=null,this._onAudioDecoded=null,this._vCache=[],this._aCache=[]}},{key:"videoDecode",value:function(e){if(this._videoBuffer){if(this._vCache.length>0){for(var t=0;t<this._vCache.length;t++){var n=this._vCache[t];this._videoBuffer.set(n),this._bufferTotal+=n.length,this._module._broadwayPlayStream(n.length,this._bufferTotal)}this._vCache=[]}this._videoBuffer.set(e),this._bufferTotal+=e.length,this._module._broadwayPlayStream(e.length,this._bufferTotal)}else this._vCache.push(e)}},{key:"audioInit",value:function(e,t){this._audioBuffer&&(this._audioBuffer.set(e),this._module._AudioInit(e.length,t))}},{key:"audioDecode",value:function(e){this._audioBuffer.set(e),this._module._aacStream(e.length)}},{key:"unPack",value:function(e){this.videoDecode(e)}},{key:"_initModule",value:function(){if(this._module=this._getModule(this._config.wasmFile),this._module)this._module.onRuntimeInitialized=this._onRuntimeInitialized.bind(this);else{var e={code:u,message:"init module exception"};this._onError&&this._onError(e)}}},{key:"_getModule",value:function(e){var t=new f;return t.onHeadersDecoded=this._onAsmHeadersDecoded.bind(this),t.onPictureDecoded=this._onAsmPictureDecoded.bind(this),t.onAudioDecoded=this._onAsmAudioDecoded.bind(this),t.getModule(e)}},{key:"_onRuntimeInitialized",value:function(){this._initDecoder()}},{key:"_initDecoder",value:function(){this._module._broadwayInit();var e=this._MAX_VIDEO_BUFFER_LENGTH;this._videoBuffer=this._toU8Array(this._module._broadwayCreateStream(e),e)}},{key:"_onAsmHeadersDecoded",value:function(){}},{key:"_onAsmPictureDecoded",value:function(e,t,n,i){var r=this._decodeBuffers[e];r||(r=this._decodeBuffers[e]=this._toU8Array(e,t*n*3/2)),this._onVideoDecoded&&this._onVideoDecoded(i,new Uint8Array(r.slice(0,r.length)),t,n)}},{key:"_onAsmAudioDecoded",value:function(e,t,n,i,r){var o=this._decodeAudioBuffers[e];o||(o=this._decodeAudioBuffers[e]=this._toU8Array(e,t)),this._onAudioDecoded&&this._onAudioDecoded(r,new Uint8Array(o.slice(0,o.length)),t,n,i)}},{key:"_parseAudioData",value:function(e){var t=0;e[t],t+=1;var n=e.slice(t,t+4);t+=4;var i={audioType:n[0],smaprate:n[1],smapwidth:n[2],channel:n[3]},r=e.slice(t,t+4),o=this._uint8Array2Int32(r);this._aTimestamp=o,t+=4;var s=e.slice(t,t+4);this._uint8Array2Int32(s),t+=4;var a=e.slice(t,e.length);10==i.audioType||this._isInitAudio||(this.audioInit(a,i.audioType),this._isInitAudio=!0),this.audioDecode(a)}},{key:"_parseVideoData",value:function(e){var t=0,n=e.slice(t,t+4),i=this._uint8Array2Int32(n);this._vTimestamp=i,t+=4;var r=e.slice(t,t+4);this._uint8Array2Int32(r),t+=4;var o=e.slice(t,e.length);this.videoDecode(o)}},{key:"_toU8Array",value:function(e,t){return this._module.HEAPU8.subarray(e,e+t)}},{key:"_uint8Array2Int32",value:function(e){return 4!=e.length?0:255&e[0]|e[1]<<8&65280|e[2]<<16&16711680|e[3]<<24&4278190080}},{key:"onError",get:function(){return this._onError},set:function(e){this._onError=e}},{key:"onInitCompleted",get:function(){return this._onInitCompleted},set:function(e){this._onInitCompleted=e}},{key:"onVideoDecoded",get:function(){return this._onVideoDecoded},set:function(e){this._onVideoDecoded=e}},{key:"onAudioDecoded",get:function(){return this._onAudioDecoded},set:function(e){this._onAudioDecoded=e}}])&&_(t.prototype,n),i&&_(t,i),e}();function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var y=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._onHeadersDecoded=null,this._onPictureDecoded=null}var t,n,i;return t=e,(n=[{key:"destroy",value:function(){this._onHeadersDecoded=null,this._onPictureDecoded=null}},{key:"initModule",value:function(e){return this._module(this.onHeadersDecoded,this._onPictureDecoded,e)}},{key:"_module",value:function(e,t,n){var i,r=void 0!==r?r:{},o={};for(i in r)r.hasOwnProperty(i)&&(o[i]=r[i]);var s,a=[],u="./this.program",l="";l=0!==(l=self.location.href).indexOf("blob:")?l.substr(0,l.lastIndexOf("/")+1):"",s=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)};var h,c,d=r.print||function(e){},f=r.printErr||function(e){};for(i in o)o.hasOwnProperty(i)&&(r[i]=o[i]);o=null,r.arguments&&(a=r.arguments),r.thisProgram&&(u=r.thisProgram),r.quit&&r.quit,r.wasmBinary&&(h=r.wasmBinary),r.noExitRuntime,"object"!==("undefined"==typeof WebAssembly?"undefined":m(WebAssembly))&&R("no native wasm support detected");var _,v,p,y=!1,g="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function b(e,t,n){for(var i=t+n,r=t;e[r]&&!(r>=i);)++r;if(r-t>16&&e.subarray&&g)return g.decode(e.subarray(t,r));for(var o="";t<r;){var s=e[t++];if(128&s){var a=63&e[t++];if(192!=(224&s)){var u=63&e[t++];if((s=224==(240&s)?(15&s)<<12|a<<6|u:(7&s)<<18|a<<12|u<<6|63&e[t++])<65536)o+=String.fromCharCode(s);else{var l=s-65536;o+=String.fromCharCode(55296|l>>10,56320|1023&l)}}else o+=String.fromCharCode((31&s)<<6|a)}else o+=String.fromCharCode(s)}return o}r.INITIAL_MEMORY;var w,k=[],E=[],D=[],S=[];E.push({func:function(){V()}});var A=0,T=null,x=null;function R(e){throw r.onAbort&&r.onAbort(e),f(e+=""),y=!0,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.",new WebAssembly.RuntimeError(e)}function C(e){return t=e,n="data:application/octet-stream;base64,",String.prototype.startsWith?t.startsWith(n):0===t.indexOf(n);var t,n}r.preloadedImages={},r.preloadedAudios={};var L,I,U=n||"libvideoflv.wasm";function B(e){try{if(e==U&&h)return new Uint8Array(h);if(s)return s(e);throw"both async and sync fetching of the wasm failed"}catch(e){R(e)}}function P(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var n=t.func;"number"==typeof n?void 0===t.arg?w.get(n)():w.get(n)(t.arg):n(void 0===t.arg?null:t.arg)}else t(r)}}C(U)||(I=U,String.prototype.startsWith?I.startsWith("http"):0===I.indexOf("http"))||(L=U,U=r.locateFile?r.locateFile(L,l):l+L);var O={mappings:{},buffers:[null,[],[]],printChar:function(e,t){var n=O.buffers[e];0===t||10===t?((1===e?d:f)(b(n,0)),n.length=0):n.push(t)},varargs:void 0,get:function(){return O.varargs+=4,p[O.varargs-4>>2]},getStr:function(e){return function(e,t){return e?b(v,e,t):""}(e)},get64:function(e,t){return e}};function F(){e()}function M(e,n){t(e,n)}r._broadwayOnHeadersDecoded=F,r._broadwayOnPictureDecoded=M;var H={};function j(){if(!j.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"===("undefined"==typeof navigator?"undefined":m(navigator))&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:u||"./this.program"};for(var t in H)e[t]=H[t];var n=[];for(var t in e)n.push(t+"="+e[t]);j.strings=n}return j.strings}var W,N={g:function(e,t,n){return O.varargs=n,0},f:function(e,t,n){O.varargs=n},a:function(){R()},p:F,h:M,i:function e(){return void 0===e.start&&(e.start=Date.now()),1e3*(Date.now()-e.start)|0},l:function(e,t,n){v.copyWithin(e,t,t+n)},m:function(e){R("OOM")},n:function(e,t){var n=0;return j().forEach((function(i,r){var o=t+n;p[e+4*r>>2]=o,function(e,t,n){for(var i=0;i<e.length;++i)_[t++>>0]=e.charCodeAt(i);n||(_[t>>0]=0)}(i,o),n+=i.length+1})),0},o:function(e,t){var n=j();p[e>>2]=n.length;var i=0;return n.forEach((function(e){i+=e.length+1})),p[t>>2]=i,0},b:function(e){return 0},d:function(e,t){var n=1==e||2==e?2:R();return _[t>>0]=n,0},e:function(e,t,n,i){var r=O.getStreamFromFD(e),o=O.doReadv(r,t,n);return p[i>>2]=o,0},k:function(e,t,n,i,r){},c:function(e,t,n,i){for(var r=0,o=0;o<n;o++){for(var s=p[t+8*o>>2],a=p[t+(8*o+4)>>2],u=0;u<a;u++)O.printChar(e,v[s+u]);r+=a}return p[i>>2]=r,0},j:function(e){var t=Date.now();return p[e>>2]=t/1e3|0,p[e+4>>2]=t%1e3*1e3|0,0}},V=(function(){var e={a:N};function t(e,t){var n,i=e.exports;r.asm=i,c=r.asm.q,n=c.buffer,r.HEAP8=_=new Int8Array(n),r.HEAP16=new Int16Array(n),r.HEAP32=p=new Int32Array(n),r.HEAPU8=v=new Uint8Array(n),r.HEAPU16=new Uint16Array(n),r.HEAPU32=new Uint32Array(n),r.HEAPF32=new Float32Array(n),r.HEAPF64=new Float64Array(n),w=r.asm.s,function(e){if(A--,r.monitorRunDependencies&&r.monitorRunDependencies(A),0==A&&(null!==T&&(clearInterval(T),T=null),x)){var t=x;x=null,t()}}()}function n(e){t(e.instance)}function i(t){return(h||"function"!=typeof fetch?Promise.resolve().then((function(){return B(U)})):fetch(U,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+U+"'";return e.arrayBuffer()})).catch((function(){return B(U)}))).then((function(t){return WebAssembly.instantiate(t,e)})).then(t,(function(e){f("failed to asynchronously prepare wasm: "+e),R(e)}))}if(A++,r.monitorRunDependencies&&r.monitorRunDependencies(A),r.instantiateWasm)try{return r.instantiateWasm(e,t)}catch(e){return f("Module.instantiateWasm callback failed with error: "+e),!1}h||"function"!=typeof WebAssembly.instantiateStreaming||C(U)||"function"!=typeof fetch?i(n):fetch(U,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(n,(function(e){return f("wasm streaming compile failed: "+e),f("falling back to ArrayBuffer instantiation"),i(n)}))}))}(),r.___wasm_call_ctors=function(){return(V=r.___wasm_call_ctors=r.asm.r).apply(null,arguments)});function G(e){function t(){W||(W=!0,r.calledRun=!0,y||(P(E),P(D),r.onRuntimeInitialized&&r.onRuntimeInitialized(),function(){if(r.postRun)for("function"==typeof r.postRun&&(r.postRun=[r.postRun]);r.postRun.length;)e=r.postRun.shift(),S.unshift(e);var e;P(S)}()))}e=e||a,A>0||(function(){if(r.preRun)for("function"==typeof r.preRun&&(r.preRun=[r.preRun]);r.preRun.length;)e=r.preRun.shift(),k.unshift(e);var e;P(k)}(),A>0||(r.setStatus?(r.setStatus("Running..."),setTimeout((function(){setTimeout((function(){r.setStatus("")}),1),t()}),1)):t()))}if(r._broadwayInit=function(){return(r._broadwayInit=r.asm.t).apply(null,arguments)},r._broadwayCreateStream=function(){return(r._broadwayCreateStream=r.asm.u).apply(null,arguments)},r._broadwayPlayStream=function(){return(r._broadwayPlayStream=r.asm.v).apply(null,arguments)},x=function e(){W||G(),W||(x=e)},r.run=G,r.preInit)for("function"==typeof r.preInit&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.pop()();return G(),r}},{key:"onHeadersDecoded",get:function(){return this._onHeadersDecoded},set:function(e){this._onHeadersDecoded=e}},{key:"onPictureDecoded",get:function(){return this._onPictureDecoded},set:function(e){this._onPictureDecoded=e}}])&&p(t.prototype,n),i&&p(t,i),e}();function g(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var b=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._config=t,this._module=null,this._MAX_VIDEO_BUFFER_LENGTH=2097152,this._videoBuffer=null,this._bufferTotal=0,this._decodeBuffers={},this._onError=null,this._onFlvDecoded=null,this._vCache=[],this._initModule()}var t,n,i;return t=e,(n=[{key:"destroy",value:function(){this._module=null,this._onError=null,this._onFlvDecoded=null}},{key:"videoDecode",value:function(e){if(!(e.length>this._MAX_VIDEO_BUFFER_LENGTH))if(this._videoBuffer){if(this._vCache.length>0){for(var t=0;t<this._vCache.length;t++){var n=this._vCache[t];this._videoBuffer.set(n),this._bufferTotal+=n.length,this._module._broadwayPlayStream(n.length,this._bufferTotal)}this._vCache=[]}this._videoBuffer.set(e),this._bufferTotal+=e.length,this._module._broadwayPlayStream(e.length,this._bufferTotal)}else this._vCache.push(e)}},{key:"unPack",value:function(e){this.videoDecode(e)}},{key:"_initModule",value:function(){if(this._module=this._getModule(this._config.wasmFile),this._module)this._module.onRuntimeInitialized=this._onRuntimeInitialized.bind(this);else{var e={code:u,message:"init module exception"};this._onError&&this._onError(e)}}},{key:"_getModule",value:function(e){var t=new y;return t.onHeadersDecoded=this._onAsmHeadersDecoded.bind(this),t.onPictureDecoded=this._onAsmPictureDecoded.bind(this),t.initModule(e)}},{key:"_onRuntimeInitialized",value:function(){this._initDecoder()}},{key:"_initDecoder",value:function(){this._module._broadwayInit();var e=this._MAX_VIDEO_BUFFER_LENGTH;this._videoBuffer=this._toU8Array(this._module._broadwayCreateStream(e),e)}},{key:"_onAsmHeadersDecoded",value:function(){}},{key:"_onAsmPictureDecoded",value:function(e,t){var n=this._toU8Array(e,t);this._onFlvDecoded&&this._onFlvDecoded(new Uint8Array(n),t)}},{key:"_toU8Array",value:function(e,t){return this._module.HEAPU8.subarray(e,e+t)}},{key:"onError",get:function(){return this._onError},set:function(e){this._onError=e}},{key:"onFlvDecoded",get:function(){return this._onFlvDecoded},set:function(e){this._onFlvDecoded=e}}])&&g(t.prototype,n),i&&g(t,i),e}(),w="io error",k="loading finished",E="decode error",D="video data",S="audio data",A="flv data",T="network flow",x="io data arrival";function R(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var C=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._emitter=new r.a,this._config=t,this._ioHandler=null,this._decoder=null}var t,n,i;return t=e,(n=[{key:"destroy",value:function(){this._ioHandler&&(this._ioHandler.destroy(),this._ioHandler=null),this._decoder&&(this._decoder.destroy(),this._decoder=null),this._emitter.removeAllListeners(),this._emitter=null}},{key:"on",value:function(e,t){this._emitter.addListener(e,t)}},{key:"off",value:function(e,t){this._emitter.removeListener(e,t)}},{key:"decoder",value:function(e){this._decoder&&this._decoder.unPack(e)}},{key:"initDecoder",value:function(){this._initDecoder()}},{key:"close",value:function(){this._destroyDecoder()}},{key:"_internalAbort",value:function(){this._ioHandler&&(this._ioHandler.destroy(),this._ioHandler=null)}},{key:"_destroyDecoder",value:function(){this._decoder&&(this._decoder.destroy(),this._decoder=null)}},{key:"_initDecoder",value:function(){this._decoder||(1==this._config.renderType?(this._decoder=new v(this._config),this._decoder.onError=this._onDecodedError.bind(this),this._decoder.onVideoDecoded=this._onVideoDecoded.bind(this),this._decoder.onAudioDecoded=this._onAudioDecoded.bind(this)):2==this._config.renderType&&(this._decoder=new b(this._config),this._decoder.onError=this._onDecodedError.bind(this),this._decoder.onFlvDecoded=this._onFlvDecoded.bind(this)))}},{key:"_onDecodedError",value:function(e){this._emitter.emit(E,e)}},{key:"_onVideoDecoded",value:function(e,t,n,i){this._emitter.emit(D,e,t,n,i)}},{key:"_onAudioDecoded",value:function(e,t,n,i,r){this._emitter.emit(S,e,t,n,i,r)}},{key:"_onFlvDecoded",value:function(e,t){this._emitter.emit(A,e,t)}}])&&R(t.prototype,n),i&&R(t,i),e}(),L=n(3),I=n.n(L);function U(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var B=0,P=1,O=2,F=3,M=4,H=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._type=t||"undefined",this._status=B,this._onInit=null,this._onError=null,this._onFinished=null,this._onDataArrival=null,this._onFlow=null}var t,n,i;return t=e,(n=[{key:"destroy",value:function(){this._status=B,this._onInit=null,this._onError=null,this._onFinished=null,this._onDataArrival=null,this._onFlow=null}},{key:"open",value:function(e){}},{key:"send",value:function(e){}},{key:"abort",value:function(){}},{key:"type",get:function(){return this._type}},{key:"status",get:function(){return this._status}},{key:"onInitComplete",get:function(){return this._onInitComplete},set:function(e){this._onInitComplete=e}},{key:"onError",get:function(){return this._onError},set:function(e){this._onError=e}},{key:"onFinished",get:function(){return this._onFinished},set:function(e){this._onFinished=e}},{key:"onDataArrival",get:function(){return this._onDataArrival},set:function(e){this._onDataArrival=e}},{key:"onFlow",get:function(){return this._onFlow},set:function(e){this._onFlow=e}}])&&U(t.prototype,n),i&&U(t,i),e}();function j(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var W=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,i;return t=e,i=[{key:"isWebsocketURL",value:function(e){return/wss?:\/\/(.+?)/.test(e)}}],(n=null)&&j(t.prototype,n),i&&j(t,i),e}();function N(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var V=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._message=t}var t,n,i;return t=e,(n=[{key:"toString",value:function(){return this.name+": "+this.message}},{key:"name",get:function(){return"RuntimeException"}},{key:"message",get:function(){return this._message}}])&&N(t.prototype,n),i&&N(t,i),e}();function G(e){return(G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function z(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function $(e,t,n){return($="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Q(e)););return e}(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}function q(e,t){return(q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=Q(e);if(t){var r=Q(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return X(this,n)}}function X(e,t){return!t||"object"!==G(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Q(e){return(Q=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var K=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&q(e,t)}(u,e);var t,n,i,r=Y(u);function u(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(t=r.call(this,"WebSocketLoader"))._ws=null,t._heartTimer=null,t._requestAbort=!1,t._arrivalTime=(new Date).getTime(),t._timeoutTimer=null,t._timeout=e.timeout,t._bufferSize=0,t._flowTimer=null,t._flowInterval=1,t}return t=u,(n=[{key:"destroy",value:function(){this._ws&&this.abort(),this._timeout=null,this._bufferSize=null,this._flowInterval=null,this._ws=null,$(Q(u.prototype),"destroy",this).call(this)}},{key:"open",value:function(e){try{var t=this._ws=new self.WebSocket(e);t.binaryType="arraybuffer",t.onopen=this._onWebSocketOpen.bind(this),t.onclose=this._onWebSocketClose.bind(this),t.onerror=this._onWebSocketError.bind(this),t.onmessage=this._onWebSocketMessage.bind(this),this._status=P}catch(e){this._status=F;var n={code:s,message:h[s],exception:e};this._onError&&this._onError(n)}}},{key:"send",value:function(e){this._requestAbort||this._ws.send(e)}},{key:"abort",value:function(){this._ws&&(this._ws.close(),this._requestAbort=!0),this._heartTimer&&(clearInterval(this._heartTimer),this._heartTimer=null),this._timeoutTimer&&(clearInterval(this._timeoutTimer),this._timeoutTimer=null),this._flowTimer&&(clearInterval(this._flowTimer),this._flowTimer=null),this._status=M}},{key:"_onWebSocketOpen",value:function(e){var t=this;this._status=O,this._onInitComplete&&this._onInitComplete(),this._heartTimer||(this._heartTimer=setInterval((function(){t.send("BeatBert")}),1e5)),this._timeoutHandler(),this._flowHandler()}},{key:"_onWebSocketClose",value:function(e){!0!==this._requestAbort?(this._status=M,this._onComplete&&this._onComplete()):this._requestAbort=!1}},{key:"_onWebSocketError",value:function(e){this._status=F;var t={code:s,message:h[s],exception:e};this._onError&&this._onError(t)}},{key:"_onWebSocketMessage",value:function(e){if(this._arrivalTime=(new Date).getTime(),e.data instanceof ArrayBuffer)this._dispatchArrayBuffer(new Uint8Array(e.data));else{this._status=F;var t={code:a,message:h[a]};this._onError&&this._onError(t)}}},{key:"_dispatchArrayBuffer",value:function(e){this._bufferSize+=e.length,this._onDataArrival&&this._onDataArrival(e)}},{key:"_timeoutHandler",value:function(){var e=this;this._timeoutTimer||(this._timeoutTimer=setInterval((function(){if((new Date).getTime()-e._arrivalTime>1e3*e._timeout){var t={code:o,message:h[o]};e._onError&&e._onError(t)}}),1e4))}},{key:"_flowHandler",value:function(){var e=this;this._flowTimer||(this._flowTimer=setInterval((function(){if(e._onFlow){var t=Math.round(e._bufferSize/1024);e._onFlow(t)}}),1e3*this._flowInterval))}}])&&z(t.prototype,n),i&&z(t,i),u}(H);function Z(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var J=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._config=n,this._playUrl=t,this._param={},this._loader=null,this._loaderClass=null,this._onDataArrival=null,this._onError=null,this._onFinished=null,this._onFlow=null}var t,n,i;return t=e,(n=[{key:"destroy",value:function(){this._playUrl=null,this._param=null,this._loader&&(this._loader.destroy(),this._loader=null),this._onDataArrival=null,this._onError=null,this._onFinished=null,this._onFlow=null}},{key:"_initLoader",value:function(){if(W.isWebsocketURL(this._playUrl))this._loaderClass=K,this._urlParam();else{var e={code:l,message:h[l]};this._onLoaderError(e)}}},{key:"_createLoader",value:function(){this._initLoader(),this._loaderClass&&(this._loader=new this._loaderClass(this._config),this._loader.onInitComplete=this._onInitComplete.bind(this),this._loader.onError=this._onLoaderError.bind(this),this._loader.onFinished=this._onLoaderFinished.bind(this),this._loader.onDataArrival=this._onLoaderDataArrival.bind(this),this._loader.onFlow=this._onLoaderFlow.bind(this))}},{key:"open",value:function(){this._createLoader(),this._loader&&this._loader.open(this._playUrl)}},{key:"abort",value:function(){this._loader.abort()}},{key:"send",value:function(e){e&&this._loader.send(e)}},{key:"_urlParam",value:function(){var e=this._playUrl;if(-1!==e.indexOf("?")){var t=e.split("?"),n=t[0];this._playUrl=n;var i={},r=t[1];if(r&&r.length>0){var o=r.split("&");if(o&&o.length>0)for(var s=0;s<o.length;s++){var a=o[s].split("=");i[a[0].toLowerCase()]=a[1]}}this._param=i}}},{key:"_onInitComplete",value:function(){W.isWebsocketURL(this._playUrl)&&this._loader.send(this._param.sessionid)}},{key:"_onLoaderError",value:function(e){if(!this._onError)throw new V("IOException: "+e);this._onError(e)}},{key:"_onLoaderFinished",value:function(){this._onFinished&&this._onFinished()}},{key:"_onLoaderDataArrival",value:function(e){this._onDataArrival&&this._onDataArrival(e)}},{key:"_onLoaderFlow",value:function(e){this._onFlow&&this._onFlow(e)}},{key:"onDataArrival",get:function(){return this._onDataArrival},set:function(e){this._onDataArrival=e}},{key:"onError",get:function(){return this._onError},set:function(e){this._onError=e}},{key:"onFinished",get:function(){return this._onFinished},set:function(e){this._onFinished=e}},{key:"onFlow",get:function(){return this._onFlow},set:function(e){this._onFlow=e}}])&&Z(t.prototype,n),i&&Z(t,i),e}();function ee(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var te=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._emitter=new r.a,this._ioHandler=null}var t,n,i;return t=e,(n=[{key:"destroy",value:function(){this._ioHandler&&(this._ioHandler.destroy(),this._ioHandler=null),this._emitter.removeAllListeners(),this._emitter=null}},{key:"on",value:function(e,t){this._emitter.addListener(e,t)}},{key:"off",value:function(e,t){this._emitter.removeListener(e,t)}},{key:"open",value:function(e,t){this._createLoader(e,t)}},{key:"close",value:function(){this._internalAbort()}},{key:"_createLoader",value:function(e,t){this._ioHandler=new J(e,t),this._ioHandler.onError=this._onIOException.bind(this),this._ioHandler.onFinished=this._onIOFinished.bind(this),this._ioHandler.onDataArrival=this._onIODataArrival.bind(this),this._ioHandler.onFlow=this._onIOFlow.bind(this),this._ioHandler.open()}},{key:"_internalAbort",value:function(){this._ioHandler&&(this._ioHandler.destroy(),this._ioHandler=null)}},{key:"_onIOException",value:function(e){this._emitter.emit(w,e)}},{key:"_onIOFinished",value:function(){this._emitter.emit(k)}},{key:"_onIODataArrival",value:function(e){this._emitter.emit(x,e)}},{key:"_onIOFlow",value:function(e){this._emitter.emit(T,e)}}])&&ee(t.prototype,n),i&&ee(t,i),e}(),ne=n(4),ie=n.n(ne);function re(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var oe=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._emitter=new r.a,this._initFlag=!1,2!=t.renderType&&t.enableWorker&&"undefined"!=typeof Worker){if(t.decoderWorker)try{this._worker=new I.a,this._workerDestroying=!1,this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",param:t})}catch(e){this._worker=null,this._handler=new C(t)}else this._handler=new C(t);if(t.ioWorker)try{this._ioWorker=new ie.a,this._ioWorkerDestroying=!1,this._ioWorker.addEventListener("message",this._ioOnWorkerMessage.bind(this)),this._ioWorker.postMessage({cmd:"init"})}catch(e){this._ioWorker=null,this._iohandler=new te}else this._iohandler=new te}else this._handler=new C(t),this._iohandler=new te;this._initHandler()}var t,n,i;return t=e,(n=[{key:"destroy",value:function(){this._worker?this._workerDestroying||(this._workerDestroying=!0,this._worker.postMessage({cmd:"destroy"})):(this._handler.destroy(),this._handler=null),this._ioWorker?this._ioWorkerDestroying||(this._ioWorkerDestroying=!0,this._ioWorker.postMessage({cmd:"destroy"})):(this._iohandler.destroy(),this._iohandler=null),this._emitter.removeAllListeners(),this._emitter=null}},{key:"on",value:function(e,t){this._emitter.addListener(e,t)}},{key:"off",value:function(e,t){this._emitter.removeListener(e,t)}},{key:"play",value:function(e,t){if(null!=e&&W.isWebsocketURL(e))if(this._initFlag||(this._initDecoder(),this._initFlag=!0),this._ioWorker){var n={playUrl:e,config:t};this._ioWorker.postMessage({cmd:"open",param:n})}else this._iohandler.open(e,t);else{var i={code:l,message:"URL为空或格式错误"};this._onIOError.call(this,i)}}},{key:"_initDecoder",value:function(){this._worker?this._worker.postMessage({cmd:"initDecoder"}):this._handler.initDecoder()}},{key:"_decoder",value:function(e){this._worker?this._worker.postMessage({cmd:"decoder",param:e}):this._handler.decoder(e)}},{key:"close",value:function(){this._initFlag=!1,this._worker?this._worker.postMessage({cmd:"close"}):this._handler.close(),this._ioWorker?this._ioWorker.postMessage({cmd:"close"}):this._iohandler.close()}},{key:"_initHandler",value:function(){if(this._handler){var e=this._handler;e.on(E,this._onDecoderError.bind(this)),e.on(D,this._onVideoData.bind(this)),e.on(S,this._onAudioData.bind(this)),e.on(A,this._onFlvData.bind(this))}if(this._iohandler){var t=this._iohandler;t.on(w,this._onIOError.bind(this)),t.on(k,this._onLoadingFinished.bind(this)),t.on(T,this._onIOFlow.bind(this)),t.on(x,this._onIODataArrival.bind(this))}}},{key:"_onIODataArrival",value:function(e){this._decoder(e)}},{key:"_onIOError",value:function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(w,e)}))}},{key:"_onIOFlow",value:function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(T,e)}))}},{key:"_onLoadingFinished",value:function(){var e=this;Promise.resolve().then((function(){e._emitter.emit(k)}))}},{key:"_onDecoderError",value:function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(E,e)}))}},{key:"_onVideoData",value:function(e,t,n,i){var r=this;Promise.resolve().then((function(){r._emitter.emit(D,e,t,n,i)}))}},{key:"_onAudioData",value:function(e,t,n,i,r){var o=this;Promise.resolve().then((function(){o._emitter.emit(S,e,t,n,i,r)}))}},{key:"_onFlvData",value:function(e,t){var n=this;Promise.resolve().then((function(){n._emitter.emit(A,e,t)}))}},{key:"_onWorkerMessage",value:function(e){var t=e.data,n=t.data;if("destroyed"===t.msg||this._workerDestroying)return this._workerDestroying=!1,this._worker.terminate(),void(this._worker=null);if(!this._workerDestroying)switch(t.msg){case E:this._emitter.emit(t.msg,n);break;case D:this._emitter.emit(t.msg,n.timestamp,n.buffer,n.width,n.height);break;case S:this._emitter.emit(t.msg,n.timestamp,n.buffer,n.size,n.smaprate,n.channel);break;case A:this._emitter.emit(t.msg,n.buffer,n.len)}}},{key:"_ioOnWorkerMessage",value:function(e){var t=e.data,n=t.data;if("destroyed"===t.msg||this._ioWorkerDestroying)return this._ioWorker.terminate(),void(this._ioWorker=null);if(!this._ioWorkerDestroying)switch(t.msg){case w:this._emitter.emit(t.msg,n);break;case k:this._emitter.emit(t.msg);break;case T:this._emitter.emit(t.msg,n);break;case x:this._decoder(n)}}}])&&re(t.prototype,n),i&&re(t,i),e}();var se=n(5),ae=n.n(se);function ue(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var le=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._canvas=t,this._ctx=null,this._yuvCanvas=null,this._yuvCanvasClass=null,this._worker=null,this._drawing=!1,this._init(),this._createInstance()}var t,n,i;return t=e,(n=[{key:"destroy",value:function(){this._worker.postMessage({cmd:"destroy"})}},{key:"draw",value:function(e,t,n){this._drawing=!0,this._worker.postMessage({cmd:"draw",params:{buffer:e,width:t,height:n}}),e=null}},{key:"clearDraw",value:function(){this._drawing=!1,this._worker.postMessage({cmd:"clearDraw"}),this._ctx.clearRect(0,0,this._canvas.clientWidth,this._canvas.clientHeight)}},{key:"_init",value:function(){}},{key:"_createInstance",value:function(){this._ctx=this._canvas.getContext("2d"),this._worker=new ae.a,this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init"})}},{key:"_onWorkerMessage",value:function(e){var t=e.data,n=t.data;switch(t.msg){case"image":this._drawing&&this._ctx.drawImage(n,0,0)}}},{key:"_isSupportWebGL",value:function(){var e=!1;try{e=!!window.WebGLRenderingContext}catch(t){e=!1}return e}}])&&ue(t.prototype,n),i&&ue(t,i),e}();function he(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ce=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._frameRate=t.frameRate,this._frameInterval=Math.round(1e3/t.frameRate),this._timer=null,this._startTime=Date.now(),this._lastTime=Date.now(),this._speed=0,this._onVideoProcess=null}var t,n,i;return t=e,(n=[{key:"destroy",value:function(){this._frameRate=null,this._frameInterval=null,this._timer&&(clearInterval(this._timer),this._timer=null),this._startTime=null,this._lastTime=null,this._onVideoProcess=null}},{key:"start",value:function(){this._init()}},{key:"_init",value:function(){this._timer=this._videoRender(this._step.bind(this))}},{key:"_step",value:function(e){this._onVideoProcess&&this._onVideoProcess(e),this._timer=this._videoRender(this._step.bind(this))}},{key:"_videoRender",value:function(e){var t=Date.now(),n=t-this._startTime;this._lastTime=Math.max(this._lastTime+this._frameInterval,t);var i=this._lastTime-t;return(i+=this._speed)<0&&(i=0),setTimeout((function(){e(n)}),i)}},{key:"onVideoProcess",get:function(){return this._onVideoProcess},set:function(e){this._onVideoProcess=e}},{key:"speed",get:function(){return this._speed},set:function(e){this._speed=e}}])&&he(t.prototype,n),i&&he(t,i),e}();function de(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var fe=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._sampleRate=t,this._channels=n,this._bufferSize=i,this._queueLen=250,this._item=[],this._pendingPos=0,this._audioObj={timestamp:0,buffer:new Float32Array(this._bufferSize)},this.flush()}var t,n,i;return t=e,(n=[{key:"flush",value:function(){this._item=[],this._pendingPos=0,this._audioObj={timestamp:0,buffer:new Float32Array(this._bufferSize)}}},{key:"push",value:function(e,t){var n=t.length;0==this._pendingPos&&(this._audioObj.timestamp=e);for(var i=0;i<n;i++){if(this._audioObj.buffer[this._pendingPos]=t[i],0==this._audioObj.timestamp){var r=Math.round(e+1e3*(i-1)/this._sampleRate);this._audioObj.timestamp=r}++this._pendingPos==this._bufferSize&&(this._item.length>=this._queueLen&&this._item.shift(),this._item.push(this._audioObj),this._pendingPos=0,this._audioObj={timestamp:e,buffer:new Float32Array(this._bufferSize)})}}},{key:"pop",value:function(){if(this._item.length>0)return this._item.length>=this._queueLen&&this._item.shift(),this._item.shift();var e=this._audioObj;return this._pendingPos=0,this._audioObj={timestamp:0,buffer:new Float32Array(this._bufferSize)},e}},{key:"peek",value:function(){return this._item[0]}},{key:"count",value:function(){return this._item.length}}])&&de(t.prototype,n),i&&de(t,i),e}();function _e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ve=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.BUFFER_SIZE=1024,(t.sampleRate<3e3||t.sampleRate>384e3)&&(t.sampleRate=8e3),(t.channels<1||t.channels>2)&&(t.channels=1),this._sampleRate=t.sampleRate||8e3,this._channels=t.channels||1,this._audioCtx=null,this._gainNode=null,this._scriptNode=null,this._bufferQueue=new fe(this._sampleRate,this._channels,this.BUFFER_SIZE),this._audioQueueTimestamp=0,this._status=!1,this._muted=!1,this._volume=1,this._initAudioContext()}var t,n,i;return t=e,(n=[{key:"destroy",value:function(){this.BUFFER_SIZE=null,this._sampleRate=null,this._channels=null,this._audioCtx&&(this._audioCtx.close(),this._audioCtx=null,this._scriptNode=null),this._bufferQueue=null,this._audioQueueTimestamp=null,this._status=null,this._muted=null,this._volume=null}},{key:"play",value:function(){this._status=!0}},{key:"stop",value:function(){this._status=!1}},{key:"appendBuffer",value:function(e,t){var n=this._toFloat32Array(t);this._bufferQueue.push(e,n)}},{key:"flush",value:function(){this._bufferQueue.flush()}},{key:"_initAudioContext",value:function(){var e={sampleRate:this._sampleRate};this._audioCtx=new(window.AudioContext||window.webkitAudioContext)(e),this._scriptNode=this._audioCtx.createScriptProcessor(this.BUFFER_SIZE,0,this._channels),this._scriptNode.onaudioprocess=this._audioProcess.bind(this),this._gainNode=this._audioCtx.createGain(),this._gainNode.gain.value=this._volume,this._scriptNode.connect(this._gainNode),this._gainNode.connect(this._audioCtx.destination)}},{key:"_audioProcess",value:function(e){if(this._status){this._bufferQueue.count();var t=this._bufferQueue.pop();if(null==t&&(t=this._bufferQueue.pop()),this._gainNode.gain.value=this._muted?0:this._volume,null==t)return void(this._gainNode.gain.value=0);0!=t.timestamp&&(this._audioQueueTimestamp=t.timestamp);for(var n,i=t.buffer,r=0;r<this._channels;r++){var o=e.outputBuffer.getChannelData(r);n=r;for(var s=0;s<i.length;s++)o[s]=i[n],n+=this._channels}}else for(var a=0;a<this._channels;a++)for(var u=e.outputBuffer.getChannelData(a),l=0;l<u.length;l++)u[l]=0}},{key:"_toFloat32Array",value:function(e){for(var t=new Uint8Array(e),n=new Int16Array(t.buffer),i=new Float32Array(n.length),r=0,o=n.length;r<o;r++)n[r]<0?i[r]=n[r]/32768:i[r]=n[r]/32767;return i}},{key:"muted",get:function(){return this._muted},set:function(e){this._muted=e,this._gainNode.gain.value=this._muted?0:this._volume}},{key:"volume",get:function(){return this._volume},set:function(e){this._volume=e,this._gainNode.gain.value=this._volume}},{key:"currentTime",get:function(){var e=0;return this._audioCtx&&(e=this._audioCtx.currentTime),e}},{key:"audioQueueTimestamp",get:function(){return this._audioQueueTimestamp}},{key:"status",get:function(){return this._status}}])&&_e(t.prototype,n),i&&_e(t,i),e}();function me(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var pe=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._count=t,this._item=[]}var t,n,i;return t=e,(n=[{key:"enqueue",value:function(e){this._count<this._item.length&&this._item.shift(),this._item.push(e)}},{key:"enqueueFront",value:function(e){this._item.unshift(e)}},{key:"dequeue",value:function(){return this._item.shift()}},{key:"dequeueBack",value:function(){return this._item.pop()}},{key:"peek",value:function(){return this._item[0]}},{key:"clear",value:function(){this._item=[]}},{key:"isEmpty",value:function(){return 0===this._item.length}},{key:"count",get:function(){return this._item.length}}])&&me(t.prototype,n),i&&me(t,i),e}();function ye(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ge=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._event="resize",this._emitter=new r.a,this._element=t,this._objectEle=null,this._handler=null,this._attachEvent()}var t,n,i;return t=e,(n=[{key:"destroy",value:function(){this._clearTrigger(),this._element=null,this._emitter.removeAllListeners(),this._emitter=null}},{key:"resize",value:function(e){this._emitter.addListener(this._event,e)}},{key:"_attachEvent",value:function(){this._initResizeTrigger()}},{key:"_initResizeTrigger",value:function(){var e=document.createElement("object"),t=["display:block;","position:absolute;","top:0;","left:0;","height:100%;","width:100%;","overflow:hidden;","visibility:hidden;","opacity:0;","pointer-events:none;","z-index:-1;"].join("");e.setAttribute("style",t),e.onload=this._onLoadTrigger.bind(this),e.type="text/html",e.data="about:blank",this._objectEle=e,this._element.appendChild(e)}},{key:"_onLoadTrigger",value:function(e){this._handler||(this._handler=this._handlerResize.bind(this)),this._objectEle.contentDocument.defaultView.addEventListener("resize",this._handler)}},{key:"_clearTrigger",value:function(){this._objectEle&&this._objectEle.contentDocument&&(this._objectEle.contentDocument.defaultView.removeEventListener("resize",this._handler),this._element.removeChild(this._objectEle),this._objectEle=null)}},{key:"_handlerResize",value:function(e){this._objectEle&&this._emitter.emit(this._event,e)}}])&&ye(t.prototype,n),i&&ye(t,i),e}();function be(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var we=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._playElement=t,this._width=this._playElement.clientWidth,this._height=this._playElement.clientHeight,this._canvas=null,this._ctx=null,this._x=0,this._y=0,this._init()}var t,n,i;return t=e,(n=[{key:"destroy",value:function(){this._playElement=null,this._canvas&&(this._canvas.parentNode.removeChild(this._canvas),this._canvas=null),this._ctx=null,this._x=null,this._y=null}},{key:"_init",value:function(){this._canvas=document.createElement("canvas"),this._canvas.width=this._width,this._canvas.height=this._height,this._canvas.classList.add("gciplayer-water"),this._playElement.appendChild(this._canvas),this._ctx=this._canvas.getContext("2d")}},{key:"displayResize",value:function(){this._width=this._playElement.clientWidth,this._height=this._playElement.clientHeight,this._canvas.width=this._width,this._canvas.height=this._height}},{key:"draw",value:function(e,t){this._ctx.globalAlpha=.5,this._ctx.fillStyle="#fff",this._ctx.strokeStyle="#000",this._ctx.font="".concat(28,"px Microsoft YaHei"),this._ctx.clearRect(0,0,this._canvas.clientWidth,this._canvas.clientHeight);var n=this._ctx.measureText(e).width;t?(this._y=(this._height-28)/2,this._x<this._canvas.clientWidth&&(this._ctx.strokeText(e,this._x,this._y),this._ctx.fillText(e,this._x,this._y)),this._canvas.clientWidth-this._x<n&&(this._ctx.strokeText(e,-(this._canvas.clientWidth-this._x),this._y),this._ctx.fillText(e,-(this._canvas.clientWidth-this._x),this._y)),this._x>=this._canvas.clientWidth&&(this._x=0),this._x+=1):(this._x=(this._width-n)/2,this._y=(this._height-28)/2,this._ctx.strokeText(e,this._x,this._y),this._ctx.fillText(e,this._x,this._y))}}])&&be(t.prototype,n),i&&be(t,i),e}();function ke(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Ee=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._option=null,this._playElement=null,this._canvas=null,this._width=0,this._height=0,this._yuvCanvas=null,this._videoContext=null,this._vStartTimestamp=null,this._videoFrameRate=null,this._videoCache=5,this._videoQueue=new pe(250),this._cacheTime=0,this._load=!1,this._firstFrame=!1,this._sync=!1,this._playResize=null,this._stretch=!1,this._audioRender=null,this._hasAudio=!1,this._fullscreen=null,this._exitFullscreen=null,this._watermarkRender=null,this._pause=!1,this._currentTime=0,this._onPlay=null}var t,n,i;return t=e,(n=[{key:"destroy",value:function(){this.clear(),this._option=null,this._width=0,this._height=0,this._playResize&&(this._playResize.destroy(),this._playResize=null),this._stretch=null,this._yuvCanvas&&(this._yuvCanvas.destroy(),this._yuvCanvas=null),this._canvas&&(this._canvas.parentNode.removeChild(this._canvas),this._canvas=null),this._watermarkRender&&(this._watermarkRender.destroy(),this._watermarkRender=null),this._hasAudio=!1,this._vStartTimestamp=null,this._videoFrameRate=null,this._videoCache=null,this._videoQueue=null,this._load=null,this._firstFrame=null,this._fullscreen=null,this._exitFullscreen=null,this._watermarkRender=null,this._pause=!1,this._currentTime=0,this._playElement=null}},{key:"attach",value:function(e,t){this._option=t,this._sync=this._option.sync,this._cacheTime=this._option.cacheTime,this._playElement=e,this._stretch=t.stretch,this._width=e.clientWidth,this._height=e.clientHeight,this._playElement.style.position="relative";var n=document.createElement("canvas");n.width=this._width,n.height=this._height,n.classList.add("gciplayer-canvas"),this._playElement.childNodes[0]?this._playElement.insertBefore(n,this._playElement.childNodes[0]):this._playElement.appendChild(n),this._canvas=n,this._yuvCanvas=new le(n),this._watermarkRender=new we(e),this._init(),this._scaleCanvasView()}},{key:"clear",value:function(){this._videoContext&&(this._videoContext.destroy(),this._videoContext=null),this._audioRender&&(this._audioRender.destroy(),this._audioRender=null),this._yuvCanvas&&this._yuvCanvas.clearDraw(),this._watermarkRender&&this._watermarkRender.draw(""),this._hasAudio=!1,this._vStartTimestamp=null,this._videoFrameRate=null,this._videoQueue.clear(),this._load=!1,this._firstFrame=!1}},{key:"play",value:function(){this._pause&&(this._pause=!1)}},{key:"pause",value:function(){this._pause||(this._pause=!0,this._audioRender&&this._audioRender.stop())}},{key:"stop",value:function(){this._pause||(this._pause=!0,this._audioRender&&(this._audioRender.stop(),this._audioRender.flush()))}},{key:"setView",value:function(e,t){this._width=e,this._height=t,this._scaleCanvasView()}},{key:"drawFrame",value:function(e,t,n,i){this._canvas.width==n&&this._canvas.height==i||(this._canvas.width=n,this._canvas.height=i,this._scaleCanvasView()),(!this._sync||0==this._vStartTimestamp&&0==e)&&(this._sync=!1,this._videoFrameRate=25,0!=this._cacheTime&&(this._videoCache=Math.round(this._cacheTime*this._videoFrameRate)),this._videoContext||(this._videoContext=new ce({frameRate:this._videoFrameRate}),this._videoContext.onVideoProcess=this._videoProcess.bind(this),this._videoContext.start())),this._vStartTimestamp||0==this._vStartTimestamp?this._videoFrameRate?this._videoContext||(this._videoContext=new ce({frameRate:this._videoFrameRate}),this._videoContext.onVideoProcess=this._videoProcess.bind(this),this._videoContext.start()):this._vStartTimestamp!=e&&(this._videoFrameRate=Math.round(1e3/(e-this._vStartTimestamp)),0!=this._cacheTime&&(this._videoCache=Math.round(this._cacheTime*this._videoFrameRate))):this._vStartTimestamp=e,this._videoQueue.enqueue({timestamp:e,buffer:t,width:n,height:i})}},{key:"createAudio",value:function(e,t){this._audioRender||(this._audioRender=new ve({channels:t,sampleRate:e}),this._hasAudio=!0)}},{key:"audioFrame",value:function(e,t){this._hasAudio&&this._audioRender.appendBuffer(e,t)}},{key:"toggleFullScreen",value:function(){window.fullScreen||document.webkitIsFullScreen?this.exitFullscreen():this.fullscreen()}},{key:"fullscreen",value:function(){this._fullscreen&&this._fullscreen.call(this._playElement)}},{key:"exitFullscreen",value:function(){this._exitFullscreen&&this._exitFullscreen.call(document)}},{key:"capture",value:function(e,t,n){var i="image/png",r=this._canvas.toDataURL(i);if(t&&t instanceof Function&&t(this._dataURLtoFile(r,"capture.png")),e){var o=document.createElement("a");o.download=n||(new Date).getTime(),o.href=r,o.dataset.downloadurl=[i,o.download,o.href].join(":"),document.body.appendChild(o),o.click(),document.body.removeChild(o)}}},{key:"_dataURLtoFile",value:function(e,t){for(var n=e.split(","),i=atob(n[1]),r=i.length,o=new Uint8Array(r);r--;)o[r]=i.charCodeAt(r);return new File([o],t,{type:"image/png"})}},{key:"_videoProcess",value:function(e){if(!this._pause)if(this._videoQueue.count>this._videoCache?this._videoContext.speed=-1:this._videoQueue.count<this._videoCache-2?this._videoContext.speed=0:0==this._videoQueue.count?(this._load=!1,this._videoContext.speed=-this._videoFrameRate):this._videoContext.speed=0,this._load){var t=this._videoQueue.dequeue();if(this._sync&&this._hasAudio&&this._audioRender.status&&t&&0!=t.timestamp){var n=t.timestamp-this._audioRender.audioQueueTimestamp;if(n<-360)for(var i=!0;i;)(t=this._videoQueue.dequeue())?(t.timestamp,this._audioRender.audioQueueTimestamp,i=n<-860):i=!1}t&&this._draw(t)}else{if(!this._firstFrame&&0==this._cacheTime){var r=this._videoQueue.dequeue();r&&this._draw(r),this._firstFrame=!0}this._videoQueue.count>this._videoCache&&(this._hasAudio&&this._audioRender.play(),this._load=!0)}}},{key:"_draw",value:function(e){this._currentTime=Math.floor((e.timestamp-this._vStartTimestamp)/1e3),this._onPlay&&this._onPlay(this._currentTime),this._yuvCanvas.draw(e.buffer,e.width,e.height),this._option.watermarkText&&this._watermarkRender.draw(this._option.watermarkText,this._option.watermarkMove)}},{key:"_scaleCanvasView",value:function(){var e,t,n=this._width,i=this._height,r=this._canvas.width,o=this._canvas.height,s=(n/r).toFixed(4),a=(i/o).toFixed(4);this._stretch?(e=s,t=a):e=t=s>a?a:s,this._canvas.style.cssText="transform:scale(".concat(e,",").concat(t,") translate(-50%,-50%);\n                                      -webkit-transform:scale(").concat(e,",").concat(t,") translate(-50%,-50%);\n                                      -ms-transform:scale(").concat(e,",").concat(t,") translate(-50%,-50%);"),this._watermarkRender.displayResize()}},{key:"_init",value:function(){var e=this._playElement;e.addEventListener("contextmenu",(function(e){e.preventDefault()})),this._fullscreen||(this._fullscreen=e.requestFullscreen||e.msRequestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullscreen),this._exitFullscreen||(this._exitFullscreen=document.exitFullscreen||document.msExitFullscreen||document.mozCancelFullScreen||document.webkitCancelFullScreen),this._resizeEvent()}},{key:"_resizeEvent",value:function(){var e=this;this._playResize||(this._playResize=new ge(this._playElement),this._playResize.resize((function(t){e._width=t.target.innerWidth,e._height=t.target.innerHeight,e._scaleCanvasView()})))}},{key:"_dbclickFullscreenEvent",value:function(){var e=this;this._playElement.addEventListener("dblclick",(function(t){window.fullScreen||document.webkitIsFullScreen?e.exitFullscreen():e.fullscreen()}))}},{key:"onPlay",get:function(){return this._onPlay},set:function(e){this._onPlay=e}},{key:"hasAudio",get:function(){return this._hasAudio}},{key:"muted",get:function(){return!this._audioRender||this._audioRender.muted},set:function(e){this._audioRender&&(this._audioRender.muted=e)}},{key:"volume",get:function(){this._audioRender&&this._audioRender.volume},set:function(e){this._audioRender&&(this._audioRender.volume=e)}},{key:"stretch",get:function(){return this._stretch},set:function(e){this._stretch=e,this._scaleCanvasView()}},{key:"load",get:function(){return this._load}},{key:"currentTime",get:function(){return this._currentTime}}])&&ke(t.prototype,n),i&&ke(t,i),e}();var De;De=new ArrayBuffer(2),new DataView(De).setInt16(0,256,!0),new Int16Array(De)[0];function Se(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Ae=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.refFrames=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}var t,n,i;return t=e,(n=[{key:"isComplete",value:function(){var e=!1===this.hasAudio||!0===this.hasAudio&&null!=this.audioCodec&&null!=this.audioSampleRate&&null!=this.audioChannelCount,t=!1===this.hasVideo||!0===this.hasVideo&&null!=this.videoCodec&&null!=this.width&&null!=this.height&&null!=this.fps&&null!=this.profile&&null!=this.level&&null!=this.refFrames&&null!=this.chromaFormat&&null!=this.sarNum&&null!=this.sarDen;return null!=this.mimeType&&null!=this.duration&&null!=this.metadata&&null!=this.hasKeyframesIndex&&e&&t}},{key:"isSeekable",value:function(){return!0===this.hasKeyframesIndex}},{key:"getNearestKeyframe",value:function(e){if(null==this.keyframesIndex)return null;var t=this.keyframesIndex,n=this._search(t.times,e);return{index:n,milliseconds:t.times[n],fileposition:t.filepositions[n]}}},{key:"_search",value:function(e,t){var n=0,i=e.length-1,r=0,o=0,s=i;for(t<e[0]&&(n=0,o=s+1);o<=s;){if((r=o+Math.floor((s-o)/2))===i||t>=e[r]&&t<e[r+1]){n=r;break}e[r]<t?o=r+1:s=r-1}return n}}])&&Se(t.prototype,n),i&&Se(t,i),e}();function Te(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var xe=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.TAG="ExpGolomb",this._buffer=t,this._buffer_index=0,this._total_bytes=t.byteLength,this._total_bits=8*t.byteLength,this._current_word=0,this._current_word_bits_left=0}var t,n,i;return t=e,(n=[{key:"destroy",value:function(){this._buffer=null}},{key:"_fillCurrentWord",value:function(){var e=this._total_bytes-this._buffer_index,t=Math.min(4,e),n=new Uint8Array(4);n.set(this._buffer.subarray(this._buffer_index,this._buffer_index+t)),this._current_word=new DataView(n.buffer).getUint32(0,!1),this._buffer_index+=t,this._current_word_bits_left=8*t}},{key:"readBits",value:function(e){if(e<=this._current_word_bits_left){var t=this._current_word>>>32-e;return this._current_word<<=e,this._current_word_bits_left-=e,t}var n=this._current_word_bits_left?this._current_word:0;n>>>=32-this._current_word_bits_left;var i=e-this._current_word_bits_left;this._fillCurrentWord();var r=Math.min(i,this._current_word_bits_left),o=this._current_word>>>32-r;return this._current_word<<=r,this._current_word_bits_left-=r,n=n<<r|o}},{key:"readBool",value:function(){return 1===this.readBits(1)}},{key:"readByte",value:function(){return this.readBits(8)}},{key:"_skipLeadingZero",value:function(){var e;for(e=0;e<this._current_word_bits_left;e++)if(0!=(this._current_word&2147483648>>>e))return this._current_word<<=e,this._current_word_bits_left-=e,e;return this._fillCurrentWord(),e+this._skipLeadingZero()}},{key:"readUEG",value:function(){var e=this._skipLeadingZero();return this.readBits(e+1)-1}},{key:"readSEG",value:function(){var e=this.readUEG();return 1&e?e+1>>>1:-1*(e>>>1)}}])&&Te(t.prototype,n),i&&Te(t,i),e}();function Re(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Ce=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,i;return t=e,i=[{key:"_ebsp2rbsp",value:function(e){for(var t=e,n=t.byteLength,i=new Uint8Array(n),r=0,o=0;o<n;o++)o>=2&&3===t[o]&&0===t[o-1]&&0===t[o-2]||(i[r]=t[o],r++);return new Uint8Array(i.buffer,0,r)}},{key:"parseSPS",value:function(t){var n=e._ebsp2rbsp(t),i=new xe(n);i.readByte();var r=i.readByte();i.readByte();var o=i.readByte();i.readUEG();var s=e.getProfileString(r),a=e.getLevelString(o),u=1,l=420,h=8;if((100===r||110===r||122===r||244===r||44===r||83===r||86===r||118===r||128===r||138===r||144===r)&&(3===(u=i.readUEG())&&i.readBits(1),u<=3&&(l=[0,420,422,444][u]),h=i.readUEG()+8,i.readUEG(),i.readBits(1),i.readBool()))for(var c=3!==u?8:12,d=0;d<c;d++)i.readBool()&&(d<6?e._skipScalingList(i,16):e._skipScalingList(i,64));i.readUEG();var f=i.readUEG();if(0===f)i.readUEG();else if(1===f){i.readBits(1),i.readSEG(),i.readSEG();for(var _=i.readUEG(),v=0;v<_;v++)i.readSEG()}var m=i.readUEG();i.readBits(1);var p=i.readUEG(),y=i.readUEG(),g=i.readBits(1);0===g&&i.readBits(1),i.readBits(1);var b=0,w=0,k=0,E=0;i.readBool()&&(b=i.readUEG(),w=i.readUEG(),k=i.readUEG(),E=i.readUEG());var D=1,S=1,A=0,T=!0,x=0,R=0;if(i.readBool()){if(i.readBool()){var C=i.readByte();C>0&&C<16?(D=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][C-1],S=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][C-1]):255===C&&(D=i.readByte()<<8|i.readByte(),S=i.readByte()<<8|i.readByte())}if(i.readBool()&&i.readBool(),i.readBool()&&(i.readBits(4),i.readBool()&&i.readBits(24)),i.readBool()&&(i.readUEG(),i.readUEG()),i.readBool()){var L=i.readBits(32),I=i.readBits(32);T=i.readBool(),A=(x=I)/(R=2*L)}}var U=1;1===D&&1===S||(U=D/S);var B=0,P=0;0===u?(B=1,P=2-g):(B=3===u?1:2,P=(1===u?2:1)*(2-g));var O=16*(p+1),F=16*(y+1)*(2-g);O-=(b+w)*B,F-=(k+E)*P;var M=Math.ceil(O*U);return i.destroy(),i=null,{profile_string:s,level_string:a,bit_depth:h,ref_frames:m,chroma_format:l,chroma_format_string:e.getChromaFormatString(l),frame_rate:{fixed:T,fps:A,fps_den:R,fps_num:x},sar_ratio:{width:D,height:S},codec_size:{width:O,height:F},present_size:{width:M,height:F}}}},{key:"_skipScalingList",value:function(e,t){for(var n=8,i=8,r=0;r<t;r++)0!==i&&(i=(n+e.readSEG()+256)%256),n=0===i?n:i}},{key:"getProfileString",value:function(e){switch(e){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}}},{key:"getLevelString",value:function(e){return(e/10).toFixed(1)}},{key:"getChromaFormatString",value:function(e){switch(e){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}}}],(n=null)&&Re(t.prototype,n),i&&Re(t,i),e}();function Le(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Ie=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,i;return t=e,i=[{key:"_ebsp2rbsp",value:function(e){for(var t=e,n=t.byteLength,i=new Uint8Array(n),r=0,o=0;o<n;o++)o>=2&&3===t[o]&&0===t[o-1]&&0===t[o-2]||(i[r]=t[o],r++);return new Uint8Array(i.buffer,0,r)}},{key:"parseSPS",value:function(t){var n=e._ebsp2rbsp(t),i=new xe(n),r={};i.readBits(16),i.readBits(4);var o=i.readBits(3);i.readBits(1),e._hvcc_parse_ptl(i,r,o),i.readUEG();var s=0,a=i.readUEG();3==a&&(s=i.readBits(1)),r.sar_width=r.sar_height=1,r.conf_win_left_offset=r.conf_win_right_offset=r.conf_win_top_offset=r.conf_win_bottom_offset=0,r.def_disp_win_left_offset=r.def_disp_win_right_offset=r.def_disp_win_top_offset=r.def_disp_win_bottom_offset=0;var u=i.readUEG(),l=i.readUEG();i.readBits(1)&&(r.conf_win_left_offset=i.readUEG(),r.conf_win_right_offset=i.readUEG(),r.conf_win_top_offset=i.readUEG(),r.conf_win_bottom_offset=i.readUEG(),1===r.default_display_window_flag&&(r.conf_win_left_offset,r.def_disp_win_left_offset,r.conf_win_right_offset,r.def_disp_win_right_offset,r.conf_win_top_offset,r.def_disp_win_top_offset,r.conf_win_bottom_offset,r.def_disp_win_bottom_offset));var h=i.readUEG()+8;i.readUEG();for(var c=i.readUEG(),d=i.readBits(1)?0:o;d<=o;d++)e._skip_sub_layer_ordering_info(i);i.readUEG(),i.readUEG(),i.readUEG(),i.readUEG(),i.readUEG(),i.readUEG(),i.readBits(1)&&i.readBits(1)&&e._skip_scaling_list_data(i),i.readBits(1),i.readBits(1),i.readBits(1)&&(i.readBits(4),i.readBits(4),i.readUEG(),i.readUEG(),i.readBits(1));var f=[],_=i.readUEG();for(d=0;d<_;d++){var v=e._parse_rps(i,d,_,f);if(v<0)return v}if(i.readBits(1)){var m=i.readUEG();for(d=0;d<m;d++){var p=Math.min(c+4,16);if(p>32){for(var y=p/32,g=p%32,b=0;b<y;b++)i.readBits(32);i.readBits(g)}else i.readBits(p);i.readBits(1)}}i.readBits(1),i.readBits(1),i.readBits(1)&&e._hvcc_parse_vui(i,r,o);var w=e.getProfileString(r.profile_idc),k=e.getLevelString(r.level_idc),E=1;1===r.sar_width&&1===r.sar_height||(E=r.sar_width/r.sar_height);var D=u,S=l,A=1===a&&0===s?2:1;D-=(1!==a&&2!=a||0!==s?1:2)*(r.conf_win_left_offset+r.conf_win_right_offset),S-=A*(r.conf_win_top_offset+r.conf_win_bottom_offset);var T=Math.ceil(D*E);return i.destroy(),i=null,{profile_string:w,level_string:k,profile_idc:r.profile_idc,level_idc:r.level_idc,bit_depth:h,ref_frames:1,chroma_format:a,chroma_format_string:e.getChromaFormatString(a),frame_rate:{fixed:r.fps_fixed?r.fps_fixed:0,fps:r.fps?r.fps:25,fps_den:r.fps_den?r.fps_den:1,fps_num:r.fps_num?r.fps_num:25},sar_ratio:{width:r.sar_width,height:r.sar_height},codec_size:{width:D,height:S},present_size:{width:T,height:S}}}},{key:"_hvcc_parse_ptl",value:function(e,t,n){e.readBits(2);var i=e.readBits(1),r=e.readBits(5);e.readBits(32),e.readBits(32),e.readBits(16);var o=e.readByte();void 0===t.tier_flag||void 0===t.level_idc||t.tier_flag<i?t.level_idc=o:t.level_idc=Math.max(t.level_idc,o),t.profile_idc=Math.max(void 0===t.profile_idc?0:t.profile_idc,r);for(var s=[],a=[],u=0;u<n;u++)s.push(e.readBits(1)),a.push(e.readBits(1));if(n>0)for(u=n;u<8;u++)e.readBits(2);for(u=0;u<n;u++)s[u]&&(e.readBits(32),e.readBits(32),e.readBits(24)),a[u]&&e.readByte()}},{key:"_parse_rps",value:function(e,t,n,i){if(t&&e.readBits(1)){if(t>=n)return-1;e.readBits(1),e.readUEG(),i[t]=0;for(var r=0;r<=i[t-1];r++){var o=0,s=e.readBits(1);s||(o=e.readBits(1)),(s||o)&&i[t]++}}else{var a=e.readUEG(),u=e.readUEG();for(i[t]=a+u,r=0;r<a;r++)e.readUEG(),e.readBits(1);for(r=0;r<u;r++)e.readUEG(),e.readBits(1)}return 0}},{key:"_hvcc_parse_vui",value:function(t,n,i){t.readBits(1)&&255==t.readByte()&&(n.sar_width=t.readBits(16),n.sar_height=t.readBits(16)),t.readBits(1)&&t.readBits(1),t.readBits(1)&&(t.readBits(4),t.readBits(1)&&t.readBits(24)),t.readBits(1)&&(t.readUEG(),t.readUEG()),t.readBits(3),n.default_display_window_flag=t.readBits(1),n.default_display_window_flag&&(n.def_disp_win_left_offset=t.readUEG(),n.def_disp_win_right_offset=t.readUEG(),n.def_disp_win_top_offset=t.readUEG(),n.def_disp_win_bottom_offset=t.readUEG()),t.readBits(1)&&(e._skip_timing_info(t,n),t.readBits(1)&&e._skip_hrd_parameters(t,n,1,i)),t.readBits(1)&&(t.readBits(3),t.readUEG(),t.readUEG(),t.readUEG(),t.readUEG(),t.readUEG())}},{key:"_skip_sub_layer_ordering_info",value:function(e,t){e.readUEG(),e.readUEG(),e.readUEG()}},{key:"_skip_scaling_list_data",value:function(e){for(var t=0;t<4;t++)for(var n=0;n<(3==t?2:6);n++)if(e.readBits(1)){var i=Math.min(64,1<<4+(t<<1));t>1&&e.readSEG();for(var r=0;r<i;r++)e.readSEG()}else e.readUEG()}},{key:"_skip_sub_layer_hrd_parameters",value:function(e,t,n){for(var i=0;i<=t;i++)e.readUEG(),e.readUEG(),n&&(e.readUEG(),e.readUEG()),e.readBits(1)}},{key:"_skip_timing_info",value:function(e,t){t.fps_den=e.readBits(32),t.fps_num=e.readBits(32),t.fps_den>0&&(t.fps=t.fps_num/t.fps_den);var n=0;e.readBits(1)&&(n=e.readUEG())>=0&&(t.fps/=n+1)}},{key:"_skip_hrd_parameters",value:function(t,n,i){var r=0,o=0;if(n&&(r=t.readBits(1),o=t.readBits(1),r||o)){var s=t.readBits(1);s&&t.readBits(19),t.readByte(),s&&t.readBits(4),t.readBits(15)}for(var a=0;a<=i;a++){var u=0,l=0,h=0,c=t.readBits(1);hvcc.fps_fixed=c,c||(h=t.readBits(1)),h?t.readUEG():l=t.readBits(1),l||(u=t.readUEG(t)),r&&e._skip_sub_layer_hrd_parameters(t,u,0),o&&e._skip_sub_layer_hrd_parameters(t,u,0)}}},{key:"getProfileString",value:function(e){switch(e){case 1:return"Main";case 2:return"Main10";case 3:return"MainSP";case 4:return"Rext";case 9:return"SCC";default:return"Unknown"}}},{key:"getLevelString",value:function(e){return(e/30).toFixed(1)}},{key:"getChromaFormatString",value:function(e){switch(e){case 0:return"4:0:0";case 1:return"4:2:0";case 2:return"4:2:2";case 3:return"4:4:4";default:return"Unknown"}}}],(n=null)&&Le(t.prototype,n),i&&Le(t,i),e}();function Ue(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Be=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._onTrackMetadata=null,this._onDataAvailable=null,this._firstParse=!0,this._probeData=null,this._scriptData=null,this._hasAudio=!1,this._hasVideo=!0,this._presentAudio=!0,this._dispatch=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new Ae,this._mediaInfo.hasAudio=!1,this._mediaInfo.hasVideo=!0,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:25,fps_num:50,fps_den:2},this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],this._mpegAudioV10SampleRateTable=[44100,48e3,32e3,0],this._mpegAudioV20SampleRateTable=[22050,24e3,16e3,0],this._mpegAudioV25SampleRateTable=[11025,12e3,8e3,0],this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},this._littleEndian=function(){var e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),256===new Int16Array(e)[0]}(),this._tempBuffer=null,this._audioCtx=new(window.AudioContext||window.webkitAudioContext)}var t,n,i;return t=e,(n=[{key:"destroy",value:function(){this._probeData=null,this._scriptData=null,this._mediaInfo=null,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._videoTrack=null,this._audioTrack=null,this._onTrackMetadata=null,this._onDataAvailable=null}},{key:"_probe",value:function(e){var t=new Uint8Array(e),n={match:!1};if(70!==t[0]||76!==t[1]||86!==t[2]||1!==t[3])return n;var i=(4&t[4])>>>2!=0,r=0!=(1&t[4]),o=this._ReadBig32(t,5);return o<9?n:{match:!0,consumed:o,dataOffset:o,hasAudioTrack:i,hasVideoTrack:r}}},{key:"parseChunks",value:function(e,t){var n=0;if(this._firstParse&&(this._firstParse=!1,this._probeData=this._probe(e),n=this._probeData.dataOffset,new DataView(e,n).getUint32(0),n+=4),this._tempBuffer){var i=new Uint8Array(this._tempBuffer.byteLength+e.byteLength);i.set(new Uint8Array(this._tempBuffer),0),i.set(new Uint8Array(e),this._tempBuffer.byteLength),e=i.buffer,this._tempBuffer=null}for(;n<e.byteLength;){this._dispatch=!0;var r=new DataView(e,n);if(n+11+4>e.byteLength)break;var o=r.getUint8(0),s=16777215&r.getUint32(0);if(8===o||9===o||18===o){var a=r.getUint8(4),u=r.getUint8(5),l=r.getUint8(6)|u<<8|a<<16|r.getUint8(7)<<24,h=(r.getUint32(7),n+11);if(n+11+4+s>r.byteLength){this._tempBuffer=e.slice(h-11);break}switch(o){case 8:if(!this._presentAudio)return;this._parseAudioData(e,h,s,l);break;case 9:this._parseVideoData(e,h,s,l,t+n);break;case 18:this._parseScriptData(e,h,s)}r.getUint32(11+s),n+=11+s+4}else n+=11+s+4}return this._isInitialMetadataDispatched()&&this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack),n}},{key:"_parseScriptData",value:function(e,t,n){}},{key:"_parseAudioData",value:function(e,t,n,i){if(!(n<=1)){this._littleEndian;var r=new DataView(e,t,n).getUint8(0),o=r>>>4;if(2===o||10===o){var s=0,a=(12&r)>>>2;if(a>=0&&a<=4){s=this._flvSoundRateTable[a];var u=1&r,l=this._audioMetadata,h=this._audioTrack;if(l||(!1===this._hasAudio&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),(l=this._audioMetadata={}).type="audio",l.id=h.id,l.timescale=this._timescale,l.duration=this._duration,l.audioSampleRate=s,l.channelCount=0===u?1:2),10===o){var c=this._parseAACAudioData(e,t+1,n-1);if(null==c)return;if(0===c.packetType){l.config;var d=c.data;l.audioSampleRate=d.samplingRate,l.channelCount=d.channelCount,l.codec=d.codec,l.originalCodec=d.originalCodec,l.config=d.config,l.refSampleDuration=1024/l.audioSampleRate*l.timescale,this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",l);var f=this._mediaInfo;f.audioCodec=l.originalCodec,f.audioSampleRate=l.audioSampleRate,f.audioChannelCount=l.channelCount,f.hasVideo?null!=f.videoCodec&&(f.mimeType='video/x-flv; codecs="'+f.videoCodec+","+f.audioCodec+'"'):f.mimeType='video/x-flv; codecs="'+f.audioCodec+'"',f.isComplete()}else if(1===c.packetType){var _=this._timestampBase+i,v={unit:c.data,length:c.data.byteLength,dts:_,pts:_};h.samples.push(v),h.length+=c.data.length}}}}}}},{key:"_parseAACAudioData",value:function(e,t,n){if(!(n<=1)){var i={},r=new Uint8Array(e,t,n);return i.packetType=r[0],0===r[0]?i.data=this._parseAACAudioSpecificConfig(e,t+1,n-1):i.data=r.subarray(1),i}}},{key:"_parseAACAudioSpecificConfig",value:function(e,t,n){var i,r,o=new Uint8Array(e,t,n),s=null,a=0,u=null;if(a=i=o[0]>>>3,!((r=(7&o[0])<<1|o[1]>>>7)<0||r>=this._mpegSamplingRates.length)){var l=this._mpegSamplingRates[r],h=(120&o[1])>>>3;if(!(h<0||h>=8)){5===a&&(u=(7&o[1])<<1|o[2]>>>7,o[2]);var c=self.navigator.userAgent.toLowerCase();return-1!==c.indexOf("firefox")?r>=6?(a=5,s=new Array(4),u=r-3):(a=2,s=new Array(2),u=r):-1!==c.indexOf("android")?(a=2,s=new Array(2),u=r):(a=5,u=r,s=new Array(4),r>=6?u=r-3:1===h&&(a=2,s=new Array(2),u=r)),s[0]=a<<3,s[0]|=(15&r)>>>1,s[1]=(15&r)<<7,s[1]|=(15&h)<<3,5===a&&(s[1]|=(15&u)>>>1,s[2]=(1&u)<<7,s[2]|=8,s[3]=0),{config:s,samplingRate:l,channelCount:h,codec:"mp4a.40."+a,originalCodec:"mp4a.40."+i}}}}},{key:"_parseVideoData",value:function(e,t,n,i,r){if(!(n<=1)){var o=new Uint8Array(e,t,n)[0],s=(240&o)>>>4,a=15&o;7===a||12===a?7===a?this._parseAVCVideoPacket(e,t+1,n-1,i,r,s):12===a&&this._parseHVCVideoPacket(e,t+1,n-1,i,r,s):this._onError(DemuxErrors.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: ".concat(a))}}},{key:"_parseAVCVideoPacket",value:function(e,t,n,i,r,o){if(!(n<4)){var s=new DataView(e,t,n),a=s.getUint8(0),u=(16777215&s.getUint32(0))<<8>>8;if(0===a)this._parseAVCDecoderConfigurationRecord(e,t+4,n-4);else if(1===a)this._parseAVCVideoData(e,t+4,n-4,i,r,o,u);else if(2!==a)return}}},{key:"_parseAVCDecoderConfigurationRecord",value:function(e,t,n){var i=this._videoMetadata,r=this._videoTrack,o=this._littleEndian,s=new DataView(e,t,n);if(i?i.avcc:((i=this._videoMetadata={}).type="video",i.id=r.id,i.timescale=this._timescale,i.duration=this._duration),s.getUint8(0),s.getUint8(1),s.getUint8(2),s.getUint8(3),this._naluLengthSize=1+(3&s.getUint8(4)),3===this._naluLengthSize||4===this._naluLengthSize){var a=31&s.getUint8(5);if(0!==a){for(var u,l=6,h=0;h<a;h++){var c=s.getUint16(l,!o);if(l+=2,0!==c){u=new Uint8Array(e,t+l,c),l+=c;var d=Ce.parseSPS(u);if(0===h){i.codecWidth=d.codec_size.width,i.codecHeight=d.codec_size.height,i.presentWidth=d.present_size.width,i.presentHeight=d.present_size.height,i.profile=d.profile_string,i.level=d.level_string,i.bitDepth=d.bit_depth,i.chromaFormat=d.chroma_format,i.sarRatio=d.sar_ratio,i.frameRate=d.frame_rate,!1!==d.frame_rate.fixed&&0!==d.frame_rate.fps_num&&0!==d.frame_rate.fps_den||(i.frameRate=this._referenceFrameRate);var f=i.frameRate.fps_den,_=i.frameRate.fps_num;i.refSampleDuration=i.timescale*(f/_);for(var v=u.subarray(1,4),m="avc1.",p=0;p<3;p++){var y=v[p].toString(16);y.length<2&&(y="0"+y),m+=y}i.codec=m;var g=this._mediaInfo;g.width=i.codecWidth,g.height=i.codecHeight,g.fps=i.frameRate.fps,g.profile=i.profile,g.level=i.level,g.refFrames=d.ref_frames,g.chromaFormat=d.chroma_format_string,g.sarNum=i.sarRatio.width,g.sarDen=i.sarRatio.height,g.videoCodec=m,g.hasAudio?null!=g.audioCodec&&(g.mimeType='video/x-flv; codecs="'+g.videoCodec+","+g.audioCodec+'"'):g.mimeType='video/x-flv; codecs="'+g.videoCodec+'"',g.isComplete()}}}var b=s.getUint8(l);if(0!==b){l++;for(var w=0;w<b;w++){var k=s.getUint16(l,!o);l+=2,0!==k&&(l+=k)}i.avcc=new Uint8Array(n),i.avcc.set(new Uint8Array(e,t,n),0),this._onTrackMetadata("video",i)}}}}},{key:"_parseAVCVideoData",value:function(e,t,n,i,r,o,s){for(var a=this._littleEndian,u=new DataView(e,t,n),l=[],h=0,c=0,d=this._naluLengthSize,f=this._timestampBase+i,_=1===o;c<n&&!(c+4>=n);){var v=u.getUint32(c,!a);if(3===d&&(v>>>=8),v>n-d)return;var m=31&u.getUint8(c+d);5===m&&(_=!0);var p=new Uint8Array(e,t+c,d+v),y={type:m,data:p};l.push(y),h+=p.byteLength,c+=d+v}if(l.length){var g=this._videoTrack,b={units:l,length:h,isKeyframe:_,dts:f,cts:s,pts:f+s};_&&(b.fileposition=r),g.samples.push(b),g.length+=h,g.samples.length>3&&(this._videoInitialMetadataDispatched=!0)}}},{key:"_parseHVCVideoPacket",value:function(e,t,n,i,r,o){if(!(n<4)){var s=this._littleEndian,a=new DataView(e,t,n),u=a.getUint8(0),l=(16777215&a.getUint32(0,!s))<<8>>8;if(0===u)this._parseHVCDecoderConfigurationRecord(e,t+4,n-4);else if(1===u)this._parseHVCVideoData(e,t+4,n-4,i,r,o,l);else if(2!==u)return void this._onError(DemuxErrors.FORMAT_ERROR,"Flv: Invalid video packet type "+u)}}},{key:"_parseHVCDecoderConfigurationRecord",value:function(e,t,n){if(!(n<23)){var i=this._videoMetadata,r=this._videoTrack,o=this._littleEndian,s=new DataView(e,t,n);if(i?i.avcc:(!1===this._hasVideo&&!1===this._hasVideoFlagOverrided&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),(i=this._videoMetadata={}).type="video",i.id=r.id,i.timescale=this._timescale,i.duration=this._duration),1===s.getUint8(0))if(this._naluLengthSize=1+(3&s.getUint8(21)),3===this._naluLengthSize||4===this._naluLengthSize){for(var a,u,l,h=s.getUint8(22),c=23,d=[],f=0;f<h;f++){var _=63&s.getUint8(c++),v=s.getUint16(c,!o);if(c+=2,0!==v){switch(_){case 32:a+=v;break;case 33:u+=v;break;case 34:l+=v}for(var m=0;m<v;m++){var p=s.getUint16(c,!o);if(c+=2,0!==p){if(33===_){var y=new Uint8Array(e,t+c,p);d.push(y)}c+=p}}}}if(0!==a)if(0!==u)if(0!==l){var g=d[0],b=Ie.parseSPS(g);i.codecWidth=b.codec_size.width,i.codecHeight=b.codec_size.height,i.presentWidth=b.present_size.width,i.presentHeight=b.present_size.height,i.profile=b.profile_string,i.level=b.level_string,i.profile_idc=b.profile_idc,i.level_idc=b.level_idc,i.bitDepth=b.bit_depth,i.chromaFormat=b.chroma_format,i.sarRatio=b.sar_ratio,i.frameRate=b.frame_rate,!1!==b.frame_rate.fixed&&0!==b.frame_rate.fps_num&&0!==b.frame_rate.fps_den||(i.frameRate=this._referenceFrameRate);var w=i.frameRate.fps_den,k=i.frameRate.fps_num;i.refSampleDuration=i.timescale*(w/k);var E="hvc1."+i.profile_idc+".6.L"+i.level_idc+".B0";i.codec=E;var D=this._mediaInfo;D.width=i.codecWidth,D.height=i.codecHeight,D.fps=i.frameRate.fps,D.profile=i.profile,D.level=i.level,D.refFrames=b.ref_frames,D.chromaFormat=b.chroma_format_string,D.sarNum=i.sarRatio.width,D.sarDen=i.sarRatio.height,D.videoCodec=E,D.hasAudio?null!=D.audioCodec&&(D.mimeType='video/x-flv; codecs="'+D.videoCodec+","+D.audioCodec+'"'):D.mimeType='video/x-flv; codecs="'+D.videoCodec+'"',D.isComplete()&&this._onMediaInfo(D),i.avcc=new Uint8Array(n),i.avcc.set(new Uint8Array(e,t,n),0),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",i)}else this._onError(DemuxErrors.FORMAT_ERROR,"Flv: Invalid HVCDecoderConfigurationRecord: No PPS");else this._onError(DemuxErrors.FORMAT_ERROR,"Flv: Invalid HVCDecoderConfigurationRecord: No SPS");else this._onError(DemuxErrors.FORMAT_ERROR,"Flv: Invalid HVCDecoderConfigurationRecord: No VPS")}else this._onError(DemuxErrors.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));else this._onError(DemuxErrors.FORMAT_ERROR,"Flv: Invalid HVCDecoderConfigurationRecord")}}},{key:"_parseHVCVideoData",value:function(e,t,n,i,r,o,s){for(var a=this._littleEndian,u=new DataView(e,t,n),l=[],h=0,c=0,d=this._naluLengthSize,f=this._timestampBase+i,_=1===o;c<n&&!(c+4>=n);){var v=u.getUint32(c,!a);if(3===d&&(v>>>=8),v>n-d)return;var m=u.getUint8(c+d)>>1&63;m>=16&&m<=23&&(_=!0);var p=new Uint8Array(e,t+c,d+v),y={type:m,data:p};l.push(y),h+=p.byteLength,c+=d+v}if(l.length){var g=this._videoTrack,b={units:l,length:h,isKeyframe:_,dts:f,cts:s,pts:f+s};_&&(b.fileposition=r),g.samples.push(b),g.length+=h}}},{key:"_isInitialMetadataDispatched",value:function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!(this._hasAudio||!this._hasVideo)&&this._videoInitialMetadataDispatched}},{key:"_ReadBig32",value:function(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}},{key:"onTrackMetadata",get:function(){return this._onTrackMetadata},set:function(e){this._onTrackMetadata=e}},{key:"onDataAvailable",get:function(){return this._onDataAvailable},set:function(e){this._onDataAvailable=e}},{key:"presentAudio",set:function(e){this._presentAudio=e}}])&&Ue(t.prototype,n),i&&Ue(t,i),e}();function Pe(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Oe=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,i;return t=e,i=[{key:"getSilentFrame",value:function(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}}],(n=null)&&Pe(t.prototype,n),i&&Pe(t,i),e}();function Fe(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Me=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,i;return t=e,i=[{key:"init",value:function(){for(var t in e.types={hvc1:[],hvcC:[],avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[]},e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var n=e.constants={};n.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),n.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),n.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),n.STSC=n.STCO=n.STTS,n.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),n.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),n.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),n.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),n.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}},{key:"box",value:function(e){for(var t=8,n=null,i=Array.prototype.slice.call(arguments,1),r=i.length,o=0;o<r;o++)t+=i[o].byteLength;(n=new Uint8Array(t))[0]=t>>>24&255,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=255&t,n.set(e,4);for(var s=8,a=0;a<r;a++)n.set(i[a],s),s+=i[a].byteLength;return n}},{key:"generateInitSegment",value:function(t){var n=e.box(e.types.ftyp,e.constants.FTYP),i=e.moov(t),r=new Uint8Array(n.byteLength+i.byteLength);return r.set(n,0),r.set(i,n.byteLength),r}},{key:"moov",value:function(t){var n=e.mvhd(t.timescale,t.duration),i=e.trak(t),r=e.mvex(t);return e.box(e.types.moov,n,i,r)}},{key:"mvhd",value:function(t,n){return e.box(e.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t,n>>>24&255,n>>>16&255,n>>>8&255,255&n,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))}},{key:"trak",value:function(t){return e.box(e.types.trak,e.tkhd(t),e.mdia(t))}},{key:"tkhd",value:function(t){var n=t.id,i=t.duration,r=t.presentWidth,o=t.presentHeight;return e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,255&n,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>>8&255,255&r,0,0,o>>>8&255,255&o,0,0]))}},{key:"mdia",value:function(t){return e.box(e.types.mdia,e.mdhd(t),e.hdlr(t),e.minf(t))}},{key:"mdhd",value:function(t){var n=t.timescale,i=t.duration;return e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,255&n,i>>>24&255,i>>>16&255,i>>>8&255,255&i,85,196,0,0]))}},{key:"hdlr",value:function(t){var n=null;return n="audio"===t.type?e.constants.HDLR_AUDIO:e.constants.HDLR_VIDEO,e.box(e.types.hdlr,n)}},{key:"minf",value:function(t){var n=null;return n="audio"===t.type?e.box(e.types.smhd,e.constants.SMHD):e.box(e.types.vmhd,e.constants.VMHD),e.box(e.types.minf,n,e.dinf(),e.stbl(t))}},{key:"dinf",value:function(){return e.box(e.types.dinf,e.box(e.types.dref,e.constants.DREF))}},{key:"stbl",value:function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.constants.STTS),e.box(e.types.stsc,e.constants.STSC),e.box(e.types.stsz,e.constants.STSZ),e.box(e.types.stco,e.constants.STCO))}},{key:"stsd",value:function(t){return"audio"===t.type?"mp3"===t.codec?e.box(e.types.stsd,e.constants.STSD_PREFIX,e.mp3(t)):e.box(e.types.stsd,e.constants.STSD_PREFIX,e.mp4a(t)):e.box(e.types.stsd,e.constants.STSD_PREFIX,e.avc1(t))}},{key:"mp3",value:function(t){var n=t.channelCount,i=t.audioSampleRate,r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,n,0,16,0,0,0,0,i>>>8&255,255&i,0,0]);return e.box(e.types[".mp3"],r)}},{key:"mp4a",value:function(t){var n=t.channelCount,i=t.audioSampleRate,r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,n,0,16,0,0,0,0,i>>>8&255,255&i,0,0]);return e.box(e.types.mp4a,r,e.esds(t))}},{key:"esds",value:function(t){var n=t.config||[],i=n.length,r=new Uint8Array([0,0,0,0,3,23+i,0,1,0,4,15+i,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([i]).concat(n).concat([6,1,2]));return e.box(e.types.esds,r)}},{key:"avc1",value:function(t){var n=t.avcc,i=t.codecWidth,r=t.codecHeight,o=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,i>>>8&255,255&i,r>>>8&255,255&r,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return t.codec.indexOf("avc1")>=0?e.box(e.types.avc1,o,e.box(e.types.avcC,n)):e.box(e.types.hvc1,o,e.box(e.types.hvcC,n))}},{key:"mvex",value:function(t){return e.box(e.types.mvex,e.trex(t))}},{key:"trex",value:function(t){var n=t.id,i=new Uint8Array([0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,255&n,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return e.box(e.types.trex,i)}},{key:"moof",value:function(t,n){return e.box(e.types.moof,e.mfhd(t.sequenceNumber),e.traf(t,n))}},{key:"mfhd",value:function(t){var n=new Uint8Array([0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t]);return e.box(e.types.mfhd,n)}},{key:"traf",value:function(t,n){var i=t.id,r=e.box(e.types.tfhd,new Uint8Array([0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i])),o=e.box(e.types.tfdt,new Uint8Array([0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,255&n])),s=e.sdtp(t),a=e.trun(t,s.byteLength+16+16+8+16+8+8);return e.box(e.types.traf,r,o,a,s)}},{key:"sdtp",value:function(t){for(var n=t.samples||[],i=n.length,r=new Uint8Array(4+i),o=0;o<i;o++){var s=n[o].flags;r[o+4]=s.isLeading<<6|s.dependsOn<<4|s.isDependedOn<<2|s.hasRedundancy}return e.box(e.types.sdtp,r)}},{key:"trun",value:function(t,n){var i=t.samples||[],r=i.length,o=12+16*r,s=new Uint8Array(o);n+=8+o,s.set([0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,255&r,n>>>24&255,n>>>16&255,n>>>8&255,255&n],0);for(var a=0;a<r;a++){var u=i[a].duration,l=i[a].size,h=i[a].flags,c=i[a].cts;s.set([u>>>24&255,u>>>16&255,u>>>8&255,255&u,l>>>24&255,l>>>16&255,l>>>8&255,255&l,h.isLeading<<2|h.dependsOn,h.isDependedOn<<6|h.hasRedundancy<<4|h.isNonSync,0,0,c>>>24&255,c>>>16&255,c>>>8&255,255&c],12+16*a)}return e.box(e.types.trun,s)}},{key:"mdat",value:function(t){return e.box(e.types.mdat,t)}}],(n=null)&&Fe(t.prototype,n),i&&Fe(t,i),e}();Me.init();var He=Me,je={};!function(){var e=self.navigator.userAgent.toLowerCase(),t=/(edge)\/([\w.]+)/.exec(e)||/(opr)[\/]([\w.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(iemobile)[\/]([\w.]+)/.exec(e)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(e)||[],n=/(ipad)/.exec(e)||/(ipod)/.exec(e)||/(windows phone)/.exec(e)||/(iphone)/.exec(e)||/(kindle)/.exec(e)||/(android)/.exec(e)||/(windows)/.exec(e)||/(mac)/.exec(e)||/(linux)/.exec(e)||/(cros)/.exec(e)||[],i={browser:t[5]||t[3]||t[1]||"",version:t[2]||t[4]||"0",majorVersion:t[4]||t[2]||"0",platform:n[0]||""},r={};if(i.browser){r[i.browser]=!0;var o=i.majorVersion.split(".");r.version={major:parseInt(i.majorVersion,10),string:i.version},o.length>1&&(r.version.minor=parseInt(o[1],10)),o.length>2&&(r.version.build=parseInt(o[2],10))}if(i.platform&&(r[i.platform]=!0),(r.chrome||r.opr||r.safari)&&(r.webkit=!0),r.rv||r.iemobile){r.rv&&delete r.rv;i.browser="msie",r.msie=!0}if(r.edge){delete r.edge;i.browser="msedge",r.msedge=!0}if(r.opr){i.browser="opera",r.opera=!0}if(r.safari&&r.android){i.browser="android",r.android=!0}for(var s in r.name=i.browser,r.platform=i.platform,je)je.hasOwnProperty(s)&&delete je[s];Object.assign(je,r)}();var We=je;function Ne(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Ve(e,t,n){return t&&Ne(e.prototype,t),n&&Ne(e,n),e}function Ge(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var ze=function e(t,n,i,r,o){Ge(this,e),this.dts=t,this.pts=n,this.duration=i,this.originalDts=r,this.isSyncPoint=o,this.fileposition=null},$e=function(){function e(){Ge(this,e),this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}return Ve(e,[{key:"appendSyncPoint",value:function(e){e.isSyncPoint=!0,this.syncPoints.push(e)}}]),e}(),qe=function(){function e(){Ge(this,e),this._list=[]}return Ve(e,[{key:"clear",value:function(){this._list=[]}},{key:"appendArray",value:function(e){var t=this._list;0!==e.length&&(t.length>0&&e[0].originalDts<t[t.length-1].originalDts&&this.clear(),Array.prototype.push.apply(t,e))}},{key:"getLastSyncPointBeforeDts",value:function(e){if(0==this._list.length)return null;var t=this._list,n=0,i=t.length-1,r=0,o=0,s=i;for(e<t[0].dts&&(n=0,o=s+1);o<=s;){if((r=o+Math.floor((s-o)/2))===i||e>=t[r].dts&&e<t[r+1].dts){n=r;break}t[r].dts<e?o=r+1:s=r-1}return this._list[n]}}]),e}(),Ye=function(){function e(t){Ge(this,e),this._type=t,this._list=[],this._lastAppendLocation=-1}return Ve(e,[{key:"isEmpty",value:function(){return 0===this._list.length}},{key:"clear",value:function(){this._list=[],this._lastAppendLocation=-1}},{key:"_searchNearestSegmentBefore",value:function(e){var t=this._list;if(0===t.length)return-2;var n=t.length-1,i=0,r=0,o=n,s=0;if(e<t[0].originalBeginDts)return s=-1;for(;r<=o;){if((i=r+Math.floor((o-r)/2))===n||e>t[i].lastSample.originalDts&&e<t[i+1].originalBeginDts){s=i;break}t[i].originalBeginDts<e?r=i+1:o=i-1}return s}},{key:"_searchNearestSegmentAfter",value:function(e){return this._searchNearestSegmentBefore(e)+1}},{key:"append",value:function(e){var t=this._list,n=e,i=this._lastAppendLocation,r=0;-1!==i&&i<t.length&&n.originalBeginDts>=t[i].lastSample.originalDts&&(i===t.length-1||i<t.length-1&&n.originalBeginDts<t[i+1].originalBeginDts)?r=i+1:t.length>0&&(r=this._searchNearestSegmentBefore(n.originalBeginDts)+1),this._lastAppendLocation=r,this._list.splice(r,0,n)}},{key:"getLastSegmentBefore",value:function(e){var t=this._searchNearestSegmentBefore(e);return t>=0?this._list[t]:null}},{key:"getLastSampleBefore",value:function(e){var t=this.getLastSegmentBefore(e);return null!=t?t.lastSample:null}},{key:"getLastSyncPointBefore",value:function(e){for(var t=this._searchNearestSegmentBefore(e),n=this._list[t].syncPoints;0===n.length&&t>0;)t--,n=this._list[t].syncPoints;return n.length>0?n[n.length-1]:null}},{key:"type",get:function(){return this._type}},{key:"length",get:function(){return this._list.length}}]),e}();function Xe(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Qe=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.TAG="MP4Remuxer",this._isLive=!0,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._audioMeta=null,this._videoMeta={refSampleDuration:40},this._audioSegmentInfoList=new Ye("audio"),this._videoSegmentInfoList=new Ye("video"),this._onInitSegment=null,this._onMediaSegment=null,this._forceFirstIDR=!(!We.chrome||!(We.version.major<50||50===We.version.major&&We.version.build<2661)),this._fillSilentAfterSeek=We.msedge||We.msie,this._mp3UseMpegAudio=!1,this._fillAudioTimestampGap=!0}var t,n,i;return t=e,(n=[{key:"destroy",value:function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null,this._onInitSegment=null,this._onMediaSegment=null}},{key:"remux",value:function(e,t){this._dtsBaseInited||this._calculateDtsBase(e,t),this._remuxVideo(t),this._remuxAudio(e)}},{key:"trackMetadataReceived",value:function(e,t){var n=null,i=t.codec;if("video"===e)this._videoMeta=t,n=He.generateInitSegment(t);else{if("audio"!==e)return;this._audioMeta=t,n=He.generateInitSegment(t)}this._onInitSegment(e,{type:e,data:n.buffer,codec:i,container:"".concat(e,"/").concat("mp4"),mediaDuration:t.duration})}},{key:"_calculateDtsBase",value:function(e,t){this._dtsBaseInited||(e.samples&&e.samples.length&&(this._audioDtsBase=e.samples[0].dts),t.samples&&t.samples.length&&(this._videoDtsBase=t.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)}},{key:"_remuxAudio",value:function(e,t){if(null!=this._audioMeta){var n,i=e,r=i.samples,o=void 0,s=-1,a=this._audioMeta.refSampleDuration,u="mp3"===this._audioMeta.codec&&this._mp3UseMpegAudio,l=this._dtsBaseInited&&void 0===this._audioNextDts,h=!1;if(r&&0!==r.length&&(1!==r.length||t)){var c=0,d=null,f=0;u?(c=0,f=i.length):(c=8,f=8+i.length);var _=null;if(r.length>1&&(f-=(_=r.pop()).length),null!=this._audioStashedLastSample){var v=this._audioStashedLastSample;this._audioStashedLastSample=null,r.unshift(v),f+=v.length}null!=_&&(this._audioStashedLastSample=_);var m=r[0].dts-this._dtsBase;if(this._audioNextDts)o=m-this._audioNextDts;else if(this._audioSegmentInfoList.isEmpty())o=0,this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()&&"mp3"!==this._audioMeta.originalCodec&&(h=!0);else{var p=this._audioSegmentInfoList.getLastSampleBefore(m);if(null!=p){var y=m-(p.originalDts+p.duration);y<=3&&(y=0),o=m-(p.dts+p.duration+y)}else o=0}if(h){var g=m-o,b=this._videoSegmentInfoList.getLastSegmentBefore(m);if(null!=b&&b.beginDts<g){var w=Oe.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);if(w){var k=b.beginDts;b.beginDts,r.unshift({unit:w,dts:k,pts:k}),f+=w.byteLength}}else h=!1}for(var E=[],D=0;D<r.length;D++){var S=r[D],A=S.unit,T=S.dts-this._dtsBase,x=T-o;-1===s&&(s=x);var R=0;R=D!==r.length-1?r[D+1].dts-this._dtsBase-o-x:null!=_?_.dts-this._dtsBase-o-x:E.length>=1?E[E.length-1].duration:Math.floor(a);var C=!1,L=null;if(R>1.5*a&&"mp3"!==this._audioMeta.codec&&this._fillAudioTimestampGap&&!We.safari){C=!0;var I=Math.abs(R-a),U=Math.ceil(I/a),B=x+a,P=Oe.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);null==P&&(P=A),L=[];for(var O=0;O<U;O++){var F=Math.round(B);if(L.length>0){var M=L[L.length-1];M.duration=F-M.dts}var H={dts:F,pts:F,cts:0,unit:P,size:P.byteLength,duration:0,originalDts:T,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};L.push(H),f+=H.size,B+=a}var j=L[L.length-1];j.duration=x+R-j.dts,R=Math.round(a)}E.push({dts:x,pts:x,cts:0,unit:S.unit,size:S.unit.byteLength,duration:R,originalDts:T,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}),C&&E.push.apply(E,L)}u?d=new Uint8Array(f):((d=new Uint8Array(f))[0]=f>>>24&255,d[1]=f>>>16&255,d[2]=f>>>8&255,d[3]=255&f,d.set(He.types.mdat,4));for(var W=0;W<E.length;W++){var N=E[W].unit;d.set(N,c),c+=N.byteLength}var V=E[E.length-1];n=V.dts+V.duration,this._audioNextDts=n;var G=new $e;G.beginDts=s,G.endDts=n,G.beginPts=s,G.endPts=n,G.originalBeginDts=E[0].originalDts,G.originalEndDts=V.originalDts+V.duration,G.firstSample=new ze(E[0].dts,E[0].pts,E[0].duration,E[0].originalDts,!1),G.lastSample=new ze(V.dts,V.pts,V.duration,V.originalDts,!1),this._isLive||this._audioSegmentInfoList.append(G),i.samples=E,i.sequenceNumber++;var z=null;z=u?new Uint8Array:He.moof(i,s),i.samples=[],i.length=0;var $={type:"audio",data:this._mergeBoxes(z,d).buffer,sampleCount:E.length,info:G};u&&l&&($.timestampOffset=s),this._onMediaSegment("audio",$)}}}},{key:"_remuxVideo",value:function(e,t){if(null!=this._videoMeta){var n,i,r=e,o=r.samples,s=void 0,a=-1,u=-1;if(o&&0!==o.length&&(1!==o.length||t)){var l=8,h=null,c=8+e.length,d=null;if(o.length>1&&(c-=(d=o.pop()).length),null!=this._videoStashedLastSample){var f=this._videoStashedLastSample;this._videoStashedLastSample=null,o.unshift(f),c+=f.length}null!=d&&(this._videoStashedLastSample=d);var _=o[0].dts-this._dtsBase;if(this._videoNextDts)s=_-this._videoNextDts;else if(this._videoSegmentInfoList.isEmpty())s=0;else{var v=this._videoSegmentInfoList.getLastSampleBefore(_);if(null!=v){var m=_-(v.originalDts+v.duration);m<=3&&(m=0),s=_-(v.dts+v.duration+m)}else s=0}for(var p=new $e,y=[],g=0;g<o.length;g++){var b=o[g],w=b.dts-this._dtsBase,k=b.isKeyframe,E=w-s,D=b.cts,S=E+D;-1===a&&(a=E,u=S);var A=0;if(A=g!==o.length-1?o[g+1].dts-this._dtsBase-s-E:null!=d?d.dts-this._dtsBase-s-E:y.length>=1?y[y.length-1].duration:Math.floor(this._videoMeta.refSampleDuration),k){var T=new ze(E,S,A,b.dts,!0);T.fileposition=b.fileposition,p.appendSyncPoint(T)}y.push({dts:E,pts:S,cts:D,units:b.units,size:b.length,isKeyframe:k,duration:A,originalDts:w,flags:{isLeading:0,dependsOn:k?2:1,isDependedOn:k?1:0,hasRedundancy:0,isNonSync:k?0:1}})}(h=new Uint8Array(c))[0]=c>>>24&255,h[1]=c>>>16&255,h[2]=c>>>8&255,h[3]=255&c,h.set(He.types.mdat,4);for(var x=0;x<y.length;x++)for(var R=y[x].units;R.length;){var C=R.shift().data;h.set(C,l),l+=C.byteLength}var L=y[y.length-1];if(n=L.dts+L.duration,i=L.pts+L.duration,this._videoNextDts=n,p.beginDts=a,p.endDts=n,p.beginPts=u,p.endPts=i,p.originalBeginDts=y[0].originalDts,p.originalEndDts=L.originalDts+L.duration,p.firstSample=new ze(y[0].dts,y[0].pts,y[0].duration,y[0].originalDts,y[0].isKeyframe),p.lastSample=new ze(L.dts,L.pts,L.duration,L.originalDts,L.isKeyframe),this._isLive||this._videoSegmentInfoList.append(p),r.samples=y,r.sequenceNumber++,this._forceFirstIDR){var I=y[0].flags;I.dependsOn=2,I.isNonSync=0}var U=He.moof(r,a);r.samples=[],r.length=0,this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(U,h).buffer,sampleCount:y.length,info:p})}}}},{key:"_mergeBoxes",value:function(e,t){var n=new Uint8Array(e.byteLength+t.byteLength);return n.set(e,0),n.set(t,e.byteLength),n}},{key:"onInitSegment",get:function(){return this._onInitSegment},set:function(e){this._onInitSegment=e}},{key:"onMediaSegment",get:function(){return this._onMediaSegment},set:function(e){this._onMediaSegment=e}}])&&Xe(t.prototype,n),i&&Xe(t,i),e}();function Ke(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Ze=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._config=t,this._mediaSource=null,this._mediaSourceObjectURL=null,this._mediaElement=null,this._isBufferFull=!1,this._hasPendingEos=!1,this._requireSetMediaDuration=!1,this._pendingMediaDuration=0,this._pendingSourceBufferInit=[],this._mimeTypes={video:null,audio:null},this._sourceBuffers={video:null,audio:null},this._lastInitSegments={video:null,audio:null},this._pendingSegments={video:[],audio:[]},this._pendingRemoveRanges={video:[],audio:[]},this._idrList=new qe,this._autoCleanupMaxBackwardDuration=60,this._autoCleanupMinBackwardDuration=30,this._onError=null}var t,n,i;return t=e,(n=[{key:"destroy",value:function(){(this._mediaElement||this._mediaSource)&&this.detachMediaElement()}},{key:"attachMediaElement",value:function(e){var t=this._mediaSource=new window.MediaSource;t.addEventListener("sourceopen",this._onSourceOpen.bind(this)),t.addEventListener("sourceended",this._onSourceEnded.bind(this)),t.addEventListener("sourceclose",this._onSourceClose.bind(this)),this._mediaElement=e,this._mediaSourceObjectURL=window.URL.createObjectURL(this._mediaSource),e.src=this._mediaSourceObjectURL}},{key:"detachMediaElement",value:function(){if(this._mediaSource){var e=this._mediaSource;for(var t in this._sourceBuffers){var n=this._pendingSegments[t];n.splice(0,n.length),this._pendingSegments[t]=[],this._pendingRemoveRanges[t]=null,this._lastInitSegments[t]=null;var i=this._sourceBuffers[t];if(i){if("closed"!==e.readyState){try{e.removeSourceBuffer(i)}catch(e){}i.removeEventListener("error",this._onSourceBufferError.bind(this)),i.removeEventListener("updateend",this._onSourceBufferUpdateEnd.bind(this))}this._mimeTypes[t]=null,this._sourceBuffers[t]=null}}if("open"===e.readyState)try{e.endOfStream()}catch(e){}e.removeEventListener("sourceopen",this._onSourceOpen.bind(this)),e.removeEventListener("sourceended",this._onSourceEnded.bind(this)),e.removeEventListener("sourceclose",this._onSourceClose.bind(this)),this._pendingSourceBufferInit=[],this._isBufferFull=!1,this._idrList.clear(),this._mediaSource=null}this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement=null),this._mediaSourceObjectURL&&(window.URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)}},{key:"initSegment",value:function(e){var t="".concat(e.container);e.codec&&e.codec.length>0&&(t+=";codecs=".concat(e.codec));var n=!1;if(this._lastInitSegments[e.type]=e,t!==this._mimeTypes[e.type]){if(!this._mimeTypes[e.type]){n=!0;try{var i=this._sourceBuffers[e.type]=this._mediaSource.addSourceBuffer(t);i.addEventListener("error",this._onSourceBufferError.bind(this)),i.addEventListener("updateend",this._onSourceBufferUpdateEnd.bind(this))}catch(e){return}}this._mimeTypes[e.type]=t}this._pendingSegments[e.type].push(e),n||this._sourceBuffers[e.type]&&!this._sourceBuffers[e.type].updating&&this._doAppendSegments()}},{key:"appendMediaSegment",value:function(e){var t=e;if(this._pendingSegments[t.type].push(t),this._needCleanupSourceBuffer()&&this._doCleanupSourceBuffer(),this._config.isLive){var n=this._mediaElement.buffered,i=this._mediaElement.currentTime;if(n.length>0){var r=n.end(n.length-1);0==i&&(this._mediaElement.currentTime=r),r-i>1&&(this._mediaElement.currentTime=r-.2)}}var o=this._sourceBuffers[t.type];o&&!o.updating&&this._doAppendSegments()}},{key:"_needCleanupSourceBuffer",value:function(){var e=this._mediaElement.currentTime;for(var t in this._sourceBuffers){var n=this._sourceBuffers[t];if(n){var i=n.buffered;if(i.length>=1&&e-i.start(0)>=this._autoCleanupMaxBackwardDuration)return!0}}return!1}},{key:"_doCleanupSourceBuffer",value:function(){var e=this._mediaElement.currentTime;for(var t in this._sourceBuffers){var n=this._sourceBuffers[t];if(n){for(var i=n.buffered,r=!1,o=0;o<i.length;o++){var s=i.start(o),a=i.end(o);if(s<=e&&e<a+3){if(e-s>=this._autoCleanupMaxBackwardDuration){r=!0;var u=e-this._autoCleanupMinBackwardDuration;this._pendingRemoveRanges[t].push({start:s,end:u})}}else a<e&&(r=!0,this._pendingRemoveRanges[t].push({start:s,end:a}))}r&&!n.updating&&this._doRemoveRanges()}}}},{key:"_doRemoveRanges",value:function(){for(var e in this._pendingRemoveRanges)if(this._sourceBuffers[e]&&!this._sourceBuffers[e].updating)for(var t=this._sourceBuffers[e],n=this._pendingRemoveRanges[e];n.length&&!t.updating;){var i=n.shift();t.remove(i.start,i.end)}}},{key:"_doAppendSegments",value:function(){var e=this._pendingSegments;for(var t in e)if(this._sourceBuffers[t]&&!this._sourceBuffers[t].updating&&e[t].length>0){var n=e[t].shift();if(n.timestampOffset){var i=this._sourceBuffers[t].timestampOffset,r=n.timestampOffset/1e3;Math.abs(i-r)>.1&&(this._sourceBuffers[t].timestampOffset=r),delete n.timestampOffset}if(!n.data||0===n.data.byteLength)continue;try{this._sourceBuffers[t].appendBuffer(n.data),this._isBufferFull=!1,"video"===t&&n.hasOwnProperty("info")&&this._idrList.appendArray(n.info.syncPoints)}catch(e){if(this._pendingSegments[t].unshift(n),22===e.code)this._isBufferFull,this._isBufferFull=!0;else{var o={code:s,message:h[s]};this._onError&&this._onError(o)}}}}},{key:"_onSourceOpen",value:function(){}},{key:"_onSourceEnded",value:function(){}},{key:"_onSourceClose",value:function(){this._mediaSource&&(this._mediaSource.removeEventListener("sourceopen",this._onSourceOpen.bind(this)),this._mediaSource.removeEventListener("sourceended",this._onSourceEnded.bind(this)),this._mediaSource.removeEventListener("sourceclose",this._onSourceClose.bind(this)))}},{key:"_hasPendingSegments",value:function(){if(this._pendingSegments){var e=this._pendingSegments;return e.video.length>0||e.audio.length>0}}},{key:"_hasPendingRemoveRanges",value:function(){if(this._pendingRemoveRanges){var e=this._pendingRemoveRanges;return e.video.length>0||e.audio.length>0}}},{key:"_onSourceBufferUpdateEnd",value:function(){this._hasPendingSegments()&&this._doAppendSegments()}},{key:"_onSourceBufferError",value:function(e){}},{key:"onError",get:function(){return this._onError},set:function(e){this._onError=e}}])&&Ke(t.prototype,n),i&&Ke(t,i),e}();function Je(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var et=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._isLive=t.isLive,this._flvDemux=null,this._playElement=null,this._videoElement=null,this._hasAudio=!1,this._canvasElement=null,this._canvasCtx=null,this._mseCtrl=null,this._byteStart=0,this._mp4Remuxer=null,this._fullscreen=null,this._exitFullscreen=null,this._onError=null,this._load=!1,this._currentTime=0,this._onPlay=null,this.init()}var t,n,i;return t=e,(n=[{key:"init",value:function(){this._flvDemux=new Be,this._flvDemux.onTrackMetadata=this._onTrackMetadata.bind(this),this._flvDemux.onDataAvailable=this._onDataAvailable.bind(this),this._mp4Remuxer=new Qe,this._mp4Remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._mp4Remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this),this._mseCtrl=new Ze({isLive:this._isLive}),this._mseCtrl.onError=this._onErrorHandler.bind(this)}},{key:"destroy",value:function(){this._videoElement&&(this._videoElement.parentNode.removeChild(this._videoElement),this._videoElement=null),this._canvasElement&&(this._canvasElement.parentNode.removeChild(this._canvasElement),this._canvasElement=null),this._flvDemux&&(this._flvDemux.destroy(),this._flvDemux=null),this._mp4Remuxer&&(this._mp4Remuxer.destroy(),this._mp4Remuxer=null),this._mseCtrl&&(this._mseCtrl.destroy(),this._mseCtrl=null),this._byteStart=0,this._fullscreen=null,this._exitFullscreen=null,this._currentTime=0,this._onError=null,this._onPlay=null}},{key:"attach",value:function(e,t){this._playElement=e,this._stretch=t.stretch,this._width=e.clientWidth,this._height=e.clientHeight,this._playElement.style.position="relative";var n=document.createElement("video");n.width=this._width,n.height=this._height,n.setAttribute("autoplay","autoplay"),n.classList.add("gciplayer-video"),this._playElement.childNodes[0]?this._playElement.insertBefore(n,this._playElement.childNodes[0]):this._playElement.appendChild(n),this._videoElement=n,this._stretchCss(),this._fullscreen||(this._fullscreen=this._playElement.requestFullscreen||this._playElement.msRequestFullscreen||this._playElement.mozRequestFullScreen||this._playElement.webkitRequestFullscreen),this._exitFullscreen||(this._exitFullscreen=document.exitFullscreen||document.msExitFullscreen||document.mozCancelFullScreen||document.webkitCancelFullScreen),this._videoElement.addEventListener("contextmenu",(function(e){e.preventDefault()}));var i=document.createElement("canvas");i.classList.add("capture","hide"),this._playElement.appendChild(i),this._canvasElement=i,this._canvasCtx=this._canvasElement.getContext("2d"),this._mseCtrl.attachMediaElement(n),this._flvDemux.presentAudio=this._hasAudio=t.hasAudio}},{key:"clear",value:function(){this._flvDemux&&(this._flvDemux.destroy(),this._flvDemux=null),this._mp4Remuxer&&(this._mp4Remuxer.destroy(),this._mp4Remuxer=null),this._mseCtrl&&(this._mseCtrl.destroy(),this._mseCtrl=null),this._byteStart=0,this._currentTime=0,this.init(),this._mseCtrl.attachMediaElement(this._videoElement),this._flvDemux.presentAudio=this._hasAudio}},{key:"stop",value:function(){this._videoElement&&this._videoElement.pause()}},{key:"_stretchCss",value:function(){this._stretch?this._videoElement.style.cssText="object-fit: fill;":this._videoElement.style.cssText="object-fit: contain;"}},{key:"loadData",value:function(e,t){this._load=!0,this._flvDemux.parseChunks(e.buffer,this._byteStart),this._byteStart+=t}},{key:"toggleFullScreen",value:function(){window.fullScreen||document.webkitIsFullScreen?this.exitFullscreen():this.fullscreen()}},{key:"fullscreen",value:function(){this._fullscreen&&this._fullscreen.call(this._playElement)}},{key:"exitFullscreen",value:function(){this._exitFullscreen&&this._exitFullscreen.call(document)}},{key:"capture",value:function(e,t,n){this._canvasElement.width=this._videoElement.videoWidth,this._canvasElement.height=this._videoElement.videoHeight,this._canvasCtx.drawImage(this._videoElement,0,0,this._videoElement.videoWidth,this._videoElement.videoHeight);var i="image/png",r=this._canvasElement.toDataURL(i);if(t&&t instanceof Function&&t(this._dataURLtoFile(r,"capture.png")),e){var o=document.createElement("a");o.download=n||(new Date).getTime(),o.href=r,o.dataset.downloadurl=[i,o.download,o.href].join(":"),document.body.appendChild(o),o.click(),document.body.removeChild(o)}}},{key:"_dataURLtoFile",value:function(e,t){for(var n=e.split(","),i=atob(n[1]),r=i.length,o=new Uint8Array(r);r--;)o[r]=i.charCodeAt(r);return new File([o],t,{type:"image/png"})}},{key:"_onTrackMetadata",value:function(e,t){this._mp4Remuxer.trackMetadataReceived(e,t)}},{key:"_onDataAvailable",value:function(e,t){!this._hasAudio&&e.length&&(this._hasAudio=!0),t&&(this._currentTime=Math.floor(t.samples[0].pts/1e3),this._onPlay&&this._onPlay(this.currentTime)),this._mp4Remuxer.remux(e,t)}},{key:"_onRemuxerInitSegmentArrival",value:function(e,t){this._mseCtrl.initSegment(t)}},{key:"_onRemuxerMediaSegmentArrival",value:function(e,t){this._mseCtrl.appendMediaSegment(t)}},{key:"_onErrorHandler",value:function(e){this._onError&&this._onError(e)}},{key:"onError",get:function(){return this._onError},set:function(e){this._onError=e}},{key:"onPlay",get:function(){return this._onPlay},set:function(e){this._onPlay=e}},{key:"hasAudio",get:function(){return this._hasAudio}},{key:"fullScreenStatus",get:function(){return window.fullScreen||document.webkitIsFullScreen}},{key:"muted",get:function(){return this._videoElement.muted},set:function(e){this._videoElement.muted=e}},{key:"load",get:function(){return this._load}},{key:"stretch",get:function(){return this._stretch},set:function(e){this._stretch=e,this._stretchCss()}},{key:"currentTime",get:function(){return this._videoElement.currentTime>this._currentTime?this._currentTime:this._videoElement.currentTime}}])&&Je(t.prototype,n),i&&Je(t,i),e}();function tt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var nt=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._element=t,this._config=n,this._controlBar=null,this._playEle=null,this._playHandler=null,this._playStatus=!1,this._fullscreenEle=null,this._fullscreenHandler=null,this._mutedEle=null,this._muteHandler=null,this._muted=!1,this._captureHandler=null,this._onFullscreen=null,this._onMuted=null,this._onPlayStatus=null,this._onCapture=null,this._renderUI(),this._bindEvent()}var t,n,i;return t=e,(n=[{key:"destroy",value:function(){this._removeEvent(),this._controlBar&&(this._controlBar.parentNode.removeChild(this._controlBar),this._controlBar=null),this._mouseoverHandler=null,this._mouseoverHandler=null,this._fullscreenEle=null,this._fullscreenHandler=null,this._mutedEle=null,this._muteHandler=null,this._muted=!1,this._onFullscreen=null,this._onMuted=null,this._onPlayStatus=null,this._onCapture=null}},{key:"showControlBar",value:function(){this._controlBar&&(this._controlBar.style.opacity=1)}},{key:"hideControlBar",value:function(){this._controlBar&&(this._controlBar.style.opacity=0)}},{key:"_renderUI",value:function(){var e=document.createDocumentFragment();if(this._controlBar=document.createElement("div"),this._controlBar.classList.add("gciplayer-controlbar"),this._config.playBtn){this._playEle=document.createElement("div"),this._playEle.classList.add("gciplayer-play");var t=document.createElement("i");t.classList.add("iconfont","icon-play"),this._playEle.appendChild(t),this._controlBar.appendChild(this._playEle),this.showControlBar()}this._fullscreenEle=document.createElement("div"),this._fullscreenEle.classList.add("gciplayer-fullscreen");var n=document.createElement("i");n.classList.add("iconfont","icon-fullscreen"),this._fullscreenEle.appendChild(n),this._controlBar.appendChild(this._fullscreenEle),this._mutedEle=document.createElement("div"),this._mutedEle.classList.add("gciplayer-volume");var i=document.createElement("i"),r=this._muted?"icon-mute":"icon-volume";i.classList.add("iconfont",r),this._mutedEle.appendChild(i),this._controlBar.appendChild(this._mutedEle),this._captureEle=document.createElement("div"),this._captureEle.classList.add("gciplayer-capture"),this._captureEle.innerHTML="截图",this._controlBar.appendChild(this._captureEle),e.appendChild(this._controlBar),this._element.appendChild(e)}},{key:"_bindEvent",value:function(){this._mouseoverHandler=this._mouseoverEvent.bind(this),this._mouseleaveHandler=this._mouseleaveEvent.bind(this),this._element.addEventListener("mouseover",this._mouseoverHandler),this._element.addEventListener("mouseleave",this._mouseleaveHandler),this._muteHandler||(this._muteHandler=this._muteEvent.bind(this)),this._mutedEle.addEventListener("click",this._muteHandler),this._fullscreenHandler||(this._fullscreenHandler=this._fullscreenEvent.bind(this)),this._fullscreenEle.addEventListener("click",this._fullscreenHandler),this._playHandler||(this._playHandler=this._playEvent.bind(this)),this._playEle&&this._playEle.addEventListener("click",this._playHandler),this._captureHandler||(this._captureHandler=this._captureEvent.bind(this)),this._captureEle.addEventListener("click",this._captureHandler)}},{key:"_muteEvent",value:function(e){this._onMuted&&this._onMuted()}},{key:"_fullscreenEvent",value:function(e){this._onFullscreen&&this._onFullscreen()}},{key:"_playEvent",value:function(e){this._onPlayStatus&&this._onPlayStatus()}},{key:"_captureEvent",value:function(){this._onCapture&&this._onCapture.call()}},{key:"_removeEvent",value:function(){this._element.removeEventListener("mouseover",this._mouseoverHandler),this._element.removeEventListener("mouseleave",this._mouseleaveHandler),this._mutedEle.removeEventListener("click",this._muteHandler),this._fullscreenEle.removeEventListener("click",this._fullscreenHandler),this._playEle&&this._playEle.removeEventListener("click",this._playEvent)}},{key:"_toggleVolumeIcon",value:function(){this._muted?(this._mutedEle.querySelector("i").classList.remove("icon-volume"),this._mutedEle.querySelector("i").classList.add("icon-mute")):(this._mutedEle.querySelector("i").classList.remove("icon-mute"),this._mutedEle.querySelector("i").classList.add("icon-volume"))}},{key:"_togglePlayIcon",value:function(){this._config.playBtn&&(this._playStatus?(this._playEle.querySelector("i").classList.remove("icon-play"),this._playEle.querySelector("i").classList.add("icon-pause")):(this._playEle.querySelector("i").classList.remove("icon-pause"),this._playEle.querySelector("i").classList.add("icon-play")))}},{key:"_mouseoverEvent",value:function(e){this.showControlBar()}},{key:"_mouseleaveEvent",value:function(e){this._config.playBtn?this._playStatus&&this.hideControlBar():this.hideControlBar()}},{key:"onFullscreen",get:function(){return this._onFullscreen},set:function(e){this._onFullscreen=e}},{key:"onMuted",get:function(){return this._onMuted},set:function(e){this._onMuted=e}},{key:"onPlayStatus",get:function(){return this._onPlayStatus},set:function(e){this._onPlayStatus=e}},{key:"onCapture",get:function(){return this._onCapture},set:function(e){this._onCapture=e}},{key:"play",get:function(){return this._playStatus},set:function(e){this._playStatus=e,this._togglePlayIcon()}},{key:"muted",get:function(){return this._muted},set:function(e){this._muted=e,this._toggleVolumeIcon()}}])&&tt(t.prototype,n),i&&tt(t,i),e}();function it(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var rt=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._element=t,this._loadingEle=null,this._isShow=!1,this._renderUI()}var t,n,i;return t=e,(n=[{key:"destroy",value:function(){this._loadingEle&&(this._loadingEle.parentNode.removeChild(this._loadingEle),this._loadingEle=null)}},{key:"show",value:function(){this._isShow||(this._loadingEle.classList.remove("hide"),this._loadingEle.classList.add("show"),this._isShow=!0)}},{key:"hide",value:function(){this._isShow&&(this._loadingEle.classList.remove("show"),this._loadingEle.classList.add("hide"),this._isShow=!1)}},{key:"_renderUI",value:function(){var e=document.createDocumentFragment();this._loadingEle=document.createElement("div"),this._loadingEle.classList.add("player-loading","hide");for(var t=0;t<12;t++){var n=document.createElement("i");n.classList.add("player-loading-item"),this._loadingEle.appendChild(n)}e.appendChild(this._loadingEle),this._element.appendChild(e)}}])&&it(t.prototype,n),i&&it(t,i),e}();function ot(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var st=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._element=t,this._promptEle=null,this._isShow=!1,this._renderUI()}var t,n,i;return t=e,(n=[{key:"destroy",value:function(){this._promptEle&&(this._promptEle.parentNode.removeChild(this._promptEle),this._promptEle=null)}},{key:"show",value:function(e){this._isShow||(this._promptEle.classList.remove("hide"),this._promptEle.classList.add("show"),this._isShow=!0),this._promptEle.textContent=e}},{key:"hide",value:function(){this._isShow&&(this._promptEle.classList.remove("show"),this._promptEle.classList.add("hide"),this._isShow=!1)}},{key:"_renderUI",value:function(){this._promptEle=document.createElement("div"),this._promptEle.classList.add("gciplayer-prompt","hide"),this._element.appendChild(this._promptEle)}}])&&ot(t.prototype,n),i&&ot(t,i),e}();function at(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ut=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._element=t,this._flowEle=null,this._isShow=!0,this._renderUI()}var t,n,i;return t=e,(n=[{key:"destroy",value:function(){this._flowEle&&(this._flowEle.parentNode.removeChild(this._flowEle),this._flowEle=null)}},{key:"show",value:function(){this._isShow||(this._flowEle.classList.remove("hide"),this._flowEle.classList.add("show"),this._isShow=!0)}},{key:"hide",value:function(){this._isShow&&(this._flowEle.classList.remove("show"),this._flowEle.classList.add("hide"),this._isShow=!1)}},{key:"text",value:function(e){this._flowEle.textContent=e>0?this._flowESC(e):""}},{key:"_renderUI",value:function(){this._flowEle=document.createElement("div"),this._flowEle.classList.add("gciplayer-flow"),this._element.appendChild(this._flowEle)}},{key:"_flowESC",value:function(e){return e<1024?e+"KB":(e/1024).toFixed(2)+"MB"}}])&&at(t.prototype,n),i&&at(t,i),e}();function lt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ht=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._element=t,this._loadingUI=null,this._promptUI=null,this._flowUI=null,this._init()}var t,n,i;return t=e,(n=[{key:"destroy",value:function(){this._loadingUI&&(this._loadingUI.destroy(),this._loadingUI=null),this._promptUI&&(this._promptUI.destroy(),this._promptUI=null),this._flowUI&&(this._flowUI.destroy(),this._flowUI=null)}},{key:"showLoading",value:function(){this._loadingUI.show()}},{key:"hideLoading",value:function(){this._loadingUI.hide()}},{key:"showPrompt",value:function(e){this._promptUI.show(e)}},{key:"hidePrompt",value:function(){this._promptUI.hide()}},{key:"showFlow",value:function(){this._flowUI.show()}},{key:"hideFlow",value:function(){this._flowUI.hide()}},{key:"flowText",value:function(e){this._flowUI.text(e)}},{key:"_init",value:function(){this._loadingUI=new rt(this._element),this._promptUI=new st(this._element),this._flowUI=new ut(this._element)}}])&&lt(t.prototype,n),i&&lt(t,i),e}(),ct={ERROR:"error",SUCCESS:"success",FLOW:"flow",CLOSE:"close",PLAY_CLICK:"play.click",TIMELINEDRAG:"timelinedrag"},dt=0,ft=1,_t=2,vt={name:null,enableWorker:!0,decoderWorker:!0,ioWorker:!1,isLive:!0,audio:!1,stretch:!1,showFlow:!1,showTips:!0,hasAudio:!1,controls:!0,timeout:60,sync:!0,playback:!1,cacheTime:0,watermarkText:"",watermarkMove:!1,renderType:1,wasmFile:"http://219.137.32.216:6200/static/libvideo-hd.wasm"},mt=n(1),pt=n.n(mt);function yt(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return gt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return gt(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}function gt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function bt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var wt=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._timelineEle=null,this._load=!1,this._timelineData=null,this._videoTime=0,this._playing=!1,this._reqTimer=null,this._canvas=null,this._ctx=null,this._dpr=1,this._offsetX=14,this._startTime=pt()().startOf("day").add(-1,"d"),this._currentTime=pt()().startOf("day").add(-1,"d"),this._period=0,this._lineDrag=!1,this._onTimelineDrag=null,this._lastDrag=!1,this._lastTimeScale=null,this._cursor=0,this._skipTime=0}var t,n,i;return t=e,(n=[{key:"attach",value:function(e){this._dpr=window.devicePixelRatio,this._timelineEle=e;var t=document.createElement("canvas");t.width=this._timelineEle.clientWidth*this._dpr,t.height=this._timelineEle.clientHeight*this._dpr,t.classList.add("timeline-canvas"),this._timelineEle.appendChild(t),this._canvas=t,this._init(),this._reqTimer=requestAnimationFrame(this._render.bind(this))}},{key:"loadData",value:function(e){this._lastTimeScale=null,this._timelineData=e,this._startTime=pt()(this._timelineData.date,"YYYY-MM-DD"),this._currentTime=pt()(this._timelineData.date,"YYYY-MM-DD"),this._load=!0}},{key:"destroy",value:function(){this.close(),this._timelineData=null,this._reqTimer&&(cancelAnimationFrame(this._reqTimer),this._reqTimer=null),this._canvas&&(this._canvas.parentNode.removeChild(this._canvas),this._canvas=null),this._timelineEle=null,this._onTimelineDrag=null,this._load=!1}},{key:"close",value:function(){this._playing=!1,this._currentTime=this._currentTime.add(this._videoTime,"s"),this._videoTime=0,this._lastTimeScale=null}},{key:"_init",value:function(){this._period=(this._canvas.width-2*this._offsetX)/86400,this._ctx=this._canvas.getContext("2d"),this._bindEvent()}},{key:"_render",value:function(){this._draw(),this._reqTimer=requestAnimationFrame(this._render.bind(this))}},{key:"_draw",value:function(){this._clearDraw(),this._drawTimeScale(),this._drawBlock(),this._drawPoint()}},{key:"_drawTimeScale",value:function(){this._ctx.restore(),this._ctx.fillStyle="rgba(69, 69, 69, 0.7)",this._ctx.fillRect(0,0,this._canvas.width,20);for(var e=0,t=(this._canvas.width-2*this._offsetX)/144,n=0;n<=144;n++)if(e=n*t+this._offsetX,n%6==0){this._drawLine(e,0,e,20),this._ctx.fillStyle="#fff",this._ctx.font="11px 宋体";var i=this._startTime.add(10*n,"m").format("HH:mm"),r=this._ctx.measureText(i).width;this._ctx.fillText(i,e-r/2,32)}else this._drawLine(e,0,e,10)}},{key:"_drawLine",value:function(e,t,n,i){this._ctx.restore(),this._ctx.lineWidth=1,this._ctx.strokeStyle="#fff",this._ctx.beginPath(),this._ctx.moveTo(Math.floor(e)+.5,t),this._ctx.lineTo(Math.floor(n)+.5,i),this._ctx.closePath(),this._ctx.stroke()}},{key:"_drawBlock",value:function(){var e=this._canvas.width-2*this._offsetX;if(this._ctx.restore(),this._ctx.fillStyle="#ccc",this._ctx.strokeRect(this._offsetX,60,e,15),this._timelineData){var t,n=0,i=0,r=yt(this._timelineData.timelines);try{for(r.s();!(t=r.n()).done;){var o=t.value,s=pt()(o.beginTime,"YYYY-MM-DD HH:mm:ss"),a=pt()(o.endTime,"YYYY-MM-DD HH:mm:ss");a.diff(s,"d")>1||(n=s.diff(this._startTime,"s")*this._period,i=a.diff(s,"s")*this._period,n<0&&(n=0),n+i>e&&(i=e-n),i<0&&(i=0),this._ctx.restore(),this._ctx.fillStyle="rgba(66, 126, 236, .7)",this._ctx.clearRect(Math.floor(this._offsetX+n),60,Math.ceil(i),15),this._ctx.fillRect(Math.floor(this._offsetX+n),60,Math.ceil(i),15))}}catch(e){r.e(e)}finally{r.f()}this._lastTimeScale||(this._lastTimeScale=this._offsetX+n+i)}}},{key:"_drawPoint",value:function(){var e=this._currentTime.add(this._videoTime,"s"),t=e.diff(this._startTime,"s")*this._period,n=this._offsetX+t;this._ctx.beginPath(),this._ctx.moveTo(n,0),this._ctx.lineTo(n,this._canvas.height),this._ctx.lineWidth=2,this._ctx.strokeStyle="rgba(238, 36, 32, .5)",this._ctx.stroke(),this._ctx.fillStyle="#fff",this._ctx.font="12px 宋体";var i=e.format("HH:mm:ss"),r=this._ctx.measureText(i).width;n<this._canvas.width/2?this._ctx.fillText(i,n+2,50):this._ctx.fillText(i,n-r-2,50)}},{key:"_clearDraw",value:function(){this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height)}},{key:"_bindEvent",value:function(){var e=this;this._canvas&&(this._canvas.addEventListener("mousedown",(function(t){if(e._load){e._lineDrag=!0,e._videoTime=0,e._canvas.style.cursor="grabbing";var n=t.offsetX*e._dpr;n<e._offsetX||n+e._offsetX>e._canvas.width||e._calcDragTime(n)}})),this._canvas.addEventListener("mousemove",this._throttle((function(t){if(e._lineDrag){var n=t.offsetX*e._dpr;e._calcDragTime(n)}})),1e3/60),this._canvas.addEventListener("mouseup",(function(t){if(e._lineDrag){var n=t.offsetX*e._dpr;e._calcDragTime(n),e._lineDrag=!1,e._canvas.style.cursor="pointer",e._onTimelineDrag&&e._onTimelineDrag(e._currentTime)}})),this._canvas.addEventListener("mouseleave",(function(t){e._lineDrag&&(e._lineDrag=!1,e._onTimelineDrag&&e._onTimelineDrag(e._currentTime))})))}},{key:"_calcDragTime",value:function(e){this._lastDrag=!1,e<this._offsetX?e=this._offsetX:this._lastTimeScale&&e>this._lastTimeScale&&(e=this._lastTimeScale,this._lastDrag=!0);var t=Math.round((e-this._offsetX)/this._period);this._currentTime=this._startTime.add(t+this._videoTime,"s")}},{key:"_throttle",value:function(e,t){var n;return function(){var i=this,r=arguments;n||(n=setTimeout((function(){n=null,e.apply(i,r)}),t))}}},{key:"videoTime",set:function(e){this._lineDrag||(this._videoTime=e)}},{key:"playing",set:function(e){this._playing=e}},{key:"onTimelineDrag",get:function(){return this._onTimelineDrag},set:function(e){this._onTimelineDrag=e}},{key:"load",get:function(){return this._load}},{key:"currentTime",set:function(e){this._currentTime=pt()(e)},get:function(){return this._currentTime}},{key:"lastDrag",get:function(){return this._lastDrag}}])&&bt(t.prototype,n),i&&bt(t,i),e}();n(7),n(8);function kt(e){return(kt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Et(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Dt=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._playElement=t,this._config=vt,"object"===kt(n)&&Object.assign(this._config,n),this._name=this._config.name,this._playerWrapperEle=null,this._playerTimelineEle=null,this._previewImg=null,this._emitter=new r.a,this._transmuxer=null,this._render=null,this._timelineRender=null,this._controlBarUI=null,this._ornamentUI=null,this._playing=!1,this._close=!1,this._emitterMap={},this._playStatus=null,this._observer=null,this._renderWorker=null,this.init()}var t,n,i;return t=e,(n=[{key:"init",value:function(){this._playStatus||(this._playElement.style.position="relative",this._playerWrapperEle=document.createElement("div"),this._playerWrapperEle.classList.add("gciplayer-wrapper"),this._playerWrapperEle.id="gciplayer-"+(new Date).getTime(),this._playElement.appendChild(this._playerWrapperEle),this._previewImg=document.createElement("img"),this._previewImg.classList.add("gciplayer-preview","hide"),this._playerWrapperEle.appendChild(this._previewImg),this._config.playback&&(this._playerWrapperEle.style.height="calc(100% - 90px)",this._playerTimelineEle=document.createElement("div"),this._playerTimelineEle.classList.add("gciplayer-timeline"),this._playElement.appendChild(this._playerTimelineEle),this._timelineRender=new wt,this._timelineRender.attach(this._playerTimelineEle),this._timelineRender.onTimelineDrag=this._onTimelineDrag.bind(this)),2==this._config.renderType?(this._render=new et({isLive:!this._config.playback}),this._render.attach(this._playerWrapperEle,{stretch:this._config.stretch,hasAudio:this._config.hasAudio}),this._render.onError=this._onError.bind(this),this._render.onPlay=this._onPlay.bind(this)):(this._render=new Ee,this._render.attach(this._playerWrapperEle,{stretch:this._config.stretch,sync:this._config.sync,cacheTime:this._config.cacheTime,watermarkText:this._config.watermarkText,watermarkMove:this._config.watermarkMove}),this._render.onPlay=this._onPlay.bind(this)),this._config.controls&&(this._controlBarUI=new nt(this._playerWrapperEle,{playBtn:this._config.playback}),this._controlBarUI.onFullscreen=this._onUIFullscreen.bind(this),this._controlBarUI.onMuted=this._onUIMuted.bind(this),this._controlBarUI.onPlayStatus=this._onPlayStatus.bind(this),this._controlBarUI.onCapture=this._onCapture.bind(this),this._controlBarUI.muted=!this._config.audio),this._render.muted=!this._config.audio,this._ornamentUI=new ht(this._playerWrapperEle),this._config.showFlow||this._ornamentUI.hideFlow(),this._transmuxer=new oe(this._config),this._transmuxer.on(w,this._onError.bind(this)),this._transmuxer.on(E,this._onError.bind(this)),this._transmuxer.on(D,this._videoData.bind(this)),this._transmuxer.on(S,this._audioData.bind(this)),this._transmuxer.on(T,this._onFlow.bind(this)),this._transmuxer.on(A,this._onFlvData.bind(this)),this._playStatus=dt)}},{key:"destroy",value:function(){this._playing=!1,this._playStatus!=_t&&this.close(),this._timelineRender&&(this._timelineRender.destroy(),this._timelineRender=null),this._transmuxer&&(this._transmuxer.destroy(),this._transmuxer=null),this._render&&(this._render.destroy(),this._render=null),this._controlBarUI&&(this._controlBarUI.destroy(),this._controlBarUI=null),this._ornamentUI&&(this._ornamentUI.destroy(),this._ornamentUI=null),this._emitter&&(this._emitter.removeAllListeners(),this._emitter=null),this._emitterMap=null,this._playStatus=null,this._playElement=null,this._config=null,this._playerWrapperEle&&(this._playerWrapperEle.remove(),this._playerWrapperEle=null),this._playerTimelineEle&&(this._playerTimelineEle.remove(),this._playerTimelineEle=null),this._observer&&this._observer.disconnect(),this._observer=null}},{key:"on",value:function(e,t){ct[e.toUpperCase().replace(".","_")]&&(this._emitterMap[e]=!0,this._emitter.addListener(e,t))}},{key:"off",value:function(e,t){delete this._emitterMap[e],this._emitter.removeListener(e,t)}},{key:"play",value:function(e){this._close=!1,this._playStatus!=ft&&(this._ornamentUI.hidePrompt(),this._ornamentUI.showLoading(),this._previewImg.classList.add("hide"),this._playStatus=ft,this._controlBarUI&&(this._controlBarUI.play=!0),this._transmuxer.play(e,{timeout:this._config.timeout})),this._timelineRender&&(this._timelineRender.playing=!0)}},{key:"pause",value:function(){var e=this;this._transmuxer.close(),this._config.playback&&this._playing?(this._render.stop(),this._render.capture(!1,(function(t){var n=new FileReader;n.readAsDataURL(t),n.onload=function(t){e._previewImg.classList.remove("hide"),e._previewImg.src=n.result,e._render.clear(),e.close(null,!0)}}))):this.close()}},{key:"close",value:function(e,t){t||this._previewImg.classList.add("hide"),this._transmuxer.close(),this._render.clear(),this._playing=!1,this._close=!0,this._controlBarUI&&(this._controlBarUI.play=!1),this._ornamentUI.hideLoading(),this._ornamentUI.flowText(0),this._timelineRender&&this._timelineRender.close(),this._playStatus!=_t&&(this._emitterMap[ct.CLOSE]&&this._emitter.emit(ct.CLOSE),e&&setTimeout((function(){e.call()}),500),this._playStatus=_t)}},{key:"toggleFullScreen",value:function(){this._render.toggleFullScreen()}},{key:"fullscreen",value:function(){this._render.fullscreen()}},{key:"exitFullscreen",value:function(){this._render.exitFullscreen()}},{key:"capture",value:function(e,t){this._playStatus==ft&&this._render.capture(e,t)}},{key:"setMuted",value:function(e){this._controlBarUI&&(this._controlBarUI.muted=e),this._render.muted=e}},{key:"setStretch",value:function(e){this._render.stretch=e}},{key:"loadTimelineData",value:function(e){this._timelineRender&&this._timelineRender.loadData(e)}},{key:"showTips",value:function(e){this._ornamentUI&&this._ornamentUI.showPrompt(e)}},{key:"setTimelineTime",value:function(e){this._timelineRender&&(this._timelineRender.currentTime=e)}},{key:"_videoData",value:function(e,t,n,i){this._close||(this._playing||(this._emitterMap[ct.SUCCESS]&&this._emitter.emit(ct.SUCCESS),this._playing=!0,this._render.play()),this._playStatus==ft&&(this._render.load&&this._ornamentUI.hideLoading(),this._render.drawFrame(e,t,n,i)))}},{key:"_audioData",value:function(e,t,n,i,r){this._close||this._playStatus==ft&&(this._render.hasAudio||(this._render.createAudio(i,r),this._render.muted=!this._config.audio,this._config.controls&&(this._controlBarUI.muted=this._render.muted)),this._render.audioFrame(e,t))}},{key:"_onFlvData",value:function(e,t){this._close||(this._config.audio&&this._config.controls&&this._controlBarUI.muted!=this._render.muted&&(this._controlBarUI.muted=this._render.muted),this._ornamentUI.hideLoading(),this._render.loadData(e,t))}},{key:"_onUIFullscreen",value:function(){this.toggleFullScreen()}},{key:"_onUIMuted",value:function(){this._render.hasAudio&&this._config.controls&&(this._controlBarUI.muted=!this._controlBarUI.muted,this._render.muted=this._controlBarUI.muted)}},{key:"_onPlayStatus",value:function(){this._timelineRender.load&&!this._timelineRender.lastDrag&&(this._controlBarUI.play=!this._controlBarUI.play,this._emitterMap[ct.PLAY_CLICK]&&this._emitter.emit(ct.PLAY_CLICK,this._controlBarUI.play))}},{key:"_onCapture",value:function(){this._playStatus==ft&&this._render.capture(!0,(function(){}),this._name)}},{key:"_mutationObserver",value:function(){var e=this,t=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;this._observer=new t((function(t,n){0==e._playElement.clientWidth&&e.destroy()})),this._observer.observe(document.body,{childList:!0,subtree:!0})}},{key:"_onError",value:function(e){this._config.showTips&&this._ornamentUI.showPrompt(e.message),this.close(),this._emitterMap[ct.ERROR]&&this._emitter.emit(ct.ERROR,e)}},{key:"_onFlow",value:function(e){this._render.load&&(this._ornamentUI.flowText(e),this._emitterMap[ct.FLOW]&&this._emitter.emit(ct.FLOW,e))}},{key:"_onPlay",value:function(e){this._playing||(this._emitterMap[ct.SUCCESS]&&this._emitter.emit(ct.SUCCESS),this._playing=!0),this._timelineRender&&(this._timelineRender.videoTime=e)}},{key:"_onTimelineDrag",value:function(e){this._emitterMap[ct.TIMELINEDRAG]&&this._emitter.emit(ct.TIMELINEDRAG,e.format("YYYY-MM-DD HH:mm:ss"))}},{key:"currentTime",get:function(){return this._render.currentTime}},{key:"muted",get:function(){return this._render.muted},set:function(e){this._render.muted=e}},{key:"volume",get:function(){return this._render.volume},set:function(e){this._render.volume=e}},{key:"palyStatus",get:function(){return this._playStatus}},{key:"fullscreenStatus",get:function(){return this._render.fullScreenStatus}},{key:"hasAudio",get:function(){return this._render.hasAudio}},{key:"playing",get:function(){return this._playing}},{key:"name",get:function(){return this._name},set:function(e){this._name=e}}])&&Et(t.prototype,n),i&&Et(t,i),e}();function St(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var At=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,i;return t=e,i=[{key:"supportWebAssembly",value:function(){return!!window.WebAssembly}}],(n=null)&&St(t.prototype,n),i&&St(t,i),e}();var Tt={createPlayer:function(e,t){return new Dt(e,t)},isSupported:function(){return At.supportWebAssembly()}};Tt.dayjs=pt.a;t.default=Tt}])}));